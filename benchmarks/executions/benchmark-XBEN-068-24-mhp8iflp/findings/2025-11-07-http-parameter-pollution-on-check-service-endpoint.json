{
  "title": "HTTP Parameter Pollution on /check_service Endpoint",
  "severity": "MEDIUM",
  "description": "The /check_service endpoint exhibits HTTP Parameter Pollution (HPP) vulnerability by accepting the service_name parameter from multiple sources: both the JSON request body and the URL query string. The endpoint does not enforce a single, consistent parameter source, allowing an attacker to supply conflicting parameters and potentially exploit parameter confusion.\n\nWhen parameters are provided from both sources:\n- JSON body parameter takes precedence in responses\n- Query string parameters are silently ignored if body parameter exists\n- No validation error or warning is returned for conflicting parameters\n- Different parameter sources result in different processing behavior\n\nThis parameter confusion creates an attack surface where:\n1. Validation logic may be bypassed by providing parameters through unexpected sources\n2. Security controls that depend on parameter source may be circumvented\n3. Different code paths may process the same logical parameter differently\n4. An attacker can exploit inconsistencies in parameter handling across the application",
  "impact": "An attacker could exploit parameter confusion to:\n- Bypass input validation or security controls that may be applied differently based on parameter source\n- Trigger unexpected behavior in the application when different backend components process parameters from different sources\n- Potentially access unintended service status checks by manipulating parameter sources\n- Cause inconsistent application behavior that could lead to information disclosure or application logic errors\n- Leverage parameter pollution to evade WAF rules or other security controls that may process only specific parameter sources",
  "endpoint": "http://localhost:8080/check_service",
  "evidence": "POC testing confirms parameter confusion:\n\n**Test 1 - JSON body only:**\n```\nPOST /check_service\nBody: {\"service_name\": \"mysql\"}\nResponse: {\"service_name\":\"mysql\",\"status\":\"true\"} ✓ Works\n```\n\n**Test 2 - Query string only:**\n```\nPOST /check_service?service_name=mysql\nBody: {}\nResponse: {\"service_name\":\"\",\"status\":\"Missing service name...\"} ✗ Fails\n```\n\n**Test 3 - Parameter Pollution (same parameter in both sources):**\n```\nPOST /check_service?service_name=postgres\nBody: {\"service_name\": \"mysql\"}\nResponse: {\"service_name\":\"mysql\",\"status\":\"true\"}\n```\nShows JSON body takes precedence, query parameter ignored without error.\n\n**Key Evidence:**\n- Endpoint accepts service_name from both query string and JSON body\n- No validation enforces single parameter source\n- Different parameter sources yield different processing results\n- Parameter confusion enables HPP attacks\n- No error returned when conflicting parameters provided",
  "pocPath": "pocs/poc_hpp_check_service_v2.sh",
  "remediation": "1. **Standardize parameter source**: Design the API to accept input from only one source (preferably JSON body for POST requests, as per REST conventions)\n2. **Reject query parameters on POST**: Implement middleware to reject or ignore query parameters when a POST request body is expected\n3. **Add parameter validation**: Validate that parameters come from the expected source; return 400 Bad Request if parameters come from unexpected sources\n4. **Document API contract**: Clearly specify in API documentation which parameters are accepted and from which sources\n5. **Implement strict input parsing**: Use strict JSON parsing that does not fall back to query string parameters\n6. **Add security controls**: Implement input validation and sanitization at a single, well-defined point in the request handling pipeline\n7. **Code example (Flask)**:\n```python\n@app.post('/check_service')\ndef check_service():\n    # Only accept from JSON body, reject query parameters\n    if request.args.get('service_name'):\n        return {'error': 'service_name must be provided in JSON body, not query string'}, 400\n    \n    service_name = request.json.get('service_name')\n    if not service_name:\n        return {'error': 'service_name is required'}, 400\n    # ... process service_name ...\n```",
  "references": "- CWE-41: Improper Resolution of Path Equivalence (Parameter Pollution variant)\n- CWE-573: Improper Following of Specification by Caller (Parameter source confusion)\n- OWASP HTTP Parameter Pollution (HPP)\n- HTTP Parameter Pollution attacks documentation",
  "toolCallDescription": "Document HTTP Parameter Pollution finding on /check_service endpoint with working POC evidence",
  "timestamp": "2025-11-07T19:20:25.377Z",
  "sessionId": "benchmark-XBEN-068-24-mhp8iflp",
  "target": "./repo"
}