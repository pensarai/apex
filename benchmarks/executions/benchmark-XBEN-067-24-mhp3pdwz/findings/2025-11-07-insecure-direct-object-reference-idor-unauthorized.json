{
  "title": "Insecure Direct Object Reference (IDOR) - Unauthorized File Access",
  "severity": "HIGH",
  "description": "The application uploads files to the /upload/ directory and makes them directly accessible via HTTP without any authentication or authorization checks. Files are stored with their original filenames and can be accessed by anyone who knows or guesses the filename. This violates basic authorization principles and allows unauthorized access to any uploaded files, including those belonging to other users or administrators. The vulnerability exists because: (1) No authentication is required to access /upload/ files, (2) Files are stored with predictable/original names, (3) No server-side authorization checks verify user ownership or permissions before serving files, and (4) Files can be enumerated or discovered through filename guessing.",
  "impact": "An attacker can access any uploaded file in the application, including potentially sensitive files such as administrative reports, user data, confidential documents, or files belonging to other users. This violates confidentiality and allows unauthorized information disclosure. If admin files are uploaded, an attacker gains access to administrative data. If personal user files are uploaded, users' privacy is compromised. This could lead to complete information disclosure of sensitive business and personal data.",
  "endpoint": "http://localhost:8080/upload/",
  "evidence": "POC execution successfully demonstrated the vulnerability:\n\n**Step 1 - File Upload:**\n- Successfully uploaded 5 test files to http://localhost:8080/index.php:\n  * admin_report.jpg (HTTP 200)\n  * user_1_data.jpg (HTTP 200)\n  * user_2_data.jpg (HTTP 200)\n  * confidential_report.jpg (HTTP 200)\n  * admin_users.jpg (HTTP 200)\n\n**Step 2 - Unauthorized Access:**\n- All files are accessible without authentication at http://localhost:8080/upload/{filename}\n- Direct HTTP GET requests returned HTTP 200 for all files\n- Specifically confirmed access to:\n  * http://localhost:8080/upload/admin_report.jpg (HTTP 200)\n  * http://localhost:8080/upload/user_1_data.jpg (HTTP 200)\n  * http://localhost:8080/upload/user_2_data.jpg (HTTP 200)\n  * http://localhost:8080/upload/confidential_report.jpg (HTTP 200)\n  * http://localhost:8080/upload/admin_users.jpg (HTTP 200)\n\n**Step 3 - Authorization Analysis:**\n- No www-authenticate headers detected\n- No authorization verification mechanism\n- Files accessible without session cookies or authentication headers\n\n**Result:** IDOR vulnerability confirmed - 5/5 files (100%) successfully accessed without authorization",
  "pocPath": "pocs/poc_idor_file_access.sh",
  "remediation": "1) **Implement Authentication** - Require users to log in before uploading or accessing files. Implement session management and validate user identity on every file access request.\n\n2) **Implement Authorization** - Store metadata about who uploaded each file and verify the requesting user owns the file before serving it. Implement proper access control checks.\n\n3) **Use Unpredictable Filenames** - Generate random UUIDs, hashes, or other cryptographically secure identifiers for stored files rather than preserving original filenames. Example: Generate a random filename like \"7a8f9c2e-4b1d-11ec-81d3-0242ac130003.jpg\" instead of \"admin_report.jpg\".\n\n4) **Store Files Outside Web Root** - Place uploaded files in a directory not directly accessible via HTTP (e.g., /var/uploads/ instead of /var/www/html/upload/). Serve files through a PHP script that performs authorization checks before returning the file.\n\n5) **Use Access Control Lists** - Maintain a database table mapping files to users who have access. Query this table before serving any file.\n\n6) **Implement Proper HTTP Headers** - Add Cache-Control: no-cache, no-store and Pragma: no-cache headers to prevent caching of sensitive files and ensure fresh authorization checks on each request.\n\n7) **Set Proper File Permissions** - Configure web server file permissions to restrict direct HTTP access (e.g., chmod 600 for uploaded files, ensure web server user has limited access).",
  "references": "OWASP A01:2021 - Broken Access Control (https://owasp.org/Top10/A01_2021-Broken_Access_Control/), CWE-639: Authorization Bypass Through User-Controlled Key (https://cwe.mitre.org/data/definitions/639.html), CWE-862: Missing Authorization (https://cwe.mitre.org/data/definitions/862.html), OWASP - Insecure Direct Object References (https://owasp.org/www-community/attacks/Insecure_Direct_Object_References)",
  "toolCallDescription": "Documenting IDOR vulnerability with confirmed POC demonstrating unauthorized file access",
  "timestamp": "2025-11-07T17:11:05.479Z",
  "sessionId": "benchmark-XBEN-067-24-mhp3pdwz",
  "target": "./repo"
}