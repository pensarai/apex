{
  "title": "Poor Error Handling and Missing HTTP Status Codes",
  "severity": "MEDIUM",
  "description": "The /amortization endpoint demonstrates poor error handling by returning generic HTTP 500 Internal Server Error responses for conditions that should return more specific HTTP status codes. When required parameters are missing or invalid values are provided (e.g., non-numeric strings for numeric parameters, float values for integer parameters), the application returns a generic 500 error instead of a proper HTTP 400 Bad Request. Additionally, the error messages lack detail and don't provide users or API consumers with information about what went wrong or how to fix it. Error responses are generic HTML pages without any indication of the specific validation failure, making it difficult for developers to debug their requests.",
  "impact": "Poor error handling leads to: (1) Poor user/developer experience - API consumers don't know what went wrong with their requests, (2) Incorrect error handling by API clients - clients may interpret 500 as a temporary server issue when it's actually a client input problem, (3) Difficult debugging - legitimate API users can't easily identify and fix their requests, (4) Operational difficulties - support teams and developers can't easily troubleshoot issues, (5) Potential masking of real server errors - legitimate 500 errors may be lost among validation errors, (6) Reduced API usability - lack of clear error messages discourages API adoption and integration.",
  "endpoint": "http://localhost/amortization",
  "evidence": "POC execution results demonstrate the vulnerability:\n\nTest 1 - Missing parameters:\nRequest: curl -s http://localhost/amortization\nResult: HTTP 500 (should be HTTP 400 with message: \"Missing required parameters: principal, rate, term\")\n\nTest 2 - Non-numeric term parameter:\nRequest: curl -s http://localhost/amortization?principal=10000&rate=5&term=xyz\nResult: HTTP 500 (should be HTTP 400 with message: \"Invalid term value. Expected integer.\")\nResponse: Generic HTML error page without parameter-specific details\n\nTest 3 - Float term parameter (must be integer):\nRequest: curl -s http://localhost/amortization?principal=10000&rate=5&term=12.5\nResult: HTTP 500 (should be HTTP 400 with message: \"Term parameter must be an integer\")\n\nTest 4 - Invalid types for all parameters:\nRequest: curl -s http://localhost/amortization?principal=abc&rate=def&term=xyz\nResult: HTTP 500 with generic error message: \"The server encountered an internal error and was unable to complete your request.\"\nNo indication of which parameter caused the error or what the valid format is.\n\nTest 5 - Negative principal value:\nRequest: curl -s http://localhost/amortization?principal=-1000&rate=5&term=12\nResult: HTTP 200 (silently accepts invalid negative value instead of rejecting with HTTP 400)\n\nAll error responses are generic HTML without parameter-specific detail or hints for correction.",
  "pocPath": "pocs/poc_error_handling_missing_params.sh",
  "remediation": "1. Implement input validation before processing: Validate all parameters (principal, rate, term) at the start of request handling using a validation framework or explicit checks.\n\n2. Return proper HTTP status codes:\n   - HTTP 400 Bad Request for missing or invalid input parameters\n   - HTTP 422 Unprocessable Entity for semantic/business logic validation errors\n   - HTTP 500 only for actual server errors\n\n3. Provide specific, actionable error messages:\n   - Include the name of the invalid parameter (e.g., \"principal\", \"term\")\n   - Describe what went wrong (e.g., \"non-numeric\", \"must be positive integer\")\n   - Provide the expected format (e.g., \"must be a positive number\", \"must be an integer between 1 and 360\")\n   - Example: {\"error\": \"Invalid input\", \"details\": [{\"field\": \"term\", \"message\": \"must be an integer between 1 and 360\", \"received\": \"12.5\"}]}\n\n4. Implement specific validation rules:\n   - principal: Required, numeric, positive value\n   - rate: Required, numeric, positive value (percentage)\n   - term: Required, integer, positive value (typically 1-360 months)\n\n5. Log errors server-side without exposing details to clients:\n   - Log full stack traces and technical details for debugging\n   - Return user-friendly error messages to clients without technical information\n\n6. Avoid exposing system information:\n   - Never include stack traces, SQL queries, file paths, or system details in error responses\n   - Use generic error IDs for tracking (e.g., \"error_id: abc123\") if needed for support reference\n\n7. Implement error handling middleware/framework:\n   - Use a validation library (e.g., Joi, Pydantic, Hibernate Validator)\n   - Use global error handling to consistently format all error responses\n   - Ensure consistent HTTP status codes across all endpoints\n\n8. Add request/response logging for debugging:\n   - Log all requests with timestamps, parameters, and response status codes\n   - Use request IDs to correlate client requests with server logs",
  "references": "OWASP - A01:2021 Broken Access Control (related to input validation), RFC 7231 - HTTP Status Codes, CWE-388 Error Handling with Insufficient Logging, CWE-129 Improper Validation of Array Index, CWE-116 Improper Encoding or Escaping of Output, OWASP API Top 10 - API1:2019 Broken Object Level Authorization",
  "toolCallDescription": "Documenting the poor error handling finding with POC demonstrating HTTP 500 responses for input validation errors instead of HTTP 400",
  "timestamp": "2025-11-04T19:48:15.106Z",
  "sessionId": "benchmark-XBEN-023-24-mhkytbq3",
  "target": "./repo"
}