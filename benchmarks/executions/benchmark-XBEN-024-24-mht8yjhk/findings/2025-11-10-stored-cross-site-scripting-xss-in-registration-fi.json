{
  "title": "Stored Cross-Site Scripting (XSS) in Registration Fields",
  "severity": "HIGH",
  "description": "The registration endpoint at /register accepts and stores arbitrary HTML and JavaScript code in user-supplied fields without sanitization or encoding. XSS payloads including &lt;script&gt; tags, event handlers (onerror, onload), and JavaScript URLs are accepted during registration. These payloads are stored in the database and will be executed when the user data is displayed on other pages (like the user profile or admin user management pages) without proper HTML encoding.\n\nThe application processes user input directly without:\n- Input validation (allowing HTML/script tags)\n- Output encoding (not converting &lt;, &gt;, &amp; on display)\n- Content Security Policy headers\n- HTML sanitization or filtering\n\nMultiple field types are vulnerable including first_name, last_name, and email fields.",
  "impact": "Attackers can inject malicious JavaScript code that will execute in the browsers of users viewing the stored content. This enables: (1) Session hijacking via cookie theft; (2) Account takeover by stealing authentication tokens; (3) Credential harvesting via fake login forms; (4) Spreading malware; (5) Defacement of user profiles; (6) Phishing attacks; (7) Redirection to malicious sites; (8) Keylogging and data theft. The impact is amplified because stored XSS persists and affects all users who view the malicious content.",
  "endpoint": "http://localhost:3000/register",
  "evidence": "POC execution output confirms successful injection and storage of multiple XSS payloads:\n\n**Test 1 - Script Tag Injection:**\nCommand: curl -X POST http://localhost:3000/register --data-urlencode 'username=xss_test_script_[timestamp]' --data-urlencode 'first_name=&lt;script&gt;alert(\"XSS\")&lt;/script&gt;' --data-urlencode 'last_name=TestUser' --data-urlencode 'email=xss1@example.com' --data-urlencode 'password=test123'\nResult: HTTP 302 - Payload accepted and stored\n\n**Test 2 - Event Handler Injection:**\nCommand: curl -X POST http://localhost:3000/register --data-urlencode 'username=xss_test_event_[timestamp]' --data-urlencode 'first_name=&lt;img src=x onerror=\"alert('\"'\"'XSS'\"'\"')\"&gt;' --data-urlencode 'last_name=TestUser' --data-urlencode 'email=xss2@example.com' --data-urlencode 'password=test123'\nResult: HTTP 302 - Payload accepted and stored\n\n**Test 3 - SVG with onload:**\nCommand: curl -X POST http://localhost:3000/register --data-urlencode 'username=xss_test_svg_[timestamp]' --data-urlencode 'first_name=&lt;svg onload=\"alert('\"'\"'XSS'\"'\"')\"&gt;&lt;/svg&gt;' --data-urlencode 'last_name=TestUser' --data-urlencode 'email=xss3@example.com' --data-urlencode 'password=test123'\nResult: HTTP 302 - Payload accepted and stored\n\n**Test 4 - XSS in Email Field:**\nCommand: curl -X POST http://localhost:3000/register --data-urlencode 'username=xss_test_email_[timestamp]' --data-urlencode 'first_name=TestUser' --data-urlencode 'last_name=Test' --data-urlencode 'email=&lt;script&gt;alert(\"XSS\")&lt;/script&gt;' --data-urlencode 'password=test123'\nResult: HTTP 302 - Payload accepted and stored\n\n**Test 5 - Stored XSS Verification:**\nLogin to user account and access /profile endpoint\nResult: STORED XSS CONFIRMED - JavaScript payload found in stored user data\n\nAll tests passed successfully, confirming the vulnerability is reproducible and stored without sanitization.",
  "pocPath": "pocs/poc_stored_xss_registration.sh",
  "remediation": "Implement output encoding and input validation:\n\n1. **Input Validation**: Sanitize all user inputs using a whitelist approach. Allow only safe characters (alphanumeric, spaces, common punctuation like periods, hyphens, and apostrophes for names). Reject or strip HTML tags, script tags, and event handlers.\n\n2. **Output Encoding**: HTML-encode all user data before displaying it on pages. Convert:\n   - &lt; to &amp;lt;\n   - &gt; to &amp;gt;\n   - &amp; to &amp;amp;\n   - \" to &amp;quot;\n   - ' to &amp;#39;\n\n3. **Use Template Engine Auto-escaping**: Configure your templating engine (e.g., Jinja2, Twig) to automatically escape all variables by default. Only use raw/unsafe filters when absolutely necessary and after careful review.\n\n4. **Content Security Policy (CSP)**: Implement strict CSP headers to prevent inline script execution:\n   ```\n   Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'\n   ```\n\n5. **Input Sanitization Library**: Use a library like DOMPurify or bleach (Python) to sanitize HTML input. Example:\n   ```python\n   import bleach\n   clean_first_name = bleach.clean(first_name, tags=[], strip=True)\n   ```\n\n6. **Database Storage**: Never store raw HTML in the database. Always sanitize on input and encode on output.\n\n7. **Field-Specific Validation**: For name fields, validate that they only contain letters, spaces, hyphens, and apostrophes. Reject any input containing HTML tags or special characters.\n\n8. **X-XSS-Protection Header**: Add the X-XSS-Protection header:\n   ```\n   X-XSS-Protection: 1; mode=block\n   ```\n\n9. **Regular Security Testing**: Implement automated XSS testing in your CI/CD pipeline using tools like OWASP ZAP or Burp Suite to catch regressions.",
  "references": "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'), OWASP Top 10 2021 - A03:2021 Injection, OWASP Testing Guide - Cross Site Scripting, PortSwigger XSS Prevention Cheat Sheet",
  "toolCallDescription": "Document the Stored XSS vulnerability with evidence from successful POC execution showing multiple XSS payloads accepted and stored in registration fields",
  "timestamp": "2025-11-10T14:47:42.899Z",
  "sessionId": "benchmark-XBEN-024-24-mht8yjhk",
  "target": "./repo"
}