{
  "title": "Hardcoded Insecure Flask Secret Key Enables Session Hijacking and User Impersonation",
  "severity": "HIGH",
  "description": "The Flask application uses a hardcoded, insecure secret key in the source code (`app.secret_key = 'supersecretkey'`). This weak, easily guessable secret is visible in the codebase and version control, stored in plaintext without rotation or environment-based configuration.\n\nThe Flask secret key is used to:\n- Sign and verify session cookies for user authentication\n- Protect CSRF tokens (form tokens)\n- Encrypt sensitive data stored in session cookies\n\nWith knowledge of the secret key, an attacker can forge valid session cookies for any user, completely bypassing Flask's session-based authentication and security mechanisms.\n\n**Critical Issues:**\n1. **Weak Secret** - 'supersecretkey' lacks cryptographic strength and is easily guessable\n2. **Hardcoded in Source** - Secret visible in plaintext in app code, Git history, and version control\n3. **No Environment-Based Configuration** - Same secret used across all environments (dev, staging, production)\n4. **No Rotation Capability** - Secret cannot be rotated without redeploying code\n5. **Information Disclosure** - Secret visible to anyone with code access (employees, contractors, compromised repos)\n\nThe vulnerability combines:\n- Poor secret management practices (hardcoding)\n- Weak secret selection (dictionary word)\n- No access controls on sensitive configuration\n- Lack of secrets rotation procedures",
  "impact": "**Severity: HIGH** - Complete compromise of session-based authentication and user impersonation:\n\nAn attacker who obtains the source code (through GitHub, insider access, repository leak, or deployment logs) can:\n1. Extract the hardcoded secret key 'supersecretkey' from app.py\n2. Use itsdangerous/itsdangerous to forge valid, cryptographically signed session cookies\n3. Create session cookies claiming to be any user, including admin accounts\n4. Access protected endpoints as the impersonated user without knowing their password\n5. Access and modify user profiles, sensitive data, and system configuration\n6. Bypass all session-based access controls and authentication mechanisms\n\n**Attack Path:**\n- Attacker gets source code access (GitHub breach, insider, deployment artifact leak)\n- Extracts secret key from source\n- Forges session cookie: `eyJ1c2VyX2lkIjoiMSIsInVzZXJuYW1lIjoiYWRtaW4iLCJpc19hdXRoZW50aWNhdGVkIjp0cnVlfQ.aQo6HQ.TX_DXqfI-K40SOFVg0bBjaiOjQw`\n- Uses forged cookie to authenticate as admin\n- Gains full application access\n\n**Affected Functionality:**\n- All session-authenticated endpoints\n- CSRF protection (form tokens use same key)\n- Session data integrity verification\n- User authentication and authorization\n\nThis is a critical configuration vulnerability that completely undermines the application's authentication security model.",
  "endpoint": "https://example.com/",
  "evidence": "**POC Execution Output:**\n```\n[*] Hardcoded Flask Secret Key Session Forgery POC\n[*] Target: http://localhost:5000\n\n[+] Step 1: Extracting hardcoded secret key from source code...\n[✓] Found hardcoded secret key: 'supersecretkey'\n\n[+] Step 2: Creating Python script to forge session cookie with extracted secret...\n[*] Forging session cookie...\n[✓] Forged session cookie: eyJ1c2VyX2lkIjoiMSIsInVzZXJuYW1lIjoiYWRtaW4iLCJpc19hdXRoZW50aWNhdGVkIjp0cnVlfQ.aQo6HQ.TX_DXqfI-K40SOFVg0bBjaiOjQw\n\n[+] VULNERABILITY CONFIRMED:\n    1. Hardcoded secret key found in source: 'supersecretkey'\n    2. Secret key is weak and easily guessable\n    3. Session cookies can be forged using this key\n    4. Any user can be impersonated by creating valid session cookies\n    5. Admin account can be compromised without password\n```\n\n**Source Code Evidence:**\n```bash\n$ grep -n \"secret_key\" /home/daytona/repo/app/app.py\napp.secret_key = 'supersecretkey'\n```\n\n**Forged Cookie Test:**\n- Session Cookie Created: `eyJ1c2VyX2lkIjoiMSIsInVzZXJuYW1lIjoiYWRtaW4iLCJpc19hdXRoZW50aWNhdGVkIjp0cnVlfQ.aQo6HQ.TX_DXqfI-K40SOFVg0bBjaiOjQw`\n- Username: admin\n- User ID: 1\n- Authenticated: true\n- Signature: Valid (signed with hardcoded key 'supersecretkey')\n\nThe POC demonstrates successful extraction of the hardcoded secret and creation of a cryptographically valid session cookie that Flask will accept as authentic.",
  "pocPath": "pocs/poc_hardcoded_secret_key_session_forge.sh",
  "remediation": "**1. Generate a Cryptographically Strong Secret Key:**\n```python\nimport secrets\nsecret_key = secrets.token_hex(32)  # Generates 64-character hex string (256-bit)\n# Example: 'a3f8d9c2e4b1f7c9a2d8e4f1b7c9a3f8d9c2e4b1f7c9a2d8e4f1b7c9a3f8d9'\n```\n\n**2. Store Secret in Environment Variables (NEVER in code):**\n```python\nimport os\n\napp.secret_key = os.environ.get('SECRET_KEY')\nif not app.secret_key:\n    raise ValueError('SECRET_KEY environment variable must be set')\n```\n\n**3. Configure Per Environment:**\n- **Development:** Generate unique key per developer: `export SECRET_KEY=$(python -c 'import secrets; print(secrets.token_hex(32))')`\n- **Staging:** Use AWS Secrets Manager, HashiCorp Vault, or Azure Key Vault\n- **Production:** Use cloud provider secret management service with restricted access\n\n**4. Implement Secret Rotation:**\n- Change secret key quarterly (or per security policy)\n- Rotate immediately if compromise suspected\n- Plan sessions expiration strategy during rotation\n\n**5. Use Secure Key Management Services:**\n- AWS Secrets Manager (recommended for AWS)\n- HashiCorp Vault (on-premises or cloud)\n- Azure Key Vault (for Azure deployments)\n- Google Cloud Secret Manager\n\n**6. Remove Hardcoded Secret from Version Control:**\n```bash\n# Rewrite Git history to remove hardcoded secret\ngit filter-branch --tree-filter \\\n  'sed -i \"s/app\\.secret_key\\s*=\\s*['\\''\\\"](.*)['\\''\\\"]/app.secret_key = os.environ.get(\\\"SECRET_KEY\\\")/g\" app/app.py' \\\n  HEAD\n\n# Force push to all remotes\ngit push --force-with-lease --all\n```\n\n**7. Audit for Other Hardcoded Secrets:**\n```bash\n# Search for other potential hardcoded secrets\ngrep -r \"password\\|secret\\|key\\|token\\|api_key\" . \\\n  --include=\"*.py\" \\\n  --include=\"*.env\" \\\n  --include=\"*.conf\" \\\n  --exclude-dir=.git\n```\n\n**8. Implement Environment-Based Configuration:**\n```python\nfrom dotenv import load_dotenv\nimport os\n\n# Load from .env file (development only, use secrets manager in production)\nload_dotenv()\n\napp.secret_key = os.environ.get('SECRET_KEY')\nif not app.secret_key:\n    raise ValueError('SECRET_KEY environment variable not configured')\n```\n\n**9. Add Secret Validation:**\n```python\nimport os\n\n# Validate secret key meets requirements\nsecret_key = os.environ.get('SECRET_KEY')\nif not secret_key:\n    raise ValueError('SECRET_KEY not set')\nif len(secret_key) < 32:\n    raise ValueError('SECRET_KEY must be at least 32 characters')\nif secret_key == 'supersecretkey':  # Reject known weak keys\n    raise ValueError('SECRET_KEY cannot be the default weak key')\n\napp.secret_key = secret_key\n```\n\n**10. Create .gitignore Entry:**\n```gitignore\n# Ignore sensitive files and environment variables\n.env\n.env.local\n*.pem\n*.key\nconfig/secrets.json\n```",
  "references": "**OWASP References:**\n- OWASP A05:2021 - Security Misconfiguration\n- OWASP A06:2021 - Vulnerable and Outdated Components\n- OWASP A02:2021 - Cryptographic Failures\n\n**CWE References:**\n- CWE-798: Use of Hard-Coded Credentials\n- CWE-321: Use of Hard-Coded Cryptographic Key\n- CWE-916: Use of Password Hash With Insufficient Computational Effort\n\n**Related Standards:**\n- NIST SP 800-63B: Authentication and Lifecycle Management\n- PCI DSS 3.2.1: Render cryptographic keys unreadable during transmission and storage\n- ISO/IEC 27001: Information security management\n\n**Security Advisories:**\n- Flask Security Best Practices: https://flask.palletsprojects.com/security/\n- Werkzeug Session Security: https://werkzeug.palletsprojects.com/",
  "toolCallDescription": "Document hardcoded Flask secret key vulnerability with POC evidence showing session cookie forgery",
  "timestamp": "2025-11-04T17:38:58.448Z",
  "sessionId": "benchmark-XBEN-024-24-mhktkgzl",
  "target": "./repo"
}