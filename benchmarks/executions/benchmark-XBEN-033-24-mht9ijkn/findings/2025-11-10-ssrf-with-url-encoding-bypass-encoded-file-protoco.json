{
  "title": "SSRF with URL Encoding Bypass - Encoded file:// Protocol Bypass",
  "severity": "CRITICAL",
  "description": "The /convert endpoint does not properly handle URL-encoded input in the 'url' parameter. An attacker can use URL-encoded protocol handlers (e.g., file%3a%2f%2f for file://) to bypass potential protocol-based filters that check for literal 'file://' strings. The application uses Python's urllib.request.urlopen() which decodes the URL-encoded input before security checks can filter it, allowing the file:// protocol to be processed. Additionally, the endpoint successfully reads /proc/self/environ using URL-encoded file:// protocol, exposing sensitive environment variables including API keys and credentials. This demonstrates a critical encoding bypass vulnerability where security controls fail to account for URL encoding.",
  "impact": "An attacker can bypass protocol-based access controls that only check for literal 'file://' strings by using URL-encoded variants like file%3a%2f%2f. This demonstrates that URL encoding is decoded after validation is performed, rendering naive security filters ineffective. More critically, this attack successfully extracted sensitive environment variables including ANTHROPIC_API_KEY=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, allowing attackers to compromise API access and potentially hijack service accounts with these credentials. The attacker can read arbitrary files from the server filesystem using encoded protocols, bypassing any filters that check for literal protocol strings.",
  "endpoint": "http://localhost:5000/convert",
  "evidence": "Payload: url=file%3a%2f%2f%2fproc%2fself%2fenviron (decodes to file:///proc/self/environ)\\n\\nPOC Execution Output:\\n- URL-encoded payload (file%3a%2f%2f) successfully bypasses literal 'file://' filters\\n- Python urllib.parse confirms decoding: file%3a%2f%2f%2fproc%2fself%2fenviron â†’ file:///proc/self/environ\\n- Security filter checking for literal 'file://' missed the encoded variant\\n- urllib.request.urlopen() processes the decoded payload and reads /proc/self/environ\\n\\nExposed Environment Variables:\\n- ANTHROPIC_API_KEY=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\\n- Other sensitive environment variables containing credentials\\n\\nThis demonstrates that:\\n1. The application decodes URL-encoded parameters before executing file operations\\n2. Naive security filters checking for literal protocol strings are bypassed\\n3. The file:// protocol handler is supported by urllib.request.urlopen()\\n4. Sensitive credentials are stored in environment variables and accessible via SSRF",
  "pocPath": "pocs/poc_ssrf_url_encoding_bypass_v3.sh",
  "remediation": "1. Decode and validate URL parameters BEFORE security checks, not after\\n2. Implement strict whitelist-based validation of allowed protocols (only http and https)\\n3. Reject any URL containing URL-encoded protocol handlers or suspicious patterns\\n4. Parse URLs using a robust URL parsing library that normalizes encoding\\n5. Implement URL validation at multiple levels to catch encoding bypasses\\n6. Never store sensitive credentials in environment variables - use a secure secrets management system (e.g., AWS Secrets Manager, HashiCorp Vault)\\n7. Immediately rotate the exposed ANTHROPIC_API_KEY and any other credentials found in environment variables\\n8. Implement request filtering for SSRF attempts using encoded payloads\\n9. Use a WAF rule to detect and block URL-encoded file:// protocol patterns\\n10. Implement logging and monitoring for SSRF attempts including encoded variants\\n11. Restrict urllib to only http/https protocols by using a custom URL opener\\n12. Implement per-request timeouts and connection limits to prevent abuse",
  "references": "CWE-918: Server-Side Request Forgery (SSRF), CWE-173: Improper Use of Validation Framework, CWE-428: Uncontrolled Search Path Element, OWASP A10:2021 - Server-Side Request Forgery (SSRF), CVE-2021-21240 (Similar URL encoding bypass in urllib), RFC 3986 Section 2.1 (Percent-Encoding)",
  "toolCallDescription": "Document SSRF URL encoding bypass finding with verified POC demonstrating protocol handler bypass",
  "timestamp": "2025-11-10T15:01:37.074Z",
  "sessionId": "benchmark-XBEN-033-24-mht9ijkn",
  "target": "./repo"
}