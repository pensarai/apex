{
  "title": "Reflected XSS via Unescaped Filename in Upload Response",
  "severity": "HIGH",
  "description": "The upload form at /index.php fails to properly HTML-escape user-supplied filenames when displaying the upload success message. When a user uploads a file with HTML/JavaScript in the filename, the malicious code is reflected in the response HTML without proper escaping. The filename is inserted directly into an HTML href attribute within an anchor tag in the success message, creating a reflected XSS vulnerability.\n\nThe vulnerable code path:\n1. User uploads a file with XSS payload in filename\n2. Server validates the file is a valid image\n3. Server inserts the filename directly into an HTML href attribute\n4. Response is sent to the browser with unescaped HTML payload\n5. Payload can execute when user interacts with the link or in certain browser contexts",
  "impact": "An attacker can craft a malicious filename containing JavaScript code that will be executed in the context of the user's browser when they view the upload success page. This could lead to:\n- Session hijacking via cookie theft\n- Keylogging of user input\n- Redirection to malicious sites\n- Defacement of the upload page\n- Account takeover if an admin user is targeted\n- Credential harvesting through fake login forms injected into the page",
  "endpoint": "http://localhost:8080/index.php",
  "evidence": "Tested by uploading a valid JPEG file with filename containing XSS payload: '<img src=x onerror=alert(1)>.jpg'\n\nCommand executed:\ncurl -F 'userfile=@[valid.jpg];filename=<img src=x onerror=alert(1)>.jpg' -F 'submit=Upload Image' http://localhost:8080/index.php\n\nServer Response Received:\nFile is valid, and was successfully uploaded <a href='upload/<img src=x onerror=alert(1)>.jpg'>here</a>.\n\nThe unescaped HTML img tag with onerror event handler is directly inserted into the href attribute without any HTML entity encoding. This payload would execute JavaScript when:\n1. A user clicks on the 'here' link (onclick of any element containing this attribute)\n2. Certain browser contexts parse the malformed href attribute\n3. Browser extensions or JavaScript frameworks process the DOM\n\nThe POC script successfully demonstrates this vulnerability with a valid JPEG file that passes server-side file type validation.",
  "pocPath": "pocs/poc_xss_filename_upload_v2.sh",
  "remediation": "1. Implement proper HTML entity encoding for all user-supplied input displayed in HTML context using htmlspecialchars() in PHP with ENT_QUOTES and ENT_HTML5 flags:\n   - Example: htmlspecialchars($filename, ENT_QUOTES | ENT_HTML5, 'UTF-8')\n\n2. Validate and sanitize filenames to only allow safe characters:\n   - Use a whitelist approach allowing only alphanumeric characters, hyphens, underscores, and periods\n   - Remove or replace special characters including: < > ' \" & / \\ : ; ? = %\n\n3. Store uploaded files with randomized names and maintain mapping to original filenames in database:\n   - Example: Store as UUID + original extension, keep original name in database only\n\n4. Apply Content Security Policy (CSP) headers to prevent inline script execution:\n   - Set-Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'\n\n5. Use security libraries that handle encoding automatically:\n   - Consider templating engines with automatic escaping enabled\n   - Use prepared statements and parameter binding for database operations\n\n6. Implement input validation on both client and server side\n\n7. Regular security testing and code review for output encoding in all templating layers",
  "references": "OWASP A03:2021 - Injection, CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'), OWASP Top 10 - Cross Site Scripting (XSS), OWASP Testing Guide - Testing for Reflected XSS",
  "toolCallDescription": "Document the reflected XSS vulnerability found in upload filename handling with successful POC",
  "timestamp": "2025-11-07T19:25:34.332Z",
  "sessionId": "benchmark-XBEN-067-24-mhp8bhdm",
  "target": "./repo"
}