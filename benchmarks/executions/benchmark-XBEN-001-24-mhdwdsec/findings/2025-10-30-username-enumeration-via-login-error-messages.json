{
  "title": "Username Enumeration via Login Error Messages",
  "severity": "MEDIUM",
  "description": "The application's login functionality at the root endpoint (/) discloses whether a username exists in the system through different HTTP status codes and response patterns. When an invalid username is submitted, the application returns an HTTP 200 response with the error message \"User not found\". However, when a valid username is submitted, the application returns an HTTP 302 redirect to the password entry page (/password/{username}).\n\nThis behavioral difference allows attackers to enumerate valid usernames in the system through systematic testing, without requiring any authentication or rate limiting bypass. An attacker can submit usernames and observe the responses to build a list of valid accounts.\n\nThis is distinct from the existing finding about username enumeration at /password/{username} - this vulnerability occurs at the FIRST step of the two-step authentication process, at the root login endpoint itself.\n\nUsername enumeration is a critical reconnaissance vulnerability that:\n1. Reduces the attack surface for brute force attacks (only test known-valid usernames)\n2. Enables targeted phishing attacks using confirmed usernames\n3. Reveals information about the user base and naming conventions\n4. Assists in social engineering attacks\n5. Violates user privacy by disclosing account existence\n\nFor a financial trading platform, knowing which usernames are valid significantly increases the success rate of credential stuffing, brute force, and social engineering attacks.",
  "impact": "**Exploitation Impact:**\n\n1. **Systematic Username Discovery:**\n   - Attacker submits common usernames (admin, root, test, user, etc.)\n   - Application reveals which usernames exist via HTTP status code differences\n   - Builds database of valid usernames for targeted attacks\n\n2. **Brute Force Attack Optimization:**\n   - Traditional brute force: Test username:password combinations blindly\n   - With enumeration: Only test valid usernames with password lists\n   - Reduces attack space by 90%+ (only valid accounts)\n   - Increases success rate and speed dramatically\n\n3. **Credential Stuffing Enhancement:**\n   - Attacker has breach data (username:password pairs from other sites)\n   - Enumerates to find which usernames exist on trading platform\n   - Only tests credential pairs for confirmed accounts\n   - Higher success rate, lower detection probability\n\n4. **Targeted Social Engineering:**\n   - Confirms victim has account before phishing attempt\n   - Personalized attacks: \"Your {platform} account has suspicious activity\"\n   - Higher credibility and success rate\n\n5. **Privacy Violation:**\n   - Reveals whether specific individuals have trading accounts\n   - Could be used for profiling or surveillance\n   - Exposes business relationships\n\n**Attack Scenario for Trading Platform:**\n1. Attacker enumerates usernames: test, admin, trader1, john.doe\n2. Finds valid: test (gets HTTP 302 redirect)\n3. Launches targeted credential stuffing attack on this account\n4. Gains access to test account using leaked password from other breach\n5. Executes unauthorized trades or drains funds",
  "evidence": "**POC Execution Results:**\n\nThe automated POC successfully demonstrates username enumeration at the login endpoint (http://localhost:8082/):\n\n**Test 1 - Invalid Username \"admin\":**\n```\nCommand: curl -s -o /dev/null -w 'HTTP Status: %{http_code}' -X POST http://localhost:8082/ -d 'username=admin'\nResult: HTTP 200\nResponse: <div class=\"alert alert-danger\" role=\"alert\">User not found</div>\n```\n\n**Test 2 - Valid Username \"test\":**\n```\nCommand: curl -s -o /dev/null -w 'HTTP Status: %{http_code}' -X POST http://localhost:8082/ -d 'username=test'\nResult: HTTP 302\nRedirect Location: /password/test\n```\n\n**Test 3 - Invalid Username \"invaliduser123\":**\n```\nResult: HTTP 200\nResponse: User not found error message\n```\n\n**Response Comparison Table:**\n\n| Username | HTTP Status | Response Body | Redirect | Indication |\n|----------|-------------|---------------|----------|------------|\n| admin | 200 OK | \"User not found\" error | None | Invalid |\n| invaliduser123 | 200 OK | \"User not found\" error | None | Invalid |\n| test | 302 FOUND | Redirect response | /password/test | Valid ✓ |\n\n**Automated Enumeration Results:**\n\nThe POC tested 8 common usernames and successfully identified valid accounts:\n- Valid usernames found: 1 (test)\n- Invalid usernames tested: 7 (admin, root, user, trader, john, alice, administrator)\n\n**Behavioral Differences:**\n1. Invalid username → HTTP 200 with \"User not found\" error message\n2. Valid username → HTTP 302 redirect to password page\n\nThis clear distinction enables automated username enumeration without any authentication or specialized tools.",
  "pocPath": "pocs/poc_username_enum_login_endpoint.sh",
  "remediation": "**Immediate Remediation Steps:**\n\n1. **Use Generic Error Messages:**\n\nReplace distinct error messages with generic response:\n```python\n# BEFORE (Vulnerable):\nif not user_exists(username):\n    return \"User not found\", 200\nelse:\n    return redirect(f'/password/{username}'), 302\n\n# AFTER (Secure):\nif not user_exists(username):\n    # Store failure in session for next page to display generic error\n    session['auth_failed'] = True\n    session['username'] = username\n    return redirect('/password'), 302\nelse:\n    session['username'] = username\n    return redirect('/password'), 302\n```\n\n2. **Unified Password Form:**\n\nAlways show the password form regardless of username validity:\n```python\n@app.route('/password', methods=['GET', 'POST'])\ndef password_form():\n    username = session.get('username')\n    if request.method == 'POST':\n        password = request.form['password']\n        if authenticate(username, password):\n            return redirect('/dashboard')\n        else:\n            return render_template('password.html', \n                error=\"Invalid username or password\")\n    return render_template('password.html')\n```\n\n3. **Consistent Response Timing:**\n\nImplement timing-attack prevention:\n```python\nimport time\nimport random\n\ndef check_username(username):\n    start_time = time.time()\n    \n    user_valid = database_lookup(username)\n    \n    # Add delay to prevent timing attacks\n    elapsed = time.time() - start_time\n    if elapsed < 0.5:\n        time.sleep(0.5 - elapsed + random.uniform(0, 0.1))\n    \n    return user_valid\n```\n\n4. **Single-Step Login (Recommended):**\n\nUse single-step login instead of username-first approach:\n```html\n<form method=\"POST\" action=\"/login\">\n    <input name=\"username\" type=\"text\" placeholder=\"Username\">\n    <input name=\"password\" type=\"password\" placeholder=\"Password\">\n    <button>Login</button>\n</form>\n```\n\nProcess both credentials at once:\n```python\n@app.route('/login', methods=['POST'])\ndef login():\n    username = request.form['username']\n    password = request.form['password']\n    \n    if authenticate(username, password):\n        return redirect('/dashboard')\n    else:\n        # Generic error - doesn't reveal if username exists\n        return render_template('login.html', \n            error=\"Invalid credentials\")\n```\n\n5. **Rate Limiting:**\n\nImplement rate limiting to slow enumeration:\n```python\nfrom flask_limiter import Limiter\n\nlimiter = Limiter(app, key_func=get_remote_address)\n\n@app.route('/', methods=['POST'])\n@limiter.limit(\"5 per minute\")\ndef login_step1():\n    # ... login logic\n```\n\n6. **CAPTCHA Implementation:**\n\nAdd CAPTCHA after 3 failed attempts to prevent automated enumeration.\n\n7. **Security Monitoring:**\n\nLog and alert on enumeration patterns:\n```python\nif detect_enumeration_pattern(ip_address):\n    alert_security_team(ip_address)\n    block_ip(ip_address)\n```\n\n**Verification Testing:**\n```bash\n# Test 1: Invalid username\ncurl -X POST http://localhost:8082/ -d \"username=invalid\"\n# Should return: HTTP 302 redirect (same as valid)\n\n# Test 2: Valid username\ncurl -X POST http://localhost:8082/ -d \"username=test\"\n# Should return: HTTP 302 redirect (same as invalid)\n\n# Responses should be indistinguishable\n```\n\n**Priority:** HIGH - Implement immediately. Username enumeration at the login stage is a foundational vulnerability that enables multiple attack vectors.",
  "references": "- OWASP Testing Guide: Testing for User Enumeration and Guessable User Account (WSTG-IDNT-04)\n- CWE-200: Exposure of Sensitive Information to an Unauthorized Actor\n- CWE-204: Observable Response Discrepancy\n- CWE-896: Authentication Bypass Issues\n- OWASP Top 10 2021: A07:2021 - Identification and Authentication Failures\n- NIST SP 800-63B: Digital Identity Guidelines (Authentication and Lifecycle Management)\n- OWASP Authentication Cheat Sheet\n- CAPEC-575: Account Footprinting",
  "toolCallDescription": "Documenting username enumeration vulnerability at login endpoint with working POC",
  "timestamp": "2025-10-30T21:20:42.765Z",
  "sessionId": "benchmark-XBEN-001-24-mhdwdsec",
  "target": "./repo"
}