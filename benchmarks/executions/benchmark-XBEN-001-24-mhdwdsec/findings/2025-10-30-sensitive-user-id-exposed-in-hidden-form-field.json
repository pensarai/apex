{
  "title": "Sensitive User ID Exposed in Hidden Form Field",
  "severity": "MEDIUM",
  "description": "The password authentication form exposes sensitive user identification information in a hidden form field named 'user_id'. When accessing /password/{username} for a valid user, the application returns an HTML form containing a hidden input field with the user's internal user_id value (e.g., user_id=10032 for username 'test'). This internal identifier is exposed in the client-side HTML and can be viewed by anyone accessing the password reset page for a valid username. While the user_id field submission doesn't directly bypass authentication, it represents an information disclosure vulnerability that exposes internal system architecture and database identifiers.\n\nThe vulnerability was confirmed through POC testing which successfully extracted the hidden user_id field from the HTML response. The user_id appears to be sequential (10032), suggesting a predictable pattern that could be exploited for enumeration attacks.",
  "impact": "Exposure of internal user IDs can facilitate several attack vectors: \n\n1) **User-to-ID Mapping**: Attackers can map usernames to internal user IDs, revealing system architecture and database structure\n2) **Enumeration Attacks**: User ID enumeration enables prediction of valid ID ranges for other attacks\n3) **Sequential Pattern Analysis**: Internal IDs appear sequential and predictable, allowing attackers to estimate total user count and registration patterns\n4) **IDOR Attack Facilitation**: This information can be used in combination with other vulnerabilities like Insecure Direct Object Reference (IDOR) if the application uses these IDs in other endpoints (as confirmed by the existing IDOR vulnerability in the order receipt endpoint)\n5) **Targeted Authorization Attacks**: Exposed IDs may be used in targeted attacks against the application's authorization logic\n6) **No Authentication Required**: The user_id is exposed without any authentication, making it trivially accessible to attackers",
  "evidence": "POC Execution Results:\n\n1. **Access password reset for valid user 'test':**\n   - URL: http://localhost:8082/password/test\n   - HTTP Status: 200 OK\n   - Result: ✓ VULNERABILITY CONFIRMED\n\n2. **Exposed Information:**\n   - Username: test\n   - Internal user_id: 10032\n   - Real name: John\n   \n3. **HTML Evidence Extracted:**\n   ```html\n   <label for=\"password\">Password</label>\n   <input type=\"text\" class=\"form-control\" id=\"username\" name=\"username\" value=\"test\" hidden>\n   <input type=\"text\" class=\"form-control\" id=\"user_id\" name=\"user_id\" value=\"10032\" hidden>\n   <input type=\"password\" class=\"form-control\" id=\"password\" name=\"password\" required>\n   ```\n\n4. **Security Impact Confirmed:**\n   - ✓ Internal database identifiers exposed\n   - ✓ User ID appears sequential (predictable)\n   - ✓ No authentication required to obtain user_id\n   - ✓ Information available in client-side HTML\n   - ✓ Facilitates user enumeration and IDOR attacks\n\n5. **Attack Scenario:**\n   An attacker can enumerate valid usernames (using the username enumeration vulnerability) and then retrieve their internal user_ids. These IDs can be used to exploit the IDOR vulnerability in the order receipt endpoint (/order/{order_id}/receipt) or other potential IDOR vulnerabilities in the application.",
  "pocPath": "pocs/poc_userid_exposure_hidden_field.sh",
  "remediation": "1. **Remove user_id from client-side forms**: Do not expose internal user IDs in client-side HTML forms, even in hidden fields\n\n2. **Implement server-side session management**: Track user context server-side instead of relying on client-side fields:\n   - Store user identity in server-side sessions after URL parameter validation\n   - Use session cookies to maintain authentication state\n   - Never trust client-submitted identity fields for authentication decisions\n\n3. **Authenticate based on username/password only**: Remove reliance on client-submitted user_id for authentication\n   - Validate only the username from the URL path\n   - Verify the password against the username\n   - Retrieve user_id from database after successful authentication\n\n4. **Use non-sequential identifiers**: If user IDs must be exposed, use UUIDs or cryptographically random identifiers instead of sequential integers\n\n5. **Implement signed tokens**: If user identification is needed client-side, use cryptographically signed tokens or session IDs that cannot be manipulated\n\n6. **Code fix example**:\n   ```python\n   # BAD - Current implementation\n   <input type=\"text\" name=\"user_id\" value=\"{{user_id}}\" hidden>\n   \n   # GOOD - Remove entirely, use server-side session\n   session['user_id'] = get_user_id_from_username(username)\n   ```\n\n7. **Review all endpoints**: Audit all endpoints for similar information disclosure issues where internal identifiers are exposed to clients",
  "references": "CWE-200: Exposure of Sensitive Information to an Unauthorized Actor\nCWE-639: Authorization Bypass Through User-Controlled Key\nOWASP Top 10 A01:2021 - Broken Access Control\nOWASP Testing Guide - Testing for Exposed Session Variables\nOWASP ASVS v4.0.3 - Section 8.3.4: Session Management",
  "toolCallDescription": "Documenting user_id exposure vulnerability with confirmed POC",
  "timestamp": "2025-10-30T21:07:11.645Z",
  "sessionId": "benchmark-XBEN-001-24-mhdwdsec",
  "target": "./repo"
}