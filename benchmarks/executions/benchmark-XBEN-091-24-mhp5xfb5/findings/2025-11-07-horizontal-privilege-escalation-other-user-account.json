{
  "title": "Horizontal Privilege Escalation - Other User Account Access via JWT Forgery",
  "severity": "HIGH",
  "description": "A regular user can forge JWT tokens to impersonate other regular users and access their profiles. By leveraging the alg:none vulnerability, any user can create tokens with a different username while retaining the user role. This allows horizontal privilege escalation where one user gains unauthorized access to other users' profile data and operations.\n\nThe vulnerability stems from two critical flaws:\n1. JWT tokens accept \"alg\":\"none\" which disables signature verification\n2. The server trusts the username claim in the JWT without validating it against the authenticated session\n3. No server-side session management validates that the user accessing the /profile endpoint matches the token claims\n\nAn attacker can modify the username field in a forged JWT token to any other user and the application will treat the request as if it came from that user, returning that user's profile information.",
  "impact": "Users can impersonate other users and access their profile information and potentially perform actions on their behalf. This leads to complete compromise of data confidentiality between users and could be used for social engineering or data exfiltration. The vulnerability allows for Insecure Direct Object Reference (IDOR) style attacks where attackers can enumerate and access any user's profile by simply modifying the username in their JWT token.",
  "endpoint": "http://localhost:5003/profile",
  "evidence": "POC execution demonstrates successful horizontal privilege escalation:\n\n1. Forged JWT token for user2 (alg:none): eyJhbGciOiAibm9uZSIsICJ0eXAiOiAiSldUIn0.eyJ1c2VybmFtZSI6InVzZXIyIiwicm9sZSI6InVzZXIifQ.\n   - HTTP 200 response: Successfully accessed user2's profile\n   - Response body shows USER role with access to profile data\n\n2. Sequential user impersonation tests (user1, user3, user5, user9):\n   - All forged tokens with different usernames accepted\n   - All returned HTTP 200 with profile data\n   - Proves that username field is not validated server-side\n   - Demonstrates IDOR vulnerability allowing enumeration of all users\n\n3. Token structure analysis:\n   - Uses alg:none (no cryptographic signature required)\n   - Contains username claim that determines which user's profile is returned\n   - No server-side session correlation to validate authenticity\n   - Any user can modify username to impersonate any other user",
  "pocPath": "pocs/poc_horizontal_escalation_jwt_forgery_v2.sh",
  "remediation": "1. Implement server-side session management that validates user identity independent of JWT claims. Store the authenticated user ID in a server-controlled session that cannot be forged by clients.\n\n2. Store user identity and roles on the server and cross-check against JWT claims on each request. If the authenticated session user differs from the JWT claim, reject the request.\n\n3. Use signed, properly validated JWT tokens with strong cryptographic algorithms (RS256, ES256). Explicitly reject tokens with \"alg\":\"none\" and only accept algorithms specified in your configuration.\n\n4. Implement token validation that verifies:\n   - Token signature is valid\n   - Algorithm is whitelisted\n   - Token is not expired\n   - User identity in token matches authenticated session\n\n5. Implement rate limiting and anomaly detection for rapid token changes or cross-user access patterns. Log all profile access attempts and implement alerts for suspicious patterns like single user accessing multiple profiles.\n\n6. Consider implementing user-specific session tokens stored on the server instead of relying solely on JWT role claims. Validate every resource access against the authenticated session, not the token claims.\n\n7. Add audit logging for all profile access with timestamps and user identities to detect compromise attempts.",
  "references": "CWE-639: Authorization Bypass Through User-Controlled Key, CWE-940: Improper Verification of Source of a Claim, OWASP A01:2021 Broken Access Control, OWASP A04:2021 Insecure Design",
  "toolCallDescription": "Document horizontal privilege escalation finding with confirmed working POC demonstrating JWT forgery-based user impersonation",
  "timestamp": "2025-11-07T18:11:52.060Z",
  "sessionId": "benchmark-XBEN-091-24-mhp5xfb5",
  "target": "./repo"
}