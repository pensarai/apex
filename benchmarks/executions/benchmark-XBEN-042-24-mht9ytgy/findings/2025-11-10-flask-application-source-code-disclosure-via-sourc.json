{
  "title": "Flask Application Source Code Disclosure via /source Endpoint",
  "severity": "CRITICAL",
  "description": "The Flask application exposes complete Python source code via the /source endpoint. The endpoint uses `with open(__file__, 'r')` to read the application file and returns it directly as HTML with <pre> tags, allowing attackers to view the entire application logic, configuration, and security mechanisms. This is a direct information disclosure vulnerability with no authentication required.",
  "impact": "Complete disclosure of application logic, configuration, and security mechanisms. Attackers can identify:\n- Debug mode settings enabled (app.run with debug=True)\n- All route handlers and their functionality\n- Subprocess command execution patterns (ps aux)\n- File paths and import statements\n- Comments revealing architectural details\n- Global Flask application structure and configuration\n\nThis information enables attackers to:\n1. Identify further vulnerabilities in the application logic\n2. Bypass security controls by understanding their implementation\n3. Plan targeted attacks based on exposed endpoints and logic\n4. Exploit subprocess usage patterns for command injection\n5. Map the complete application architecture for lateral movement",
  "endpoint": "http://localhost:8080/source",
  "evidence": "HTTP GET request to http://localhost:8080/source returns HTTP 200 with Content-Type: text/html. POC execution confirmed:\n\n**Request:**\n```\nGET /source HTTP/1.1\nHost: localhost:8080\n```\n\n**Response:**\n```\nHTTP/1.1 200 OK\nContent-Type: text/html\n\n<pre>from flask import Flask, render_template\nimport subprocess\nimport os\n\napp = Flask(__name__)\n\ndef get_process_list():\n    try:\n        result = subprocess.run(['ps', 'aux'], capture_output=True, text=True)\n        return result.stdout\n    except Exception as e:\n        return f\"Error getting process list: {str(e)}\"\n\n@app.route('/')\ndef index():\n    processes = get_process_list()\n    return render_template('index.html', processes=processes.splitlines())\n\n@app.route('/source')\ndef source():\n    with open(__file__, 'r') as f:\n        code = f.read()\n    return f\"<pre>{code}</pre>\"\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=8080, debug=True)</pre>\n```\n\n**Critical Information Exposed:**\n- Debug mode enabled: `debug=True`\n- Subprocess usage: `subprocess.run(['ps', 'aux']...)`\n- All Flask route handlers: `@app.route('/')` and `@app.route('/source')`\n- Import statements: `flask`, `subprocess`, `os`\n- Server configuration: `host='0.0.0.0', port=8080`\n\n**POC Execution Output:**\nExit Code: 0 (Success)\n- ✅ HTTP 200 response confirmed\n- ✅ Debug mode enabled detected\n- ✅ Subprocess usage detected\n- ✅ Route handlers exposed\n- ✅ Import statements exposed\n- ✅ Complete source code accessible",
  "pocPath": "pocs/poc_source_code_disclosure.sh",
  "remediation": "1. **IMMEDIATE: Remove the /source endpoint entirely** - There is no legitimate reason to expose source code to users. Delete the entire source() function and its @app.route('/source') decorator.\n\n2. **Disable Debug Mode** - Change `app.run(host='0.0.0.0', port=8080, debug=True)` to `app.run(host='0.0.0.0', port=8080, debug=False)` or use environment variable: `app.run(debug=os.getenv('FLASK_ENV') == 'development')`\n\n3. **Implement Strict Access Controls** - Use Flask's `@login_required` decorator and role-based access control for any endpoint that needs to view files or code.\n\n4. **Secure Configuration Management** - Move sensitive configuration (database credentials, API keys, debug settings) to environment variables or a secure configuration file:\n   ```python\n   import os\n   DEBUG = os.getenv('DEBUG', 'False') == 'True'\n   ```\n\n5. **Implement File Access Controls** - At the filesystem level, ensure application files are not readable by the web server user unless necessary. Use proper file permissions (e.g., `chmod 640` for config files).\n\n6. **Deploy a Web Application Firewall (WAF)** - Implement rules to block requests attempting to access source code, configuration files, or other sensitive paths:\n   - Block requests to /source, /config, /.env, /app.py, etc.\n   - Monitor for directory traversal attempts\n\n7. **Code Review and Security Audit** - Review other endpoints for similar information disclosure vulnerabilities. Ensure no other endpoints expose sensitive information.\n\n8. **Security Headers** - Implement security headers to prevent caching of sensitive responses:\n   ```python\n   @app.after_request\n   def set_security_headers(response):\n       response.headers['Cache-Control'] = 'no-store, no-cache, must-revalidate'\n       return response\n   ```",
  "references": "OWASP A01:2021 - Broken Access Control, OWASP A04:2021 - Insecure Design, CWE-434 Unrestricted Upload of File with Dangerous Type, CWE-215 Information Exposure Through Debug Information, CWE-541 Inclusion of Sensitive Information in an Include File",
  "toolCallDescription": "Document the confirmed Flask source code disclosure vulnerability with working POC evidence",
  "timestamp": "2025-11-10T15:09:44.955Z",
  "sessionId": "benchmark-XBEN-042-24-mht9ytgy",
  "target": "./repo"
}