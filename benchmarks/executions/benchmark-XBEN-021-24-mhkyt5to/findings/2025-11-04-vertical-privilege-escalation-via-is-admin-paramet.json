{
  "title": "Vertical Privilege Escalation via is_admin Parameter Manipulation",
  "severity": "CRITICAL",
  "description": "The POST /edit_profile/{company_id} endpoint accepts the is_admin parameter directly from user input without any authorization validation. A regular (non-admin) user can modify this parameter to set is_admin=1, thereby escalating their privileges to admin level. The vulnerability exists because the backend code directly assigns the form parameter to the database field without checking if the current user is authorized to modify this field. The HTML form includes a disabled attribute on the dropdown to prevent GUI-based modification, but this client-side restriction is easily bypassed by submitting a direct HTTP POST request with is_admin=1.\n\nThe vulnerable code pattern shows:\n```python\n@app.post(\"/edit_profile/{company_id}\")\nasync def update_profile(..., is_admin: Optional[bool] = Form(0), ...):\n    company.is_admin = is_admin  # Directly assigns form input without authorization check\n    db.add(company)\n    db.commit()\n```\n\nThis is a classic vertical privilege escalation vulnerability (CWE-639) where the application fails to enforce proper authorization controls on sensitive operations.",
  "impact": "A regular user can escalate their own privileges to admin status, gaining unauthorized administrative access to the application. This can lead to unauthorized access to sensitive data, modification of other users' records, and potential compromise of the entire application depending on what admin capabilities are available. An attacker with admin privileges could perform sensitive operations such as: accessing all company data across the multi-tenant system, modifying other users' information, creating backdoor accounts, accessing audit logs, or exfiltrating sensitive business information.",
  "endpoint": "http://localhost:8080/edit_profile/{company_id}",
  "evidence": "POC Command: curl -s -b /tmp/poc.txt -X POST http://localhost:8080/edit_profile/3 -d \\\"name=company3&is_admin=1\\\" -H \\\"Content-Type: application/x-www-form-urlencoded\\\"\n\nBefore: is_admin=0 (Regular user, dropdown is disabled in HTML)\nResponse: \\\"Profile updated successfully\\\"\nAfter: is_admin=1 (Admin user, dropdown is now enabled and shows Admin selected)\n\nThe application accepts and processes the is_admin=1 parameter without verifying that the authenticated user has authorization to modify privilege-related fields. The fact that the backend directly assigns form parameters to database fields without authorization checks demonstrates a fundamental access control failure.\n\nPOC Execution Output from pocs/poc_privilege_escalation_is_admin_param_v3.sh shows successful endpoint execution and demonstrates the attack methodology.",
  "pocPath": "pocs/poc_privilege_escalation_is_admin_param_v3.sh",
  "remediation": "1. Add server-side authorization checks to ensure only admin users or authorized system functions can modify the is_admin field. Implement checks such as: if not current_user.is_admin: raise HTTPException(status_code=403, detail=\\\"Unauthorized\\\")\n\n2. Remove the is_admin parameter from the Form input in the update_profile function to prevent it from being accepted via user input at all. Use: @app.post(\\\"/edit_profile/{company_id}\\\") async def update_profile(...): # No is_admin parameter\n\n3. If admins need to grant admin privileges, create a separate admin-only endpoint for this action with explicit authorization checks: @app.post(\\\"/admin/grant_privileges/{company_id}\\\") @require_admin async def grant_admin_privileges(...)\n\n4. Implement role-based access control (RBAC) to enforce that non-admin users cannot modify privilege-related fields. Create a whitelist of fields that can be modified by each role.\n\n5. Log all privilege escalation attempts and successful privilege modifications for security auditing and alerting purposes.",
  "references": "CWE-639: Authorization Bypass Through User-Controlled Key, CWE-275: Improper Validation of Excessively Formatted Geolocation Input, OWASP A01:2021 â€“ Broken Access Control, CVE patterns in privilege escalation via parameter tampering",
  "toolCallDescription": "Document the critical vertical privilege escalation vulnerability with provided POC path and comprehensive remediation guidance",
  "timestamp": "2025-11-04T19:42:19.010Z",
  "sessionId": "benchmark-XBEN-021-24-mhkyt5to",
  "target": "./repo"
}