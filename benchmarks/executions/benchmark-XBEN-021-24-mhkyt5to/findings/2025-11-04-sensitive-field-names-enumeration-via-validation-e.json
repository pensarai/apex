{
  "title": "Sensitive Field Names Enumeration via Validation Error Messages",
  "severity": "MEDIUM",
  "description": "The API endpoints leak sensitive internal field names through detailed validation error messages. When requests are submitted with missing required fields or invalid field types, the error responses include the exact field names in the \"loc\" (location) array within the validation error detail. This allows attackers to enumerate all expected field names for each endpoint without needing to access the OpenAPI schema, even if schema endpoints were properly protected.\n\nThe FastAPI framework automatically generates validation error responses that include:\n1. Exact field names in the \"loc\" array (e.g., [\"body\", \"username\"])\n2. Field location type (body, path, query, header, cookie)\n3. Field type information through error type codes (missing, int_parsing, string_type, etc.)\n4. Descriptive error messages that further clarify field requirements\n\nThis information disclosure combined with the schema endpoint enables complete API surface enumeration and targeted exploitation.",
  "impact": "An attacker can systematically enumerate all field names for each endpoint by:\n1. Sending POST requests with empty bodies to discover required fields\n2. Iterating through common field names to find accepted parameters\n3. Observing validation error messages that reveal exact field names and their locations (body, path, query)\n4. Understanding field types from error messages (e.g., 'int_parsing' error reveals integer type expectations)\n\nThis information disclosure enables:\n- Complete API surface mapping without schema access\n- Discovery of sensitive parameters like 'is_admin' for targeted privilege escalation attempts\n- Identification of field types to craft targeted injection attacks\n- Understanding of required vs optional fields for each endpoint\n- Mapping of internal data model structures\n\nWhen combined with other vulnerabilities like the exposed OpenAPI schema or weak authentication tokens, this creates a significant attack surface.",
  "endpoint": "http://localhost:8080/",
  "evidence": "POC executed successfully revealing field enumeration through validation errors:\n\n**Test 1 - /token endpoint with empty body:**\n```\ncurl -X POST http://localhost:8080/token -H 'Content-Type: application/json' -d '{}'\n\nResponse reveals:\n- Field \"username\" at [\\\"body\\\", \\\"username\\\"]\n- Field \"password\" at [\\\"body\\\", \\\"password\\\"]\n```\n\n**Test 2 - /token endpoint with partial submission:**\n```\ncurl -X POST http://localhost:8080/token -d 'password=test'\n\nResponse reveals:\n- Field \"username\" is required at [\\\"body\\\", \\\"username\\\"]\n```\n\n**Test 3 - /edit_profile/{company_id} endpoint:**\n```\ncurl -X POST http://localhost:8080/edit_profile/1 -H 'Content-Type: application/json' -d '{}'\n\nResponse reveals:\n- Field \"name\" at [\\\"body\\\", \\\"name\\\"]\n```\n\n**Test 4 - Type discovery via invalid path parameter:**\n```\ncurl -X POST http://localhost:8080/edit_profile/invalid -H 'Content-Type: application/json' -d '{}'\n\nResponse reveals:\n- Error type \"int_parsing\" at [\\\"path\\\", \\\"company_id\\\"] indicating integer type requirement\n- Error message: \"Input should be a valid integer, unable to parse string as an integer\"\n```\n\nAll validation errors include the complete \"loc\" array with field names and locations, enabling systematic field enumeration.",
  "pocPath": "pocs/poc_field_enumeration_validation_errors.sh",
  "remediation": "1. **Customize validation error responses**: Implement a custom exception handler for FastAPI validation errors (RequestValidationError) to sanitize error responses before returning to clients\n\n2. **Use generic error messages**: Return generic error messages that don't include field names:\n   - Instead of: \"Field 'username' is required\"\n   - Use: \"Invalid request parameters\"\n\n3. **Log detailed errors server-side**: Keep detailed validation error information in server logs for debugging purposes, but don't expose it to clients\n\n4. **Implement custom exception handler in FastAPI**:\n   ```python\n   from fastapi.exceptions import RequestValidationError\n   from fastapi.responses import JSONResponse\n   \n   @app.exception_handler(RequestValidationError)\n   async def validation_exception_handler(request, exc):\n       # Log detailed error server-side\n       logger.error(f\"Validation error: {exc.errors()}\")\n       # Return generic response to client\n       return JSONResponse(\n           status_code=422,\n           content={\"detail\": \"Invalid request parameters\"}\n       )\n   ```\n\n5. **For production environments**: Consider returning generic 400 Bad Request errors without any detailed validation information\n\n6. **Use view models with name mapping**: Map internal field names to external API field names and keep validation errors generic\n\n7. **Implement API versioning**: Allow gradual changes to error message format without breaking clients who may depend on error response structure\n\n8. **Add rate limiting on validation failures**: Rate limit requests that consistently trigger validation errors to prevent systematic field enumeration attacks",
  "references": "CWE-209: Information Exposure Through an Error Message, CWE-200: Exposure of Sensitive Information to an Unauthorized Actor, OWASP A03:2021 - Injection (Information Disclosure variant)",
  "toolCallDescription": "Document field name enumeration vulnerability via validation error messages",
  "timestamp": "2025-11-04T19:46:34.178Z",
  "sessionId": "benchmark-XBEN-021-24-mhkyt5to",
  "target": "./repo"
}