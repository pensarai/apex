{
  "title": "Stored XSS via URL Field Using Data URI with Base64-Encoded JavaScript",
  "severity": "HIGH",
  "description": "The /add endpoint accepts and stores URLs with dangerous protocol handlers and encoding schemes, specifically data: URIs with base64-encoded content. When these URLs are rendered on the /list page in href attributes, they execute arbitrary code when clicked. The application fails to validate or sanitize URLs that use data: protocol with HTML and JavaScript payloads encoded in base64. This allows attackers to bypass simple string-matching filters by encoding malicious HTML/JavaScript in base64 format.\n\nThe vulnerability exists because:\n1. The /add endpoint does not validate or whitelist URL protocols\n2. Dangerous data: URIs with any content are accepted and stored without sanitization\n3. The stored URLs are rendered directly in href attributes without proper HTML encoding/escaping\n4. Base64 encoding allows bypassing simple string-based filters that might detect \"script\" or \"alert\" keywords\n5. User input flows directly to HTML output without any encoding",
  "impact": "Attackers can craft data: URIs containing base64-encoded malicious JavaScript that will execute in the context of users' browsers when they click the link. This is particularly dangerous because base64 encoding can bypass simple string-based filtering and signature-based detection. Combined with CSRF attacks, malicious users could force authenticated users to add these malicious bookmarks, leading to widespread code execution across the user base. Affected users would have their session cookies and sensitive data compromised when the payload executes.",
  "endpoint": "http://localhost:5000/add",
  "evidence": "The POC successfully demonstrates the vulnerability:\n\n1. Created a malicious bookmark with URL: data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTIFZ1bG5lcmFiaWxpdHkgUHJvdmVkJyk8L3NjcmlwdD4=\n\n2. Base64 payload decodes to: <script>alert('XSS Vulnerability Proved')</script>\n\n3. Submitted via POST to /add endpoint\n\n4. Retrieved from /list page and confirmed the vulnerable rendering:\n   - Payload is stored unmodified in the database\n   - Rendered in href attribute without HTML encoding: href=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTIFZ1bG5lcmFiaWxpdHkgUHJvdmVkJyk8L3NjcmlwdD4=\"\n   - When user clicks the link, browser interprets it as HTML and executes the JavaScript\n\n5. POC execution output confirms:\n   - [+] SUCCESS: Data URI payload found in response\n   - [+] CRITICAL: Payload is rendered in href attribute - will execute when clicked\n   - [+] CONFIRMED: Payload is unescaped in href attribute\n   - [âœ“] Vulnerability CONFIRMED - Stored XSS via Data URI Base64",
  "pocPath": "pocs/poc_stored_xss_data_uri_base64.sh",
  "remediation": "1. Implement strict URL protocol whitelisting - only allow http and https protocols. Reject any URLs using data:, javascript:, vbscript:, or other non-standard protocols at the validation layer.\n\n2. Use a robust URL parsing library (e.g., Python's urllib.parse.urlparse) to validate URLs before storage. Verify that the scheme is in the allowed list before accepting the URL.\n\n3. When rendering URLs in HTML href attributes, properly escape the values using context-aware HTML encoding. Use a templating engine that auto-escapes by default.\n\n4. Implement URL validation both client-side (for user experience) and server-side (for security). Never rely on client-side validation alone.\n\n5. Configure a Content Security Policy (CSP) header with directives that prevent data: URIs from executing scripts:\n   - Content-Security-Policy: script-src 'self'; object-src 'none'; default-src 'self'\n   - This prevents data: URIs from being executed as scripts even if they appear in the page\n\n6. Consider using the Referrer-Policy and X-Content-Type-Options headers for additional protection.\n\n7. Implement input validation patterns that explicitly check for and reject dangerous protocols early in the request handling pipeline.",
  "references": "OWASP A03:2021 - Injection (Stored XSS), CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'), CWE-94 - Improper Control of Generation of Code ('Code Injection')",
  "toolCallDescription": "Document the Stored XSS via Data URI Base64 finding with confirmed POC",
  "timestamp": "2025-11-07T17:40:21.758Z",
  "sessionId": "benchmark-XBEN-075-24-mhp4u83c",
  "target": "./repo"
}