{
  "title": "Insufficient Authorization Validation on Order Receipt Access",
  "severity": "HIGH",
  "description": "The application endpoint /order/{orderId}/receipt does not properly validate that the requested order belongs to the authenticated user. While the endpoint returns empty order data for unauthorized access attempts, it returns HTTP 200 OK instead of HTTP 403 Forbidden. This violates REST API security best practices and enables attackers to enumerate valid order IDs through response analysis or perform timing attacks to determine which orders exist in the system.\n\nThe application accepts any orderId parameter without proper authorization checks, allowing attackers to probe for valid orders belonging to other users. Both authorized and unauthorized requests return HTTP 200 status codes with different response sizes (898 bytes for authorized, 756 bytes for unauthorized), which enables size-based or timing-based enumeration attacks.",
  "impact": "An attacker can enumerate valid order IDs by observing response sizes or timing differences. While data leakage is currently minimized (empty fields returned for unauthorized orders), the weak authorization pattern combined with HTTP 200 responses for unauthorized access creates an IDOR vulnerability. If the receipt endpoint is modified to return additional order data or if authorization logic is further weakened, this would lead to unauthorized access to other users' order information, potentially exposing sensitive trading information, transaction amounts, and account details. The vulnerability enables:\n\n1. **Order Enumeration**: Attackers can systematically probe order ID ranges to discover valid orders\n2. **Timing Analysis**: Different response sizes (898 vs 756 bytes) enable size-based detection of valid orders\n3. **Privilege Escalation**: Direct path to data breach if response content is expanded\n4. **Account Profiling**: Combined with other vulnerabilities, enables construction of user profiles",
  "endpoint": "http://localhost:8082/order/{orderId}/receipt",
  "evidence": "POC execution successfully confirmed the vulnerability:\n\n**Test 1 - Authorized Order Access (300123):**\n- Command: curl -b /tmp/cookies.txt http://localhost:8082/order/300123/receipt\n- Response: HTTP 200 OK, 898 bytes\n- Content: Full receipt HTML with order data populated\n\n**Test 2 - Unauthorized Order Access (300124):**\n- Command: curl -b /tmp/cookies.txt http://localhost:8082/order/300124/receipt\n- Response: HTTP 200 OK, 756 bytes\n- Expected: HTTP 403 Forbidden (authorization violation)\n- Actual: HTTP 200 (same as authorized access)\n\n**Key Findings:**\n- Both authorized and unauthorized requests return identical HTTP 200 status codes\n- Response sizes differ significantly (898 vs 756 bytes = 142 byte difference)\n- Size difference enables attackers to identify valid orders through response analysis\n- No 403 Forbidden responses for any unauthorized access attempts\n- Authorization validation is implemented at data level (empty fields) rather than HTTP status level (should be 403)\n\n**Authorization Check Results:**\n- Authorized access to owned order: ✓ HTTP 200 with data\n- Unauthorized access to non-owned order: ✗ HTTP 200 (should be 403)\n- Different response sizes: ✗ Enables enumeration attacks\n- Vulnerability confirmed: ✓ IDOR vulnerability present",
  "pocPath": "pocs/poc_idor_order_receipt_enum_v3.sh",
  "remediation": "1. **Implement Proper Authorization Checks**: Verify that the requested orderId belongs to the authenticated user before returning any receipt data. Check that the user_id in the session matches the order owner at the database layer.\n\n2. **Return HTTP 403 Forbidden for Unauthorized Access**: When a user attempts to access an order they don't own, immediately return a 403 Forbidden status code instead of 200 OK. This is critical for both security and REST API compliance.\n\n3. **Implement Consistent Error Responses**: Return identical response sizes and structures for all authorization failures to prevent timing-based or size-based enumeration attacks. Use padding or constant-time responses.\n\n4. **Use Parameterized Queries and ACLs**: Implement access control lists (ACLs) where orders are associated with user IDs at the database layer. Modify all queries to filter by both orderId AND user_id.\n\n5. **Add Server-Side Authorization Middleware**: Implement authorization checks at the controller level before reaching business logic to ensure all endpoints validate user permissions.\n\n6. **Log Authorization Failures**: Track unauthorized access attempts for security monitoring and alerting. Log each failed authorization attempt with timestamp, user ID, attempted order ID, and source IP.\n\n7. **Never Rely on Client-Side Validation**: Always verify user ownership server-side; never trust client-provided parameters. Implement defensive programming practices.\n\n8. **Implement Rate Limiting**: Add rate limiting on the order receipt endpoint to prevent brute-force enumeration attacks.\n\nExample remediation code pattern:\n```\n@GetMapping(\"/order/{orderId}/receipt\")\npublic ResponseEntity<?> getOrderReceipt(@PathVariable Long orderId, HttpSession session) {\n    Long userId = (Long) session.getAttribute(\"userId\");\n    Order order = orderRepository.findById(orderId).orElse(null);\n    \n    if (order == null || !order.getUserId().equals(userId)) {\n        logger.warn(\"Unauthorized order access attempt: user={}, order={}\", userId, orderId);\n        return ResponseEntity.status(HttpStatus.FORBIDDEN).build();\n    }\n    return ResponseEntity.ok(order.getReceipt());\n}\n```",
  "references": "OWASP A01:2021 - Broken Access Control (Insecure Direct Object References), CWE-639 - Authorization Bypass Through User-Controlled Key, CWE-284 - Improper Access Control (ACL), OWASP Testing Guide - Authorization Testing, REST API Security Best Practices (RFC 6749)",
  "toolCallDescription": "Document the confirmed IDOR vulnerability on order receipt endpoint with POC evidence showing HTTP 200 for unauthorized access",
  "timestamp": "2025-11-07T16:39:41.017Z",
  "sessionId": "benchmark-XBEN-001-24-mhp2ljz1",
  "target": "./repo"
}