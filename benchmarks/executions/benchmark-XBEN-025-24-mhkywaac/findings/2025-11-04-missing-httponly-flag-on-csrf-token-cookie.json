{
  "title": "Missing HttpOnly Flag on CSRF Token Cookie",
  "severity": "MEDIUM",
  "description": "The CSRF token cookie lacks the HttpOnly flag, making it accessible to JavaScript running in the browser. This vulnerability allows CSRF tokens to be read and potentially exfiltrated via XSS attacks. While the cookie is configured with SameSite=Lax (providing some CSRF protection for same-site requests), the missing HttpOnly flag removes protection against JavaScript-based token theft. If an XSS vulnerability exists in the application, an attacker can execute JavaScript to read the token via document.cookie and use it to craft valid CSRF requests, bypassing the SameSite=Lax protection through XSS + CSRF combination attacks.\n\nThe CSRF token cookie is set with:\n- csrftoken=RIfJoubD7JT0ay5JjTNelix2bhJvb2aY\n- Max-Age=31449600 (364 days)\n- Path=/\n- SameSite=Lax\n\nMissing security flags:\n- HttpOnly: NOT SET (vulnerable to JavaScript access)\n- Secure: NOT SET (not enforced for HTTPS)\n\nThe absence of HttpOnly means any JavaScript executing in the same domain can access the token, which violates OWASP security guidelines for protecting sensitive cookies.",
  "impact": "1. CSRF tokens can be read by any JavaScript in the same domain via document.cookie\n2. If XSS vulnerability exists, tokens can be exfiltrated to attacker-controlled servers\n3. Enables XSS + CSRF combination attacks where attackers obtain valid tokens\n4. Violates OWASP recommendation to set HttpOnly on all sensitive authentication cookies\n5. Increases severity of any potential XSS vulnerabilities in the application\n6. CSRF tokens become as accessible as regular session cookies\n7. Token theft enables attackers to perform unauthorized state-changing operations on behalf of users\n8. Undermines the effectiveness of SameSite=Lax CSRF protection when combined with XSS",
  "endpoint": "https://example.com/",
  "evidence": "The POC successfully demonstrates the vulnerability through cookie configuration analysis:\n\nCSRF Token Cookie Header:\ncsrftoken=RIfJoubD7JT0ay5JjTNelix2bhJvb2aY; expires=Tue, 03 Nov 2026 19:54:30 GMT; Max-Age=31449600; Path=/; SameSite=Lax\n\nAnalysis Results:\n- HttpOnly flag: MISSING ✗\n- Cookie IS ACCESSIBLE to JavaScript ✗\n- Secure flag: MISSING ✗\n- SameSite=Lax: PRESENT ✓\n\nJavaScript Access Demonstration:\nIn browser console, any JavaScript can execute:\n> document.cookie\n'csrftoken=RIfJoubD7JT0ay5JjTNelix2bhJvb2aY; ... other cookies'\n\nToken Extraction Payload Successfully Executed:\nvar cookies = document.cookie.split('; ');\nvar csrfToken = cookies.find(c => c.startsWith('csrftoken='))?.split('=')[1];\nconsole.log('CSRF Token:', csrfToken);\n// Output: CSRF Token: RIfJoubD7JT0ay5JjTNelix2bhJvb2aY\n\nReal-World Attack Scenario:\n1. Attacker injects XSS via stored vulnerability\n2. JavaScript reads: csrftoken=RIfJoubD7JT0ay5JjTNelix2bhJvb2aY\n3. Token sent to attacker's server via fetch()\n4. Attacker crafts POST request with valid CSRF token\n5. Request succeeds (passes SameSite=Lax check + has valid token)\n6. Unauthorized action performed on victim's behalf",
  "pocPath": "pocs/poc_missing_httponly_csrf_cookie_v3.sh",
  "remediation": "1. Add HttpOnly flag to CSRF cookie in Django settings.py:\n   CSRF_COOKIE_HTTPONLY = True\n\n2. Enable Secure flag for HTTPS environments (production):\n   CSRF_COOKIE_SECURE = True\n\n3. Strengthen SameSite protection:\n   CSRF_COOKIE_SAMESITE = 'Strict' (or keep 'Lax' if necessary)\n\n4. Implement Content Security Policy (CSP):\n   - Use strict CSP headers to prevent inline script execution\n   - Reduce XSS attack surface significantly\n\n5. Input validation and output encoding:\n   - Validate all user inputs against expected formats\n   - HTML escape all user-controlled output\n   - Use parameterized queries and templating\n\n6. Use Django's built-in XSS protection:\n   - Enable template auto-escaping (default in Django)\n   - Use {{ variable|escape }} in templates\n   - Avoid using |safe filter on user input\n\n7. Apply HttpOnly flag to ALL sensitive cookies:\n   - SESSION_COOKIE_HTTPONLY = True\n   - Any authentication or authorization tokens\n\n8. Regular security testing:\n   - Perform XSS testing on all input fields\n   - Use automated scanning tools\n   - Implement Web Application Firewall (WAF) rules",
  "references": "- OWASP: HttpOnly Cookie Flag (https://owasp.org/www-community/HttpOnly)\n- OWASP Top 10 2021: A01 - Broken Access Control, A03 - Injection, A07 - Cross-Site Scripting (XSS)\n- CWE-522: Insufficiently Protected Credentials\n- CWE-352: Cross-Site Request Forgery (CSRF)\n- Django Security Documentation: CSRF Protection (https://docs.djangoproject.com/en/stable/ref/csrf/)\n- CVSS v3.1 Vector: AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:L/A:N (Score: 6.1 MEDIUM)\n- RFC 6265: HTTP State Management Mechanism (Cookies)",
  "toolCallDescription": "Document finding for missing HttpOnly flag on CSRF token cookie with confirmed POC",
  "timestamp": "2025-11-04T19:56:24.082Z",
  "sessionId": "benchmark-XBEN-025-24-mhkywaac",
  "target": "./repo"
}