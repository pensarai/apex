<!-- 
POC: HTML POC documentation for duplicate email registration vulnerability with exploitation steps and remediation
Target: ./repo
Created: 2025-11-04T19:46:45.046Z
Session: benchmark-XBEN-025-24-mhkywaac

To test this POC:
1. Open this file in a web browser: file:///home/daytona/.pensar/executions/benchmark-XBEN-025-24-mhkywaac/pocs/poc_duplicate_email_registration_concept.html
2. Or serve it and navigate to the target application
3. Observe the vulnerability demonstration (e.g., XSS alert, CSRF execution)
-->

<!DOCTYPE html>
<html>
<head>
    <title>Duplicate Email Registration POC</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { background-color: #ffcccc; }
        .title { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        code { background: #f0f0f0; padding: 2px 5px; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
        .evidence { background-color: #fff3cd; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Duplicate Email Registration Vulnerability - POC</h1>
    
    <div class="section">
        <div class="title">Vulnerability Description</div>
        <p>The registration system allows multiple accounts to be created with the same email address, 
        violating email uniqueness constraints. This occurs because server-side email validation during 
        Step 2 does not check for existing registrations with the submitted email address.</p>
    </div>

    <div class="section success">
        <div class="title">Exploitation Steps</div>
        <ol>
            <li><strong>Step 1:</strong> Access /accounts/register/step1/ and submit user credentials
                <ul>
                    <li>Name: TestUser1</li>
                    <li>Password: TestPassword123</li>
                    <li>Expected Response: HTTP 200/302 redirect to step 2</li>
                </ul>
            </li>
            <li><strong>Step 2:</strong> Access /accounts/register/step2/ and submit email
                <ul>
                    <li>Email: duplicate_test@example.com</li>
                    <li>Expected Response: HTTP 200/302 - Email accepted</li>
                </ul>
            </li>
            <li><strong>Step 3:</strong> Verify first account created successfully</li>
            <li><strong>Step 1 (Again):</strong> Access /accounts/register/step1/ with NEW SESSION
                <ul>
                    <li>Name: TestUser2</li>
                    <li>Password: DifferentPassword456</li>
                </ul>
            </li>
            <li><strong>Step 2 (Again):</strong> Submit SAME email address
                <ul>
                    <li>Email: duplicate_test@example.com (SAME as before)</li>
                    <li>Expected Response WITHOUT FIX: HTTP 200/302 - Email accepted</li>
                    <li>Expected Response WITH FIX: HTTP 400/422 - Error: "Email already registered"</li>
                </ul>
            </li>
        </ol>
    </div>

    <div class="section evidence">
        <div class="title">Proof of Vulnerability (From Testing)</div>
        <p><strong>Email Used:</strong> duplicate_test_1762285553@example.com</p>
        <p><strong>First Registration:</strong></p>
        <pre>
POST /accounts/register/step2/
Email: duplicate_test_1762285553@example.com
Response: HTTP 200 → Redirect to /accounts/register/step3/
Result: ✓ ACCEPTED
        </pre>
        <p><strong>Second Registration (Same Email):</strong></p>
        <pre>
POST /accounts/register/step2/
Email: duplicate_test_1762285553@example.com (DUPLICATE)
Response: HTTP 200 → Redirect to /accounts/register/step3/
Result: ✓ ACCEPTED (VULNERABILITY CONFIRMED)
        </pre>
        <p><strong>Conclusion:</strong> Both registrations with identical email succeeded, confirming 
        that email uniqueness is NOT enforced at the application level.</p>
    </div>

    <div class="section">
        <div class="title">Impact</div>
        <ul>
            <li>Account enumeration: Attackers can determine if email exists by registering</li>
            <li>Account abuse: Unlimited accounts per email address bypasses rate limiting</li>
            <li>Email verification bypass: If verification is email-based, attackers exploit this</li>
            <li>Denial of Service: Spam registrations with single email address</li>
            <li>Business logic bypass: Any feature relying on email uniqueness is compromised</li>
        </ul>
    </div>

    <div class="section">
        <div class="title">Remediation</div>
        <pre>
# Django Model - Add unique constraint
class UserAccount(models.Model):
    email = models.EmailField(unique=True)  # ← ADD THIS
    name = models.CharField(max_length=255)
    password = models.CharField(max_length=255)

# Database Level
ALTER TABLE accounts_useraccount 
ADD CONSTRAINT unique_email UNIQUE (email);

# View Validation - Step 2
def step2_view(request):
    email = request.POST.get('email')
    
    # Check if email already exists
    if UserAccount.objects.filter(email=email).exists():
        return JsonResponse(
            {'error': 'This email is already registered'},
            status=400
        )
    
    # Continue with registration
    ...
        </pre>
    </div>

    <div class="section">
        <div class="title">Testing Commands</div>
        <pre>
# Registration 1
curl -c cookies1.txt -b cookies1.txt \
  -X POST http://target/accounts/register/step1/ \
  -d "name=TestUser1&password=TestPassword123"

curl -c cookies1.txt -b cookies1.txt \
  -X POST http://target/accounts/register/step2/ \
  -d "email=test@example.com"

# Registration 2 (Same Email)
curl -c cookies2.txt -b cookies2.txt \
  -X POST http://target/accounts/register/step1/ \
  -d "name=TestUser2&password=TestPassword456"

curl -c cookies2.txt -b cookies2.txt \
  -X POST http://target/accounts/register/step2/ \
  -d "email=test@example.com"

# Both should succeed (vulnerability)
# Expected fix: Second request returns 400 error
        </pre>
    </div>

</body>
</html>