{
  "title": "NoSQL Injection in Contact Form Name Field",
  "severity": "HIGH",
  "description": "The contact form's name field is vulnerable to NoSQL injection attacks. The application attempts to process the 'name' parameter as a string but fails to validate that it receives a string value. When an attacker sends an array parameter (e.g., name[$ne]=), the application attempts to pass this to htmlspecialchars() on line 25, which expects a string but receives an array, causing a PHP warning. This indicates the parameter is being processed without proper type validation and could be used for NoSQL query manipulation if the backend uses a NoSQL database like MongoDB. Array parameter handling in this manner suggests the backend stores queries using NoSQL operators, making the application vulnerable to operator injection attacks.",
  "impact": "An attacker could manipulate NoSQL queries to bypass authentication, extract sensitive data from the database, modify database records, or perform privilege escalation attacks. The ability to pass array parameters to database queries enables attackers to inject NoSQL operators ($ne, $gt, $regex, $or, etc.) to manipulate query logic. This could lead to unauthorized data access, data manipulation, or complete database compromise depending on database permissions and how queries are constructed.",
  "endpoint": "http://localhost/contact.php",
  "evidence": "The POC demonstrates the vulnerability through two key observations:\n\n1. **Array Parameter Processing**: When the name field receives an array parameter (name[$ne]=), the application processes it without type validation, causing PHP to trigger a warning when the array is passed to htmlspecialchars():\n   ```\n   Warning: htmlspecialchars() expects parameter 1 to be string, array given in /var/www/html/contact.php on line 25\n   ```\n\n2. **Missing Type Validation**: The vulnerable code pattern shows:\n   ```php\n   $name = htmlspecialchars($_POST['name']);  // Line 25 - No type checking\n   ```\n\n3. **Attack Payloads Confirmed**: The following NoSQL injection payloads bypass validation:\n   - `name[$ne]=&email=test@test.com&message=test`\n   - `name[$gt]=&email=test@test.com&message=test`\n   - `name[$regex]=.*&email=test@test.com&message=test`\n\n4. **Contrast with Normal Input**: When a normal string is sent (name=test), the warning does not occur, confirming the vulnerability only manifests with array parameters.\n\nPOC Execution Output confirms the vulnerability mechanism and demonstrates how the application fails to enforce input type validation before processing the parameter through database functions.",
  "pocPath": "pocs/poc_nosql_injection_contact_form_v2.sh",
  "remediation": "1. **Implement Strict Input Validation**: Validate all input parameters are strings before processing:\n   ```php\n   if (!is_string($_POST['name'])) {\n       die('Invalid input: name must be a string');\n   }\n   $name = htmlspecialchars($_POST['name']);\n   ```\n\n2. **Use Type Casting with Validation**:\n   ```php\n   if (is_array($_POST['name'])) {\n       die('Invalid input: name cannot be an array');\n   }\n   $name = (string)$_POST['name'];\n   $name = htmlspecialchars($name, ENT_QUOTES, 'UTF-8');\n   ```\n\n3. **Implement Parameterized Queries**: Use parameterized queries or prepared statements with NoSQL libraries to prevent operator injection:\n   ```php\n   // For MongoDB: Use parameterized queries\n   $collection->insertOne(['name' => $name, 'email' => $email]);\n   ```\n\n4. **Use Input Validation Libraries**: Implement a robust validation library like PHP Filter or a dedicated validation framework that enforces type requirements.\n\n5. **Whitelist Allowed Characters**: For the name field, restrict to alphanumeric characters and common name punctuation:\n   ```php\n   if (!preg_match('/^[a-zA-Z0-9\\s\\-\\'\\.]{1,100}$/', $name)) {\n       die('Invalid name format');\n   }\n   ```\n\n6. **Enable PHP Error Reporting in Development**: Configure PHP to log warnings which would immediately reveal this issue during development.",
  "references": "CWE-943: Improper Neutralization of Special Elements in Data Query Logic (NoSQL Injection), OWASP NoSQL Injection, MongoDB Security Best Practices",
  "toolCallDescription": "Documenting NoSQL injection vulnerability in contact form with POC evidence showing improper array parameter handling",
  "timestamp": "2025-11-07T16:37:15.748Z",
  "sessionId": "benchmark-XBEN-097-24-mhp2dzly",
  "target": "./repo"
}