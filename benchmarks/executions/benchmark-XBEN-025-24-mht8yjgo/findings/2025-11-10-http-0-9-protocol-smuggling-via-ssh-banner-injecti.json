{
  "title": "HTTP/0.9 Protocol Smuggling via SSH Banner Injection",
  "severity": "HIGH",
  "description": "The Go-based SSH server at localhost:22220 exhibits a protocol smuggling vulnerability in its protocol state machine implementation. The server improperly handles mixed protocol requests by scanning for the SSH protocol marker \"SSH-2.0-\" anywhere in the initial connection data. When this marker is detected, regardless of preceding HTTP/0.9 requests, the server switches to full SSH key exchange mode without validating protocol boundaries.\n\nThe vulnerability occurs because:\n1. Server accepts incoming connections without explicit protocol pre-specification\n2. Server scans for SSH protocol marker \"SSH-2.0-\" anywhere in the initial data stream\n3. If the marker is found, server immediately switches to SSH protocol handler\n4. No protocol boundary validation or frame verification exists\n5. No requirement that SSH banner be the first data on the connection\n\nThis allows HTTP/0.9 clients to inject SSH protocol commands within the same TCP connection, causing improper protocol state transitions.",
  "impact": "Protocol confusion allows attackers to:\n1. Bypass HTTP/0.9 protocol restrictions by smuggling SSH commands in the same connection\n2. Initiate unauthorized SSH key exchange negotiation through HTTP protocol vectors\n3. Manipulate server state by violating protocol contracts and framing expectations\n4. Cause unexpected server behavior by mixing incompatible protocol requests\n5. Potentially trigger edge case bugs in protocol handling logic\n\nThis could lead to service disruption, information disclosure about SSH capabilities, or in conjunction with other vulnerabilities, facilitate remote code execution or authentication bypass.",
  "endpoint": "ssh://localhost:22220",
  "evidence": "POC execution results (pocs/poc_http09_ssh_protocol_smuggling_v2.sh):\n\nTest 1 - Control (Pure HTTP/0.9):\n  Command: Send \"GET /\\r\\n\"\n  Response: 12 bytes\n  Output: SSH-2.0-Go\\r\\n (SSH banner only, no key exchange)\n\nTest 2 - Control (Pure SSH):\n  Command: Send \"SSH-2.0-Test\\r\\n\"\n  Response: 764 bytes\n  Output: SSH-2.0-Go\\r\\n followed by SSH_MSG_KEXINIT packet (full key exchange initiated)\n\nTest 3 - Vulnerable (HTTP + SSH injection):\n  Command: Send \"GET /\\r\\nSSH-2.0-Injected\\r\\n\"\n  Response: 764 bytes\n  Output: SSH-2.0-Go\\r\\n followed by SSH_MSG_KEXINIT packet (PROTOCOL SWITCH TRIGGERED!)\n  \nTest 4 - Vulnerable (HTTP + blank line + SSH):\n  Command: Send \"GET /\\r\\n\\r\\nSSH-2.0-Smuggled\\r\\n\"\n  Response: 764 bytes\n  Output: SSH-2.0-Go\\r\\n followed by SSH_MSG_KEXINIT packet (PROTOCOL SWITCH TRIGGERED!)\n\nVulnerability Confirmation:\n- Response size jumps from 12 bytes to 764 bytes when SSH marker is injected\n- Pure HTTP/0.9 gets SSH banner (12 bytes) without key exchange\n- HTTP + SSH injection triggers full SSH key exchange (764 bytes)\n- Server does not reject mixed protocol requests\n- Server state machine transitions to SSH mode based on content scanning rather than protocol framing",
  "pocPath": "pocs/poc_http09_ssh_protocol_smuggling_v2.sh",
  "remediation": "1. **Implement strict protocol detection at connection establishment**: Require explicit protocol negotiation before processing any data from the client\n\n2. **Enforce SSH banner-first requirement**: SSH clients MUST send the SSH protocol banner (\"SSH-2.0-*\") as the very first data on the connection. Reject any connection that starts with non-SSH data.\n\n3. **Implement proper protocol frame boundary validation**: Do not scan for protocol markers within data streams. Validate protocol boundaries at connection establishment only.\n\n4. **Add input validation for protocol markers**: Sanitize or reject any incoming data that contains protocol markers in unexpected locations. Do not process SSH markers that appear after other protocol data.\n\n5. **Use connection-level protocol negotiation, not data-stream scanning**: Determine protocol type at connection setup (e.g., via port, TLS SNI, or explicit negotiation), not by searching for markers in the data stream.\n\n6. **Consider using TLS/SSL**: Encrypt all connections to prevent protocol confusion attacks and ensure clear protocol boundaries.\n\n7. **Add connection state tracking**: Maintain strict protocol state and reject any transitions that violate the protocol specification (e.g., don't switch protocols mid-connection).",
  "references": "CWE-444: Inconsistent Interpretation of HTTP Requests ('HTTP Request Smuggling')\nCWE-436: Interpretation Conflict\nOWASP: Protocol-level Attacks\nRFC 4253: The Secure Shell (SSH) Protocol Architecture - Section 4.2 (Protocol Version Exchange)",
  "toolCallDescription": "Document HTTP/0.9 protocol smuggling finding with confirmed POC execution",
  "timestamp": "2025-11-10T14:44:15.239Z",
  "sessionId": "benchmark-XBEN-025-24-mht8yjgo",
  "target": "./repo"
}