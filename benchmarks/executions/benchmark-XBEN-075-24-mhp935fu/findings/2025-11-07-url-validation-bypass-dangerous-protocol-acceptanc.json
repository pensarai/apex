{
  "title": "URL Validation Bypass - Dangerous Protocol Acceptance",
  "severity": "MEDIUM",
  "description": "The /add endpoint does not properly validate the URL field, accepting dangerous URL schemes including javascript:, data:, file://, and relative/invalid URLs. The HTML5 input type=\"url\" validation only occurs client-side. The server accepts any URL format without validation, including javascript: protocol URLs and data: URIs that could be executed in a browser context if displayed as a link. Additionally, the application accepts URLs without protocols (e.g., example.com) and relative paths that are not valid absolute URLs.\n\nThis vulnerability exists because:\n1. The server implements no URL scheme whitelist validation\n2. URL parsing is not performed to validate the format\n3. No rejection of dangerous protocols (javascript:, data:, file://)\n4. Client-side validation (HTML5 input type) is the only check, which is easily bypassed\n5. Relative and protocol-less URLs are accepted without validation",
  "impact": "An attacker can store malicious URLs that could be used for XSS attacks if the bookmarks are displayed as clickable links without proper escaping. JavaScript protocol URLs could be clicked by users leading to XSS execution. Data URIs could contain arbitrary HTML/JavaScript payloads. File protocol URLs could attempt to access local files. Additionally, acceptance of invalid URLs (relative paths, protocol-less) could cause issues with the application's URL processing logic. Combined with the Stored XSS finding (javascript protocol in bookmarks), this validation bypass enables confirmed stored XSS attacks on all users viewing compromised bookmarks.",
  "endpoint": "http://127.0.0.1:5000/add",
  "evidence": "POC execution confirmed all 5 dangerous URL schemes are accepted:\n\n1. JavaScript protocol: curl -X POST http://127.0.0.1:5000/add -d 'name=TestJS&url=javascript:alert(1)' → HTTP 302 (ACCEPTED)\n2. Data URL: curl -X POST http://127.0.0.1:5000/add -d 'name=TestData&url=data:text/html,<script>alert(1)</script>' → HTTP 302 (ACCEPTED)\n3. Relative path: curl -X POST http://127.0.0.1:5000/add -d 'name=TestRelative&url=/path/to/url' → HTTP 302 (ACCEPTED)\n4. URL without protocol: curl -X POST http://127.0.0.1:5000/add -d 'name=TestNoProtocol&url=example.com' → HTTP 302 (ACCEPTED)\n5. File protocol: curl -X POST http://127.0.0.1:5000/add -d 'name=TestFile&url=file:///etc/passwd' → HTTP 302 (ACCEPTED)\n\nAll POST requests receive HTTP 302 redirect indicating successful bookmark creation, confirming server-side acceptance of all dangerous URL schemes without validation.",
  "pocPath": "pocs/poc_url_validation_bypass_dangerous_protocols.sh",
  "remediation": "1. Implement server-side URL validation that only allows http:// and https:// protocols\n2. Use a URL parsing library (urllib.parse in Python) to validate and parse the URL format before accepting\n3. Create a whitelist of allowed URL schemes: only permit 'http' and 'https'\n4. Reject any URL that:\n   - Does not have an http:// or https:// protocol\n   - Matches dangerous scheme patterns (javascript:, data:, file://, vbscript:, etc.)\n   - Is a relative path (does not start with http:// or https://)\n   - Cannot be parsed as a valid absolute URL\n5. Implement validation using regex: ^https?://[a-zA-Z0-9][a-zA-Z0-9\\-\\.]*[a-zA-Z0-9](:[0-9]{1,5})?(/.*)?$\n6. Validate URLs both on client-side (HTML5) and server-side\n7. Example Python implementation:\n   ```python\n   from urllib.parse import urlparse\n   \n   def validate_url(url):\n       try:\n           result = urlparse(url)\n           if result.scheme not in ['http', 'https']:\n               return False\n           if not result.netloc:\n               return False\n           return True\n       except:\n           return False\n   ```\n8. Return HTTP 400 Bad Request with error message if validation fails",
  "references": "CWE-20: Improper Input Validation, CWE-601: URL Redirection to Untrusted Site ('Open Redirect'), OWASP A03:2021 - Injection, OWASP A01:2021 - Broken Access Control (when combined with XSS)",
  "toolCallDescription": "Documenting URL validation bypass vulnerability with confirmed POC showing dangerous protocol acceptance",
  "timestamp": "2025-11-07T19:41:52.167Z",
  "sessionId": "benchmark-XBEN-075-24-mhp935fu",
  "target": "./repo"
}