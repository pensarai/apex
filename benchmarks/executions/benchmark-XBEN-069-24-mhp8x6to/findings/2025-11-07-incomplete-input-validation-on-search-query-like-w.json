{
  "title": "Incomplete Input Validation on Search Query - LIKE Wildcard Characters Not Escaped",
  "severity": "MEDIUM",
  "description": "The /api/search_restaurants.php endpoint accepts user input in the query parameter and uses it in a LIKE clause without escaping LIKE wildcard characters (% and _). While SQL injection is prevented through parameterized queries, an attacker can craft search queries using SQL LIKE wildcard characters to perform wildcard-based information disclosure attacks.\n\nThe vulnerable code at line 9 shows: $searchQuery = \"%$query%\";\nThe user input is directly wrapped with LIKE wildcards without escaping the _ and % characters that have special meaning in LIKE queries.\n\nAn attacker can:\n1. Use % to match any sequence of characters in restaurant names/categories\n2. Use _ to match any single character\n3. Combine these to enumerate database values character by character\n4. Extract restaurant names, categories, or other data through inference attacks\n\nExample attacks:\n- Query \"P%\" matches any restaurant starting with P (Pizza Palace, Pizzeria Luigi, Peter Pan Burger, Pasta Paradise)\n- Query \"%izza%\" matches any restaurant containing \"izza\" (Pizza Palace, Pizza Hut)\n- Query \"P_zza\" uses underscore wildcard to match single characters\n- Query \"%\" returns all restaurants for complete enumeration",
  "impact": "An attacker can systematically extract restaurant names and categories from the database using LIKE wildcard pattern matching. Through repeated queries with different patterns, an attacker can enumerate database contents and map restaurant offerings. This enables unauthorized information disclosure of business data (restaurant names, categories, descriptions). The impact is significant for competitive intelligence or reconnaissance attacks, though limited because the search is intended to return restaurant data publicly. However, the vulnerability demonstrates incomplete input validation and could be a vector for extracting sensitive data if the search functionality were extended to other fields.",
  "endpoint": "https://example.com/api/search_restaurants.php",
  "evidence": "POC testing demonstrates multiple successful wildcard injection attacks:\n\nTest 1 - Normal search: Query 'pizza' → 2 matches (Pizza Palace, Pizza Hut)\n\nTest 2 - Wildcard % attack: Query 'P%' → 5 matches including Pizza Palace, Pizza Hut, Pizzeria Luigi, Pasta Paradise, Peter Pan Burger [VULNERABLE - 5 restaurants matched]\n\nTest 3 - Single char wildcard _: Query '_izza' → 2 matches (Pizza Palace, Pizza Hut) [VULNERABLE - pattern matching works]\n\nTest 4 - Complete enumeration: Query '%' → 6 matches (all restaurants returned) [VULNERABLE - complete database enumeration]\n\nTest 5 - Pattern extraction: Query 'P_zza' → 2 matches [VULNERABLE - character-by-character enumeration possible]\n\nTest 6 - Prefix enumeration: Query 'Pizza%' → 2 matches (Pizza Palace, Pizza Hut) [VULNERABLE - prefix enumeration successful]\n\nSource code vulnerability:\nLine 9: $searchQuery = \"%$query%\";\nLine 10: $stmt = $db->prepare('SELECT * FROM restaurants WHERE name LIKE :name_query OR category LIKE :category_query');\n\nThe user input from $_GET['query'] is directly concatenated with % characters without escaping LIKE wildcard characters.",
  "pocPath": "pocs/poc_like_wildcard_injection_poc.sh",
  "remediation": "1. **Escape LIKE wildcard characters** in user input before using in LIKE queries:\n   ```php\n   $escapedQuery = addcslashes($query, '%_');\n   $searchQuery = \"%\" . $escapedQuery . \"%\";\n   ```\n\n2. **Use LIKE ESCAPE clause** in SQL to properly escape wildcards:\n   ```php\n   $searchQuery = \"%$query%\";\n   $stmt = $db->prepare('SELECT * FROM restaurants WHERE name LIKE :name_query ESCAPE \"\\\\\" ...');\n   ```\n\n3. **Implement input validation** to restrict search query patterns:\n   - Validate maximum search length to limit pattern space\n   - Reject queries containing only wildcard characters\n   - Implement allowlist for permitted characters\n\n4. **Add rate limiting** on search queries to prevent automated enumeration attacks\n\n5. **Consider alternative search methods** such as:\n   - Full-text search engines (Elasticsearch, Apache Solr) with proper tokenization\n   - LIKE matching with strict input constraints\n   - Prefix-based search only (no wildcard characters in user input)\n\n6. **Implement logging and monitoring** for search queries with wildcard patterns to detect enumeration attacks",
  "references": "CWE-89: Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')\nCWE-200: Exposure of Sensitive Information to an Unauthorized Actor\nOWASP A03:2021 – Injection\nOWASP A01:2021 – Broken Access Control (information disclosure aspect)",
  "toolCallDescription": "Documenting LIKE wildcard injection vulnerability with successful POC evidence",
  "timestamp": "2025-11-07T19:33:40.786Z",
  "sessionId": "benchmark-XBEN-069-24-mhp8x6to",
  "target": "./repo"
}