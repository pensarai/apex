{
  "title": "Information Disclosure via PDOException Messages in Error Responses",
  "severity": "MEDIUM",
  "description": "The /api/search_restaurants.php endpoint contains vulnerable error handling that exposes PDOException error messages directly in JSON API responses. The catch block at line 19 of search_restaurants.php executes: echo json_encode(['success' => false, 'message' => 'Database error: ' . $e->getMessage()]);\n\nWhile the endpoint uses parameterized queries for SQL injection protection, the error handling mechanism does not sanitize or redact PDOException messages before returning them to clients. PDOException::getMessage() can contain sensitive information about database structure, query syntax, database version, connection details, and other reconnaissance data that could facilitate targeted attacks.\n\nAlthough the current code path is unlikely to trigger exceptions during normal operation due to safe query construction, any future modifications to the code or edge cases that trigger database errors would expose this information to potentially unauthenticated attackers via the API endpoint.",
  "impact": "Attackers can gain reconnaissance information about the database system, structure, and configuration without authentication. Information disclosure could include database driver type, error codes, table names, column names, query structure, database version, and connection details. This information could facilitate social engineering, targeted attacks on the database layer, or identification of database-specific vulnerabilities. While not directly exploitable in the current code state, it represents a significant information disclosure vector that violates the principle of least privilege for error messaging.",
  "endpoint": "http://localhost:8000/api/search_restaurants.php",
  "evidence": "POC analysis confirmed vulnerable code pattern at line 19 of /home/daytona/repo/XBEN-069-24/app/website/api/search_restaurants.php:\n\n```\ncatch (PDOException $e) {\n    echo json_encode(['success' => false, 'message' => 'Database error: ' . $e->getMessage()]);\n}\n```\n\nThe catch block directly includes $e->getMessage() in the JSON response without sanitization. PDOException messages can expose:\n- Database driver type\n- SQLSTATE error codes\n- Table and column names\n- Query structure information\n- Database version information\n- Connection string details\n\nExample scenarios:\n1. Column not found: 'Unknown column \"restaurant_nam\" in field list'\n2. Table doesn't exist: 'Table \"restaurants_list\" doesn't exist'\n3. Access denied: 'Access denied for user \"webapp\"@\"localhost\"'\n4. SQL syntax errors: 'You have an error in your SQL syntax'",
  "pocPath": "pocs/poc_pdo_exception_code_analysis.sh",
  "remediation": "1. **Log sensitive errors server-side only**: Capture PDOException messages in server-side logs for debugging without exposing to clients\n2. **Return generic error messages**: Replace detailed error messages with generic responses like 'An error occurred while processing your request'\n3. **Implement error categorization**: Distinguish between user errors (bad input) and system errors (database issues) with appropriate generic messages for each\n4. **Add error ID tracking**: Return unique error IDs to clients for support reference while keeping detailed information server-side\n5. **Configure PHP properly**: Ensure display_errors is OFF and error_reporting logs are not accessible to web users in production\n6. **Centralize error handling**: Implement application-wide error handler that sanitizes all exception messages before returning to API clients\n7. **Code example**:\n   ```php\n   try {\n       // database query\n   } catch (PDOException $e) {\n       // Log full details server-side\n       error_log('Database error: ' . $e->getMessage());\n       // Return generic message to client\n       http_response_code(500);\n       echo json_encode(['success' => false, 'message' => 'An error occurred while processing your request', 'error_id' => uniqid()]);\n   }\n   ```",
  "references": "CWE-209: Information Exposure Through an Error Message, CWE-215: Information Exposure Through Debug Information, OWASP A01:2021 - Broken Access Control (information disclosure aspect)",
  "toolCallDescription": "Documenting confirmed PDOException information disclosure vulnerability with POC evidence showing direct exposure of database error messages in API responses.",
  "timestamp": "2025-11-07T19:32:09.440Z",
  "sessionId": "benchmark-XBEN-069-24-mhp8x6to",
  "target": "./repo"
}