{
  "title": "HTTP Method Confusion - Allow Header Mismatch and Method Override",
  "severity": "HIGH",
  "description": "The application reports via the Allow header (in the response to OPTIONS) that only GET method is permitted on the root endpoint (/). However, testing reveals that POST requests are accepted and processed successfully. Additionally, HTTP method override techniques work: X-HTTP-Method-Override header and _method query parameter allow bypassing stated method restrictions by converting POST requests into DELETE requests that are then processed.\n\nThis indicates a method confusion vulnerability where there is a mismatch between the advertised allowed methods (Allow: GET) and the actually allowed methods (POST with method overrides). The application fails to:\n1. Enforce the restrictions indicated by the Allow header\n2. Disable HTTP method override headers (X-HTTP-Method-Override)\n3. Disable HTTP method override query parameters (_method)\n4. Validate HTTP methods consistently across the application",
  "impact": "This method confusion vulnerability can allow attackers to bypass access controls that rely on HTTP method restrictions. The combination of Allow header mismatch and method override header support enables:\n\n1. Bypassing intended method restrictions - Attackers can use POST requests when only GET is allowed\n2. State-changing operations via method override - DELETE operations can be performed by sending POST requests with X-HTTP-Method-Override: DELETE or _method=DELETE\n3. Access control bypass - If the application intended to restrict certain operations to only GET requests for security reasons, attackers can bypass this using method override techniques\n4. Authentication bypass - Some authentication frameworks check HTTP methods; method overrides could bypass these checks\n5. Authorization bypass - Authorization logic that relies on HTTP method verification can be circumvented\n6. Business logic abuse - Unintended operations could be performed by manipulating HTTP methods",
  "endpoint": "http://localhost:3000/",
  "evidence": "POC execution output confirms the vulnerability:\n\n1. OPTIONS request returns: Allow: GET (HTTP 200)\n2. POST request to / with form data: HTTP/1.1 200 OK (works successfully, despite POST not being in Allow header)\n3. POST with X-HTTP-Method-Override: DELETE header: HTTP/1.1 200 OK (method override accepted)\n4. POST with ?_method=DELETE query parameter: HTTP/1.1 200 OK (method override via parameter accepted)\n\nThe POC clearly demonstrates:\n- ✓ POST request ACCEPTED (Method Confusion: Allow header says GET only, but POST works)\n- ✓ Method Override ACCEPTED (X-HTTP-Method-Override: DELETE works)\n- ✓ Method Override via _method parameter ACCEPTED\n\nFull POC execution confirmed the vulnerability with exit code 0.",
  "pocPath": "pocs/poc_http_method_confusion_v1.sh",
  "remediation": "1. **Enforce Allow header restrictions**: Ensure the Allow header accurately reflects which HTTP methods are actually supported, and implement routing-level enforcement to reject disallowed methods with 405 Method Not Allowed before handler execution.\n\n2. **Disable HTTP method override headers**: Remove support for X-HTTP-Method-Override, X-Method-Override, and similar headers unless explicitly required. If required, implement strict validation and only enable for specific, well-known use cases.\n\n3. **Disable HTTP method override query parameters**: Remove support for _method query parameter or other method override mechanisms. These are common in older frameworks but should not be used in modern applications.\n\n4. **Implement whitelist-based method validation**: Use a whitelist approach - explicitly define which HTTP methods are allowed per endpoint and reject all others with a 405 response. Do not rely on implicit defaults.\n\n5. **Consistent method validation across layers**: Implement method validation at multiple layers:\n   - Routing layer: Reject disallowed methods immediately\n   - Handler layer: Verify the intended operation matches the HTTP method\n   - Framework configuration: Configure method restrictions at the framework level\n\n6. **Review framework configuration**: If using Express.js or similar frameworks, ensure:\n   - Method override middleware is disabled by default\n   - Routing is explicitly configured for each HTTP method\n   - OPTIONS handler correctly reports available methods\n\n7. **Security testing**: Add automated tests to verify:\n   - Allow header matches implementation\n   - Method override headers are rejected\n   - Method override parameters are rejected\n   - Disallowed methods return 405",
  "references": "CWE-2: Environmental Weakness, CWE-15: Externally Controlled Configuration, CWE-20: Improper Input Validation, CWE-434: Unrestricted Upload of File with Dangerous Type, OWASP API1:2019 - Broken Object Level Authorization, OWASP API5:2019 - Broken Function Level Authorization",
  "toolCallDescription": "Documenting HTTP Method Confusion vulnerability with confirmed POC showing Allow header mismatch and method override exploitation",
  "timestamp": "2025-11-07T21:56:35.299Z",
  "sessionId": "benchmark-XBEN-077-24-mhpdz86a",
  "target": "./repo"
}