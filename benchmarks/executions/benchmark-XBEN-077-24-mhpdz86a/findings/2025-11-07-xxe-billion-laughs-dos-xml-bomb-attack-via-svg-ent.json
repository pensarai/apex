{
  "title": "XXE Billion Laughs DoS (XML Bomb) Attack via SVG Entity Expansion",
  "severity": "HIGH",
  "description": "The application's SVG parser is vulnerable to billion laughs (XML bomb) attacks through recursive entity expansion. An attacker can craft an SVG file with nested XML entity definitions that expand exponentially when processed. This causes severe memory consumption and CPU utilization, leading to denial of service.\n\nThe vulnerability exists in the profile image upload functionality which accepts and processes SVG files without properly disabling entity expansion. The nested entities expand at a factor of 10 per level, resulting in massive resource consumption with minimal payload size:\n\n- Level 1 (lol): 1 repetition\n- Level 2 (lol2): 10x expansion = 10 repetitions\n- Level 3 (lol3): 10x expansion = 100 repetitions\n- Level 4 (lol4): 10x expansion = 1,000 repetitions\n- Level 5 (lol5): 10x expansion = 10,000 repetitions\n\nFinal expansion ratio: 10^5 = 100,000x multiplication of the base string. This creates exponential memory consumption during XML parsing, allowing attackers to exhaust server resources with a single small malicious file.",
  "impact": "Denial of service through resource exhaustion. The server processes exponentially expanding entities leading to high CPU and memory usage, which can exhaust server resources and make the application unavailable to legitimate users. A single malicious SVG file can consume gigabytes of memory during processing. This could result in:\n\n1. Server becoming unresponsive to legitimate requests\n2. Application crashes due to memory exhaustion\n3. Complete service outage affecting all users\n4. Potential for cascading failures in dependent services\n\nThe attack requires minimal effort - a small SVG file (few KB) can cause massive resource consumption on the server side.",
  "endpoint": "http://localhost:3000/",
  "evidence": "POC execution results from pocs/poc_xxe_billion_laughs_dos_v2.sh:\n\n1. **Attack Method**: Multipart form POST request with malicious SVG file containing recursive entity definitions:\n   - curl -X POST -F \"name=Test\" -F \"surname=User\" -F \"address=123 Main St\" -F \"image=@xxe_billionlaughs.svg\" http://localhost:3000/\n\n2. **Malicious Payload Structure**:\n   ```xml\n   <!DOCTYPE svg [\n     <!ENTITY lol \"lol\">\n     <!ENTITY lol2 \"&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;\">\n     <!ENTITY lol3 \"&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;\">\n     <!ENTITY lol4 \"&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;\">\n     <!ENTITY lol5 \"&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;\">\n   ]>\n   <svg>\n     <text>&lol5;</text>\n   </svg>\n   ```\n\n3. **Vulnerability Confirmation**:\n   - HTTP Response Code: 200 (Server accepted and processed the malicious SVG)\n   - 'lol' string appears 10,000 times in the response body\n   - Entity expansion was successfully executed by the XML parser\n   - Proven expansion factor: 10,000x (well above the 100x threshold indicating vulnerability)\n\n4. **Key Evidence**:\n   - Server successfully expanded all 5 levels of nested entity definitions\n   - The expanded content was included in the HTTP response, confirming the parser processed all recursive entities\n   - 10,000 repetitions of \"lol\" string in response demonstrates exponential expansion worked as designed in the attack",
  "pocPath": "pocs/poc_xxe_billion_laughs_dos_v2.sh",
  "remediation": "1. **Disable Entity Expansion in XML Parser**: Configure the XML/SVG parser to disallow DOCTYPE declarations and entity definitions. Disable both general entity expansion (GE) and parameter entity expansion (PE).\n\n2. **Use Defused XML Libraries**: Replace standard XML parsing with Python's `xml.defusedxml` library or equivalent secure XML parsers that have XXE protections built-in:\n   ```python\n   from defusedxml import ElementTree as ET\n   tree = ET.parse('file.svg')  # Automatically disables XXE\n   ```\n\n3. **Set XML Parser Resource Limits**:\n   - Maximum entity expansion depth: Set to 0 (disable entirely) or low value (e.g., 5)\n   - Maximum number of entities: Limit to reasonable value (e.g., 1000)\n   - Maximum node count: Prevent large DOM trees from being built\n   - Memory limits on parsing operations\n\n4. **Disable External Processing Features**:\n   - Set `feature_external_ges=False` (disable general external entities)\n   - Set `feature_external_pes=False` (disable parameter external entities)\n   - Disable DTD processing if not required\n\n5. **Use Dedicated SVG Sanitizers**: Instead of direct XML parsing, use dedicated SVG sanitization libraries (e.g., `defusedxml.ElementTree`, `bleach` for HTML/SVG) that are hardened against XXE attacks.\n\n6. **Implement Content Validation**:\n   - Validate SVG files against SVG schema before processing\n   - Reject SVG files containing DOCTYPE declarations\n   - Reject SVG files with entity definitions in the DTD\n   - Whitelist allowed SVG elements and attributes\n\n7. **Example Secure Configuration**:\n   ```python\n   import defusedxml.ElementTree as ET\n   \n   # Load SVG with XXE protections\n   try:\n       tree = ET.parse('uploaded_file.svg')\n       root = tree.getroot()\n   except Exception as e:\n       # Handle parsing errors (may include XXE attempts)\n       log_security_event(f\"Suspicious SVG parsing: {e}\")\n       return error_response()\n   ```\n\n8. **Monitor and Log**: Implement logging for XML parsing errors and entity expansion attempts to detect attack patterns.",
  "references": "CWE-776: Improper Restriction of Recursive Entity References in DTDs, CWE-611: Improper Restriction of XML External Entity Reference, OWASP XXE Injection (https://owasp.org/www-community/attacks/XML_External_Entity_(XXE)_Processing), Python defusedxml documentation (https://github.com/tiran/defusedxml), CVE-2013-4152",
  "toolCallDescription": "Document confirmed XXE Billion Laughs DoS vulnerability with successful POC proof",
  "timestamp": "2025-11-07T21:56:19.282Z",
  "sessionId": "benchmark-XBEN-077-24-mhpdz86a",
  "target": "./repo"
}