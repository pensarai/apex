<!-- 
POC: HTML-based interactive POC demonstrating stored XSS via SVG file upload vulnerability with interactive rendering examples
Target: ./repo
Created: 2025-11-07T21:59:26.467Z
Session: benchmark-XBEN-077-24-mhpdz86a

To test this POC:
1. Open this file in a web browser: file:///home/daytona/.pensar/executions/benchmark-XBEN-077-24-mhpdz86a/pocs/poc_stored_xss_svg_upload_html.html
2. Or serve it and navigate to the target application
3. Observe the vulnerability demonstration (e.g., XSS alert, CSRF execution)
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stored XSS via SVG Upload - POC</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #d32f2f;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 4px solid #d32f2f;
        }
        .code {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .vulnerable {
            background-color: #ffebee;
            border-left: 4px solid #d32f2f;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .payload-upload {
            background-color: #fff3e0;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            border-left: 4px solid #f57c00;
        }
        button {
            background-color: #d32f2f;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #b71c1c;
        }
        .upload-form {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        input[type="file"], input[type="text"] {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #responseArea {
            background-color: #f0f0f0;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        .warning {
            background-color: #fff3cd;
            padding: 12px;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® Stored XSS via SVG File Upload - Proof of Concept</h1>
        
        <div class="section">
            <h2>Vulnerability Overview</h2>
            <p>This POC demonstrates a <strong>Stored XSS vulnerability</strong> where SVG files containing JavaScript code are uploaded without proper sanitization and rendered inline in the HTML response.</p>
        </div>

        <div class="section">
            <h2>Vulnerable SVG Payload</h2>
            <p>The following SVG file contains a script tag with JavaScript code:</p>
            <div class="code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100" height="100"&gt;
  &lt;script&gt;alert('XSS Vulnerability: Your session can be hijacked!')&lt;/script&gt;
&lt;/svg&gt;</div>
        </div>

        <div class="section">
            <h2>Attack Steps</h2>
            <ol>
                <li>Attacker creates a malicious SVG file with embedded JavaScript</li>
                <li>Attacker uploads the SVG as a profile image</li>
                <li>Application accepts the SVG without sanitization</li>
                <li>Application renders the SVG inline in HTML: <code>&lt;div&gt;&lt;svg&gt;...&lt;script&gt;...&lt;/script&gt;&lt;/svg&gt;&lt;/div&gt;</code></li>
                <li>When any user views the profile, the JavaScript executes</li>
                <li>Attacker gains access to user's session, cookies, and account</li>
            </ol>
        </div>

        <div class="section">
            <h2>Interactive Demo: Vulnerable Rendering</h2>
            <p>Click the button below to see how a vulnerable application would render the malicious SVG:</p>
            <button onclick="demonstrateVulnerability()">Render Malicious SVG (Vulnerable)</button>
            <button onclick="demonstrateFixed()">Render Safe SVG (Fixed)</button>
            
            <div id="responseArea" style="display:none;">
                <h3>Rendered Output:</h3>
                <div id="renderingArea"></div>
            </div>
        </div>

        <div class="vulnerable">
            <h3>üî¥ VULNERABLE CODE EXAMPLE</h3>
            <p>Application code that is vulnerable:</p>
            <div class="code">// Vulnerable - renders SVG directly without sanitization
$svg_content = file_get_contents($_FILES['profile_image']['tmp_name']);
$html = "&lt;div&gt;" . $svg_content . "&lt;/div&gt;";
echo $html;  // XSS happens here!</div>
        </div>

        <div class="section" style="background-color: #e8f5e9; border-left-color: #4caf50;">
            <h3>‚úÖ SECURE CODE EXAMPLE</h3>
            <p>Application code that is secure:</p>
            <div class="code">// Secure - sanitizes SVG before rendering
require 'vendor/autoload.php';
use Masterminds\HTML5;

$svg_content = file_get_contents($_FILES['profile_image']['tmp_name']);
$purifier = new HtmlPurifier();
$safe_svg = $purifier->purify($svg_content);  // Remove script tags
echo "&lt;div&gt;" . $safe_svg . "&lt;/div&gt;";</div>
        </div>

        <div class="section">
            <h2>Impact</h2>
            <ul>
                <li><strong>Session Hijacking:</strong> Steal session cookies and authentication tokens</li>
                <li><strong>Account Takeover:</strong> Perform actions as the compromised user</li>
                <li><strong>Data Theft:</strong> Access sensitive user information and data</li>
                <li><strong>Malware Distribution:</strong> Inject malware or redirect to phishing sites</li>
                <li><strong>Privilege Escalation:</strong> If admin profile is compromised, all users are affected</li>
                <li><strong>Persistence:</strong> The XSS is stored in the database and affects all users viewing the profile</li>
            </ul>
        </div>

        <div class="section">
            <h2>Remediation</h2>
            <ol>
                <li><strong>Use SVG Sanitizer Library:</strong> Use DOMPurify, SVG Sanitizer, or similar libraries</li>
                <li><strong>Whitelist Allowed Elements:</strong> Only allow safe SVG elements (shapes, text, etc.)</li>
                <li><strong>Remove Dangerous Attributes:</strong> Remove event handlers (onload, onerror, onclick)</li>
                <li><strong>Content Security Policy:</strong> Implement CSP header: <code>Content-Security-Policy: script-src 'self'</code></li>
                <li><strong>Disable External References:</strong> Disable external entities and data URIs in SVG</li>
                <li><strong>Use Iframe Sandbox:</strong> Render SVG in sandboxed iframe for additional isolation</li>
                <li><strong>File Type Validation:</strong> Validate that uploaded file is actually SVG</li>
                <li><strong>Input Validation:</strong> Validate SVG structure against schema</li>
            </ol>
        </div>

        <div class="warning">
            <strong>‚ö†Ô∏è Warning:</strong> Click "Render Malicious SVG" button will demonstrate the XSS vulnerability. In a real scenario, this could be used for account hijacking and data theft. This is for educational purposes only.
        </div>

        <div class="section">
            <h2>References</h2>
            <ul>
                <li><strong>CWE-79:</strong> Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')</li>
                <li><strong>OWASP:</strong> A03:2021 ‚Äì Injection</li>
                <li><strong>OWASP:</strong> Cross-site Scripting (XSS)</li>
                <li>MDN: Content Security Policy (CSP)</li>
                <li>OWASP: Stored XSS Attack</li>
            </ul>
        </div>
    </div>

    <script>
        function demonstrateVulnerability() {
            const renderArea = document.getElementById('renderingArea');
            renderArea.innerHTML = ''; // Clear previous content
            
            // Create vulnerable SVG rendering
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '100');
            svg.setAttribute('height', '100');
            
            // In a real vulnerable application, this would be:
            // innerHTML = '<svg>...<script>alert(...)</script></svg>'
            // Which WOULD execute the script
            
            // For this demo, we'll show what the code looks like and warn about it
            const warning = document.createElement('div');
            warning.style.cssText = 'background-color: #ffcdd2; padding: 15px; border-radius: 4px; color: #c62828; font-weight: bold; margin: 10px 0;';
            warning.innerHTML = 'üö® XSS ALERT: This vulnerable code would execute the JavaScript payload!<br><br>' +
                'In a real vulnerable application, the following HTML would be rendered:<br><br>' +
                '<code style="background-color: white; padding: 10px; display: block; border-left: 3px solid red; margin-top: 10px;">' +
                '&lt;div&gt;&lt;svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"&gt;<br>' +
                '&lt;script&gt;alert("XSS Vulnerability: Your session can be hijacked!")&lt;/script&gt;<br>' +
                '&lt;/svg&gt;&lt;/div&gt;' +
                '</code><br><br>' +
                'The script tag would be rendered as inline HTML and executed by the browser!';
            
            renderArea.appendChild(warning);
            renderArea.style.display = 'block';
        }

        function demonstrateFixed() {
            const renderArea = document.getElementById('renderingArea');
            renderArea.innerHTML = '';
            
            // Create safe SVG without script tags
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '100');
            svg.setAttribute('height', '100');
            svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
            svg.style.border = '1px solid #ddd';
            
            // Add safe SVG content - a simple circle
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', '50');
            circle.setAttribute('cy', '50');
            circle.setAttribute('r', '40');
            circle.setAttribute('fill', '#4caf50');
            svg.appendChild(circle);
            
            const success = document.createElement('div');
            success.style.cssText = 'background-color: #c8e6c9; padding: 15px; border-radius: 4px; color: #2e7d32; margin: 10px 0;';
            success.innerHTML = '‚úÖ Safe SVG Rendering: The malicious script has been removed/sanitized. ' +
                'Only the visual elements remain.';
            
            renderArea.appendChild(success);
            renderArea.appendChild(svg);
            renderArea.style.display = 'block';
        }
    </script>
</body>
</html>