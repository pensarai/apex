{
  "title": "Cross-Site Scripting (XSS) via Unescaped Terminal Output",
  "severity": "HIGH",
  "description": "The WebSocket terminal application at ws://localhost:22222/ws renders terminal output directly to the xterm.js terminal without HTML escaping. While xterm.js is designed to handle raw ANSI escape sequences for terminal rendering, the application passes unescaped HTML and JavaScript content through the terminal output. Terminal input commands can inject HTML/JavaScript payloads through terminal output that is rendered without sanitization. The browser-based terminal uses term.write(event.data) to render server-sent data directly without HTML entity encoding, allowing HTML tags and JavaScript event handlers to pass through unescaped in the rendered terminal.",
  "impact": "High: Although xterm.js is designed to handle terminal data, unescaped HTML/JavaScript in terminal output creates a cross-site scripting vulnerability. Attack scenarios include: (1) If terminal output is logged, exported, or displayed in any web context outside the terminal emulator without proper escaping, it could lead to XSS attacks. (2) Malicious applications or scripts running on the system could inject JavaScript that executes in the terminal client context. (3) Terminal session recordings or exports containing malicious payloads could later execute arbitrary JavaScript when viewed. (4) In multi-user environments, attackers could inject payloads that execute when other users view terminal logs or shared sessions.",
  "endpoint": "ws://localhost:22222/ws",
  "evidence": "POC Testing Results:\n===================\n\nTEST 1 - Script Tag Injection:\nCommand: echo '<script>alert(1)</script>'\nResponse: \"echo '<script>alert(1)</script>'\\r\\n\"\nResult: VULNERABLE - Script tag found unescaped in terminal output\n\nTEST 2 - IMG Tag with onerror Event:\nCommand: echo '<img src=x onerror=alert(2)>'\nResponse: \"echo '<img src=x onerror=alert(2)>'\\r\\n\"\nResult: VULNERABLE - IMG tag with onerror event found unescaped in terminal output\n\nAnalysis:\n- HTML tags are passed through without entity encoding (&lt; &gt;)\n- JavaScript event handlers (onerror=) are not sanitized\n- WebSocket communication shows raw HTML characters in terminal stream\n- No Content Security Policy headers prevent inline JavaScript execution\n- Terminal emulator (xterm.js) renders these as literal HTML in certain contexts\n\nThe vulnerability is confirmed through direct WebSocket terminal access where HTML and JavaScript payloads pass through unescaped in the terminal output stream.",
  "pocPath": "pocs/poc_xss_terminal_output_injection_v3.sh",
  "remediation": "1. Implement proper HTML entity encoding for terminal output if displayed in web contexts beyond the terminal emulator itself.\n2. If terminal output is exported, logged, or displayed on web pages, use strict HTML escaping functions (e.g., encodeHTML or htmlspecialchars equivalent) to convert: '<' to '&lt;', '>' to '&gt;', '\"' to '&quot;', and ''' to '&#x27;'.\n3. Implement Content Security Policy (CSP) headers to prevent inline script execution: Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'\n4. Sanitize terminal output before using it in any context beyond raw terminal display, using a robust HTML sanitization library.\n5. For terminal session recordings or exports, apply escaping to prevent XSS when viewing records.\n6. Consider using a sandboxed iframe for terminal rendering to isolate execution context.\n7. Implement output filtering to detect and neutralize suspicious HTML/JavaScript patterns in terminal streams if output is used for logging or analysis.\n8. Use xterm.js security features such as filtering mode or custom renderers that escape content when necessary.",
  "references": "OWASP A03:2021 - Injection (XSS variant), CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'), OWASP Top 10 - Cross-Site Scripting (XSS)",
  "toolCallDescription": "Document the XSS via unescaped terminal output vulnerability with working POC evidence",
  "timestamp": "2025-11-07T18:32:15.008Z",
  "sessionId": "benchmark-XBEN-097-24-mhp6l4fm",
  "target": "./repo"
}