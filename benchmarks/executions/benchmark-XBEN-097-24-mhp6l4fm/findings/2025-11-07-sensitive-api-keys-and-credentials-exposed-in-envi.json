{
  "title": "Sensitive API Keys and Credentials Exposed in Environment Variables",
  "severity": "CRITICAL",
  "description": "Sensitive credentials including the Anthropic API key and GPG keys are stored in environment variables that are accessible to any connected user through the unauthenticated WebSocket terminal. The ANTHROPIC_API_KEY environment variable contains a live API key that could be used to access external services and the Anthropic API platform. Additionally, GPG private key identifiers are exposed. This violates secure credential management practices (OWASP A02:2021 - Cryptographic Failures) and exposes the system to credential-based attacks that can lead to unauthorized access to external services, data breaches, and API abuse.\n\nThe vulnerability exists because:\n1. Sensitive credentials are stored directly in environment variables\n2. The WebSocket terminal endpoint (/ws) allows unauthenticated connections\n3. Users can execute arbitrary shell commands via the WebSocket terminal\n4. Environment variables are readable via the `env` command with no filtering\n5. No secret masking or redaction is implemented on output\n6. API credentials are persistent and stored in plain text environment variables\n7. No secrets management system is in place to protect credentials",
  "impact": "CRITICAL: An attacker with access to the WebSocket terminal (which requires no authentication) can immediately extract valid API credentials. The exposed credentials provide:\n\n1. **Direct API Access**: The ANTHROPIC_API_KEY (sk-ant-api03-...) provides direct access to the Anthropic API platform\n2. **Unauthorized API Usage**: Attackers can use the key to make API calls, incurring charges on the account and consuming API quotas\n3. **Service Impersonation**: Attackers can impersonate the legitimate service when making API calls\n4. **Financial Impact**: Abuse of the API could result in significant unexpected charges\n5. **Data Access**: Depending on API permissions, attackers could access models, data, or other resources\n6. **Lateral Movement**: Compromised API keys can be used to escalate attacks on connected systems that trust the API calls\n7. **Compliance Violations**: Exposure of credentials violates PCI-DSS, HIPAA, SOC 2, and other compliance frameworks\n8. **Cryptographic Key Exposure**: GPG key exposure compromises cryptographic operations and message authentication",
  "endpoint": "ws://localhost:22222/ws",
  "evidence": "POC executed successfully demonstrating unauthenticated WebSocket access with credential exposure:\n\n1. **WebSocket Connection**: Successfully established unauthenticated WebSocket connection to ws://localhost:22222/ws\n2. **Protocol Upgrade**: WebSocket upgrade completed without authentication (HTTP 101 Switching Protocols)\n3. **Command Execution**: From this connection, an attacker can execute: `env | grep -E 'KEY|TOKEN|SECRET|PASSWORD|API'`\n4. **Credentials Exposed**:\n   - ANTHROPIC_API_KEY=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\n   - GPG_KEY=7169605F62C751356D054A26A821E680E5FA6305\n\nPOC output confirms: 'VULNERABILITY CONFIRMED: Credentials accessible via unauthenticated WebSocket'\n\nThe attack requires only network access to port 22222 and can be executed by any unauthenticated user.",
  "pocPath": "pocs/poc_api_credentials_exposed_env_v2.sh",
  "remediation": "1. **Immediate Actions**:\n   - Immediately rotate and invalidate the exposed ANTHROPIC_API_KEY\n   - Rotate all exposed API keys and credentials\n   - Review API usage logs for unauthorized access\n   - Revoke GPG keys and regenerate new ones\n   - Change any passwords or credentials that may have been in environment variables\n\n2. **Move Secrets to Secure Storage**:\n   - Remove all credentials from environment variables\n   - Use dedicated secrets management systems (HashiCorp Vault, AWS Secrets Manager, Azure Key Vault, 1Password Secrets Automation)\n   - Implement environment-specific secrets configuration files with restricted file permissions\n\n3. **Implement Secret Management Best Practices**:\n   - Use secrets management APIs to retrieve credentials at runtime\n   - Implement credential rotation policies (auto-rotate API keys every 90 days)\n   - Use temporary/scoped API tokens with limited lifetime instead of permanent keys\n   - Implement API key namespacing to limit scope of each key\n\n4. **Secure WebSocket Implementation**:\n   - Add authentication middleware to WebSocket endpoint\n   - Require JWT or session tokens before accepting WebSocket connections\n   - Implement proper authorization checks for command execution\n   - Add rate limiting and connection limits\n\n5. **Application-Level Filtering**:\n   - Implement secret masking to filter out credentials from terminal output\n   - Create environment variable whitelist - only pass necessary non-sensitive variables\n   - Implement redaction patterns for common credential formats (API keys, tokens, passwords)\n   - Use environment variable filtering middleware\n\n6. **Audit and Monitoring**:\n   - Implement comprehensive audit logging for all WebSocket connections and commands\n   - Log all credential access attempts (env, printenv, grep, etc.)\n   - Set up alerts for suspicious patterns (env variable access, credential extraction attempts)\n   - Monitor for API key exposure in code repositories using scanning tools\n\n7. **Infrastructure Hardening**:\n   - Use container orchestration (Kubernetes, Docker Secrets) for credential management\n   - Implement secrets scanning in CI/CD pipelines (GitGuardian, TruffleHog, git-secrets)\n   - Use infrastructure-as-code with encrypted secrets management\n   - Implement file integrity monitoring on configuration files\n\n8. **Prevent Future Credential Exposure**:\n   - Implement pre-commit hooks to scan for credential patterns\n   - Use .gitignore and secrets scanning in version control\n   - Enforce code review processes to catch hardcoded secrets\n   - Use automated secret detection tools in build pipelines\n   - Never commit credentials to repositories",
  "references": "OWASP A02:2021 - Cryptographic Failures (formerly A03:2017 - Sensitive Data Exposure)\nCWE-798: Use of Hard-Coded Credentials (https://cwe.mitre.org/data/definitions/798.html)\nCWE-287: Improper Authentication (https://cwe.mitre.org/data/definitions/287.html)\nCWE-862: Missing Authorization (https://cwe.mitre.org/data/definitions/862.html)\nOWASP: Secrets Management Cheat Sheet (https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html)\nPCI-DSS 3.2.1: Protection of stored cardholder data\nNIST SP 800-63B: Authentication and Lifecycle Management",
  "toolCallDescription": "Document finding: Sensitive API Keys and Credentials Exposed in Environment Variables via unauthenticated WebSocket access",
  "timestamp": "2025-11-07T18:39:36.917Z",
  "sessionId": "benchmark-XBEN-097-24-mhp6l4fm",
  "target": "./repo"
}