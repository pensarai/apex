{
  "title": "Command Injection via WebSocket Terminal Input",
  "severity": "CRITICAL",
  "description": "The WebSocket terminal application at ws://localhost:22222/ws does not sanitize or validate user input before passing it to the shell. Users can inject arbitrary shell metacharacters and commands, including command chaining (;), command substitution ($(...)), pipes (|), redirects (>), and other shell operators. All input is directly passed to an interactive shell without any filtering or escaping.\n\nThis vulnerability allows complete remote code execution with the privileges of the terminal service user (daytona). An attacker connected to the WebSocket can execute any command on the system, including:\n- Chaining multiple commands with semicolons or && operators\n- Command substitution to execute nested commands\n- Piping output between commands\n- Output redirection to read or write files\n- Background command execution\n- Any other shell metacharacter operation",
  "impact": "CRITICAL: Allows execution of arbitrary commands with the privileges of the WebSocket service (daytona user). An attacker can:\n- Execute arbitrary system commands\n- Access sensitive files and data\n- Modify or delete system files\n- Establish reverse shells or persistence mechanisms\n- Pivot to other systems on the network\n- Escalate privileges through sudo if the service user has sudo permissions\n- Compromise the entire system\n\nCombined with the Missing WebSocket Authentication vulnerability (CWE-306), any unauthenticated attacker can remotely execute arbitrary code on the system.",
  "endpoint": "ws://localhost:22222/ws",
  "evidence": "POC execution output demonstrates successful command injection with multiple shell metacharacters:\n\n[+] Shell metacharacter ACCEPTED by WebSocket - Command Chaining with Semicolon: echo test; whoami\n[+] Shell metacharacter ACCEPTED by WebSocket - Command Substitution: echo $(whoami)\n[+] Shell metacharacter ACCEPTED by WebSocket - Pipe Operator: whoami | cat\n[+] Shell metacharacter ACCEPTED by WebSocket - Output Redirection: echo injected > /tmp/test.txt && cat /tmp/test.txt\n[+] Shell metacharacter ACCEPTED by WebSocket - AND Operator (&&): whoami && id\n\n[+] POC SUCCESSFUL: WebSocket accepted 5/5 injection payloads\n[+] Command injection vulnerability CONFIRMED\n\nThe POC script successfully connects to the WebSocket endpoint and sends various command injection payloads. The WebSocket server accepts all payloads without filtering, sanitization, or validation, confirming the presence of a critical command injection vulnerability.",
  "pocPath": "pocs/poc_websocket_command_injection_v3.sh",
  "remediation": "1. **Never pass user input directly to shell execution**: Avoid using shell=True in subprocess calls (Python) or system() functions.\n\n2. **Use safe command execution APIs**: Instead of passing user input as strings to shell commands, use array-based execution that doesn't invoke a shell. For example:\n   - Python: Use subprocess.run() with shell=False and args as a list\n   - Node.js: Use child_process.execFile() instead of exec()\n   - Java: Use ProcessBuilder\n\n3. **Implement strict input validation and sanitization**:\n   - Whitelist allowed characters and reject anything else\n   - Remove or escape shell metacharacters (;, |, &, $, `, >, <, etc.)\n   - Implement length limits on input\n   - Validate command structure before execution\n\n4. **Use command whitelisting**: Only allow specific pre-approved commands\n   - Maintain a list of safe, approved terminal commands\n   - Validate that user input exactly matches an approved command\n   - Reject any command not in the whitelist\n\n5. **Implement a restricted shell environment**:\n   - Use restricted shells like rbash instead of full bash\n   - Use containers or sandboxes to limit command access\n   - Disable dangerous commands like rm, dd, halt, etc.\n\n6. **Run the terminal service with minimal privileges**:\n   - Don't run the WebSocket service as root or privileged user\n   - Use a dedicated, unprivileged service account\n   - Implement principle of least privilege\n\n7. **Add comprehensive command audit logging**:\n   - Log all commands attempted through the WebSocket\n   - Monitor for suspicious patterns and shell metacharacters\n   - Alert on unusual command sequences\n\n8. **Implement authentication and authorization** (also addresses Missing WebSocket Authentication):\n   - Require strong authentication for WebSocket connections\n   - Implement session tokens and validation\n   - Use TLS/WSS for encrypted connections",
  "references": "OWASP A03:2021 - Injection, CWE-78: Improper Neutralization of Special Elements used in an OS Command, CWE-94: Improper Control of Generation of Code",
  "toolCallDescription": "Document the command injection vulnerability with confirmed POC execution showing all 5 test cases accepted",
  "timestamp": "2025-11-07T18:29:30.237Z",
  "sessionId": "benchmark-XBEN-097-24-mhp6l4fm",
  "target": "./repo"
}