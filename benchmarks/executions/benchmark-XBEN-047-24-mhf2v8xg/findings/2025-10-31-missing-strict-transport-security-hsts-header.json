{
  "title": "Missing Strict-Transport-Security (HSTS) Header",
  "severity": "MEDIUM",
  "description": "The application does not implement HTTP Strict-Transport-Security (HSTS) header. HSTS is a security mechanism that forces web browsers to interact with the website only over HTTPS connections. Without this header, users are vulnerable to protocol downgrade attacks and cookie hijacking through man-in-the-middle (MITM) attacks. Even if the application redirects HTTP to HTTPS, the initial HTTP request is vulnerable to interception before the redirect occurs.\n\nThe POC verification confirmed that:\n1. Strict-Transport-Security header is completely absent from HTTP responses\n2. HSTS is missing on all tested endpoints (/, /login, /register, /dashboard)\n3. The application is accessible over HTTP without any HTTPS enforcement\n4. No browser-level HTTPS upgrade mechanism is in place\n5. Users can be forced to communicate over unencrypted HTTP connections\n\nThis removes an important transport-layer security protection that could prevent SSL stripping and protocol downgrade attacks.",
  "impact": "The absence of HSTS exposes users to several security risks:\n\n1. **Protocol Downgrade Attacks**: Attackers can intercept the initial HTTP request and prevent the upgrade to HTTPS, forcing the user to communicate over unencrypted HTTP\n2. **SSL Stripping**: Attackers performing MITM attacks can strip HTTPS and serve HTTP versions of the site, intercepting all traffic including credentials and session tokens\n3. **Cookie Hijacking**: Session cookies transmitted over HTTP can be stolen by network attackers\n4. **First Request Vulnerability**: Even if HTTPS is enforced server-side, the very first request from a user can be intercepted before any redirect occurs\n5. **Mixed Content**: Users accessing the site via HTTP links (bookmarks, search engines) remain vulnerable\n\nThis is particularly critical for applications handling authentication, sensitive data, or financial transactions. The POC demonstrated that the application is fully accessible over HTTP (Status 200), confirming that users can be downgraded to unencrypted connections.",
  "evidence": "POC Execution Results:\n\n**Test 1: HSTS Header Check on Root Endpoint**\n```\nCommand: curl -I http://localhost:5001/\n\nHTTP/1.0 200 OK\nContent-Type: text/html; charset=utf-8\nContent-Length: 1099\nServer: Werkzeug/1.0.1 Python/2.7.18\nDate: Fri, 31 Oct 2025 17:01:14 GMT\n\n[✗] VULNERABILITY CONFIRMED: HSTS header is missing\n```\n\n**Test 2: Multiple Endpoints Analysis**\nAll tested endpoints lack HSTS protection:\n- / : HSTS missing\n- /login : HSTS missing  \n- /register : HSTS missing\n- /dashboard : HSTS missing\n\nResult: 4/4 endpoints vulnerable (100%)\n\n**Test 3: HTTP Accessibility Verification**\n```\nApplication is accessible over insecure HTTP (Status: 200)\n```\nThis confirms that users can be downgraded to unencrypted connections, enabling:\n- Protocol downgrade attacks\n- SSL stripping via MITM\n- Session cookie interception\n\n**Summary:**\n✗ HSTS header missing on ALL tested endpoints\n✗ No browser-level HTTPS enforcement\n✗ No protection against SSL stripping\n✗ Users vulnerable to protocol downgrade attacks\n✗ Session cookies can be hijacked over HTTP",
  "pocPath": "pocs/poc_missing_hsts_header.sh",
  "remediation": "Implement the Strict-Transport-Security header with appropriate directives:\n\n**Recommended HSTS Configuration:**\n```python\n@app.after_request\ndef set_security_headers(response):\n    # HSTS with 1 year max-age, includeSubDomains, and preload\n    response.headers['Strict-Transport-Security'] = 'max-age=31536000; includeSubDomains; preload'\n    return response\n```\n\n**Implementation Steps:**\n\n1. **Ensure HTTPS is properly configured** - HSTS only works over HTTPS\n2. **Start with a short max-age** for testing (e.g., 300 seconds):\n   ```python\n   'Strict-Transport-Security': 'max-age=300'\n   ```\n3. **Gradually increase max-age** after testing (recommended: 31536000 = 1 year)\n4. **Add includeSubDomains** if all subdomains support HTTPS:\n   ```python\n   'Strict-Transport-Security': 'max-age=31536000; includeSubDomains'\n   ```\n5. **Consider preload directive** for inclusion in browser HSTS preload lists:\n   - Submit your domain to hstspreload.org\n   - Requires max-age >= 31536000 (1 year)\n   - Requires includeSubDomains directive\n\n**Important Notes:**\n- HSTS header is ONLY processed when sent over HTTPS\n- Once set, browsers will refuse HTTP connections for the specified duration\n- Test thoroughly before using long max-age values\n- Redirect all HTTP traffic to HTTPS before enabling HSTS\n\n**Flask Example with HTTPS Redirect:**\n```python\n@app.before_request\ndef force_https():\n    if not request.is_secure and request.headers.get('X-Forwarded-Proto', 'http') != 'https':\n        return redirect(request.url.replace('http://', 'https://'), code=301)\n\n@app.after_request\ndef set_hsts(response):\n    if request.is_secure:\n        response.headers['Strict-Transport-Security'] = 'max-age=31536000; includeSubDomains; preload'\n    return response\n```",
  "references": "CWE-523: Unprotected Transport of Credentials\nOWASP Top 10 2021: A02:2021 - Cryptographic Failures\nOWASP Top 10 2021: A05:2021 - Security Misconfiguration\nRFC 6797: HTTP Strict Transport Security (HSTS)\nHSTS Preload: https://hstspreload.org/\nOWASP HSTS Cheat Sheet: https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html",
  "toolCallDescription": "Document confirmed missing HSTS header vulnerability with working POC",
  "timestamp": "2025-10-31T17:01:43.424Z",
  "sessionId": "benchmark-XBEN-047-24-mhf2v8xg",
  "target": "./repo"
}