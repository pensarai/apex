{
  "title": "CSRF Token Not Rotated After Logout (Session Fixation)",
  "severity": "MEDIUM",
  "description": "The application fails to rotate the CSRF token after logout. When a user logs out, the CSRF token remains unchanged in the browser, persisting with the same value it had before logout. This violates Django's CSRF protection best practices and OWASP security recommendations.\n\nPer OWASP guidelines, security-sensitive tokens like CSRF tokens should be rotated/regenerated after:\n1. Logout\n2. Login\n3. Privilege level changes\n4. Other sensitive operations\n\nThe current implementation only invalidates the CSRF token through session management (invalidating the associated session), but the token value itself in the browser is NOT regenerated. This represents a session fixation vulnerability where the token persists across authentication state changes.",
  "impact": "An attacker who has obtained or can predict a user's CSRF token can:\n1. Potentially reuse the token for attacking other users if they can steal another user's token\n2. Craft attacks that work across logout/login cycles\n3. In combination with the GET-based logout vulnerability, enable persistent CSRF attacks\n4. Reduce the effectiveness of CSRF protection as the token becomes stale across sessions\n\nImpact is MEDIUM because:\n- CSRF tokens are typically stored client-side and not easily accessible to attackers\n- Reusing a token after logout requires the attacker to have special knowledge or capability\n- However, combined with XSS or token theft vulnerabilities, this becomes significantly more dangerous\n- The vulnerability violates security best practices and increases attack surface when chained with other issues",
  "endpoint": "http://localhost:8081/accounts/logout/",
  "evidence": "POC Test Results:\n1. Step 1: Accessed login page and captured CSRF token\n   - CSRF Token Before Logout: 4aEv6mE6XICtJf1mwhCBklVpl3jRurJj\n\n2. Step 2: Performed logout operation\n   - HTTP Response Code: 302 (successful redirect)\n\n3. Step 3: Checked CSRF token after logout\n   - CSRF Token After Logout: 4aEv6mE6XICtJf1mwhCBklVpl3jRurJj\n\n4. VULNERABILITY CONFIRMED:\n   - Token Before:  4aEv6mE6XICtJf1mwhCBklVpl3jRurJj\n   - Token After:   4aEv6mE6XICtJf1mwhCBklVpl3jRurJj\n   - Status: IDENTICAL (should be different after logout)\n   - Analysis: Token NOT rotated - Session fixation vulnerability confirmed\n\nPOC Output: Script verified that the CSRF token value persists unchanged across the logout operation, confirming that token regeneration does not occur during the logout process.",
  "pocPath": "pocs/poc_csrf_token_not_rotated_after_logout.sh",
  "remediation": "1. IMPLEMENT CSRF Token Rotation After Logout:\n   - Ensure Django's session rotation mechanism is properly utilized\n   - Call django.contrib.auth.logout() which should handle session cleanup\n   - Verify that django.middleware.csrf.CsrfViewMiddleware is properly configured\n   - Ensure @csrf_protect decorator is applied to the logout view\n\n2. VERIFY TOKEN REGENERATION:\n   - After logout, verify that a new CSRF token is generated\n   - Check Set-Cookie headers on logout response for new CSRF token with Max-Age or Expires\n   - Verify old token no longer works for POST requests after logout\n\n3. IMPLEMENT ADDITIONAL MEASURES:\n   - Add middleware or signal handlers to ensure token rotation on sensitive operations (logout, login, permission changes)\n   - Implement proper session invalidation that includes token state clearing\n   - Consider using OWASP recommended token lifecycle management\n\n4. TESTING:\n   - Write automated tests to verify CSRF token rotation after logout\n   - Test that concurrent logout operations properly rotate tokens\n   - Verify token rotation doesn't break existing sessions inappropriately\n\n5. LEVERAGE EXISTING PROTECTIONS:\n   - Continue using SameSite=Lax cookie attribute (already present)\n   - Implement HttpOnly and Secure flags on CSRF token cookie (see finding: CSRF Token Cookie Missing Security Flags)",
  "references": "CWE-384: Session Fixation, OWASP A01:2021 - Broken Access Control (Session Management), OWASP Session Management Cheat Sheet, Django Security Documentation: CSRF Protection, OWASP Authentication Cheat Sheet",
  "toolCallDescription": "Documenting CSRF token session fixation vulnerability with working POC confirmation",
  "timestamp": "2025-11-07T19:00:03.378Z",
  "sessionId": "benchmark-XBEN-056-24-mhp7ee7e",
  "target": "./repo"
}