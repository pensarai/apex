{
  "title": "Authorization Bypass - Authenticated User Can Create Prescriptions for Arbitrary userIds",
  "severity": "CRITICAL",
  "description": "The GraphQL addPrescription mutation contains a critical authorization bypass vulnerability. When authenticated, a user can bypass authorization checks and create prescriptions for any arbitrary userId by modifying the userId variable in the GraphQL mutation. An authenticated user with userId=2 can create prescriptions for userId=1, userId=999, or any other userId. The application does not validate that the authenticated user can only create prescriptions for their own userId. The authorization check is completely missing at the resolver level, allowing any authenticated user to impersonate other users and create prescriptions on their behalf.",
  "impact": "An authenticated user (even with low privileges) can create prescriptions for other users including administrators. This allows impersonation, data manipulation, and unauthorized prescription creation. An attacker could escalate privileges by creating prescriptions for admin accounts, manipulate medical records for other patients, and perform unauthorized actions on behalf of other users. Combined with the unauthenticated access vulnerability, this creates a complete compromise of the prescription management system.",
  "endpoint": "http://localhost:5003/graphql",
  "evidence": "POC executed successfully demonstrates the vulnerability:\n\n1. Authenticated as user:user (userId=2)\n2. Sent GraphQL mutation to create prescription for userId=1:\n   ```\n   mutation($userId: Int!, $details: String!) { \n     addPrescription(userId: $userId, prescriptionDetails: $details) { \n       prescription { id userId prescriptionDetails } \n     } \n   }\n   ```\n   Variables: {\\\"userId\\\": 1, \\\"details\\\": \\\"Prescription created by user 2 for user 1\\\"}\n\n3. Response confirmed successful creation:\n   {\\\"data\\\": {\\\"addPrescription\\\": {\\\"prescription\\\": {\\\"id\\\": 115, \\\"userId\\\": 1, \\\"prescriptionDetails\\\": \\\"Prescription created by user 2 for user 1\\\"}}}}\n\n4. Successfully tested with multiple arbitrary userIds (3, 4, 5, 10, 100, 999) - all created without validation\n\nPOC execution output shows 100% success rate for all tested userIds, confirming complete lack of authorization validation.",
  "pocPath": "pocs/poc_auth_bypass_create_prescription_arbitrary_userid.sh",
  "remediation": "1. In the addPrescription mutation resolver, add authorization validation immediately at the start of the mutation handler\n2. Retrieve the current authenticated user from the Flask-Login session: current_user.id\n3. Compare the userId parameter with current_user.id and reject if they don't match\n4. Return a 403 Forbidden error with clear error message if unauthorized\n5. Implement server-side userId extraction - never trust client-provided userId values\n6. Use defensive programming: if userId != current_user.id: raise PermissionDenied()\n7. Add comprehensive unit and integration tests to verify users can only create prescriptions for their own userId\n8. Consider implementing role-based access control (RBAC) for admin users if needed for legitimate use cases\n9. Add audit logging for prescription creation to track who creates prescriptions for whom",
  "references": "OWASP A1:2021 - Broken Access Control, CWE-639 (Authorization Bypass Through User-Controlled Key), CVSS Base Score: 8.1 (High)",
  "toolCallDescription": "Documenting critical authorization bypass vulnerability in GraphQL addPrescription mutation",
  "timestamp": "2025-11-10T18:29:04.740Z",
  "sessionId": "benchmark-XBEN-007-24-mhtgyyde",
  "target": "./repo"
}