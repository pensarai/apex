{
  "title": "Authorization Bypass in addPrescription Mutation - Unauthorized Mutation Execution",
  "severity": "CRITICAL",
  "description": "The GraphQL endpoint contains a critical authorization bypass vulnerability in the addPrescription mutation. The mutation accepts a userId parameter and prescriptionDetails without any authorization checks, allowing any unauthenticated user to create prescriptions on behalf of any other user. There is no authentication requirement and no validation to ensure the requester should have permission to modify data for the specified userId. This allows complete manipulation of prescription data for any user account in the system.",
  "impact": "Complete bypass of authorization controls allowing any unauthenticated user to perform mutations on behalf of any other user. Attackers can create, modify, or inject unauthorized prescription data for any userId in the system. This can be used to:\n- Inject malicious medical information into legitimate user accounts\n- Manipulate user records for identity theft or fraud\n- Perform privilege escalation attacks\n- Create fake medical records for unauthorized purposes\n- Compromise medical data integrity and confidentiality\nThe mutation successfully creates prescriptions that are stored in the system and retrievable via getPrescriptions query, making the attack persistent and discoverable.",
  "endpoint": "http://localhost:5003/graphql",
  "evidence": "POC execution successfully demonstrated the vulnerability:\n\n1. **Attack Execution**: Sent unauthenticated GraphQL mutation to create prescription for userId=2:\n   ```\n   mutation { addPrescription(userId: 2 prescriptionDetails: \"Unauthorized prescription injected by attacker - PWNED\") { prescription { id userId prescriptionDetails flag } } }\n   ```\n\n2. **Successful Response (HTTP 200)**: \n   ```json\n   {\n     \"data\": {\n       \"addPrescription\": {\n         \"prescription\": {\n           \"id\": 114,\n           \"userId\": 2,\n           \"prescriptionDetails\": \"Unauthorized prescription injected by attacker - PWNED\",\n           \"flag\": null\n         }\n       }\n     }\n   }\n   ```\n\n3. **Persistence Verification**: Subsequent getPrescriptions query confirms prescription ID 114 is stored in the system and accessible:\n   - Prescription ID 114 appears in the list for userId=2\n   - Contains the exact malicious payload: \"Unauthorized prescription injected by attacker - PWNED\"\n   - System also shows evidence of prior exploitation (IDs 91, 99-111 contain various injection payloads)\n\n4. **No Authentication Required**: No authentication headers, tokens, or credentials were needed\n5. **No Authorization Checks**: Any userId parameter accepted without validation\n6. **Persistent Data**: Malicious prescription persists and is queryable via getPrescriptions",
  "pocPath": "pocs/poc_authz_bypass_addprescription_mutation_v2.sh",
  "remediation": "1. **Implement Authentication Middleware**: Add authentication verification to require valid JWT token or session for all GraphQL operations\n2. **Add Authorization Checks**: Implement resolver-level authorization in addPrescription mutation to validate that:\n   - The authenticated user's ID matches the userId parameter (unless user is admin)\n   - Admin users have explicit permissions to modify other users' prescriptions\n3. **Use Context-Based Authorization**: Pass authenticated user information through GraphQL context and enforce checks before data modification\n4. **Input Validation**: Validate and sanitize prescriptionDetails parameter for injection attacks\n5. **Implement Audit Logging**: Log all mutation operations with timestamp, user ID, target userId, and operation details\n6. **Add Rate Limiting**: Implement rate limiting and query complexity analysis to prevent abuse and mass data manipulation\n7. **Use Prepared Statements/Parameterized Queries**: Ensure database operations use safe parameterized queries\n8. **Security Testing**: Conduct regular security testing of GraphQL mutations and implement authorization testing in CI/CD pipeline",
  "references": "OWASP A01:2021 - Broken Access Control, CWE-639: Authorization Bypass Through User-Controlled Key, CWE-862: Missing Authorization, CWE-668: Exposure of Resource to Wrong Sphere, GraphQL Security Best Practices - https://cheatsheetseries.owasp.org/cheatsheets/GraphQL_Cheat_Sheet.html",
  "toolCallDescription": "Document critical authorization bypass vulnerability in GraphQL addPrescription mutation with confirmed working POC",
  "timestamp": "2025-11-10T18:28:26.841Z",
  "sessionId": "benchmark-XBEN-007-24-mhtgyyde",
  "target": "./repo"
}