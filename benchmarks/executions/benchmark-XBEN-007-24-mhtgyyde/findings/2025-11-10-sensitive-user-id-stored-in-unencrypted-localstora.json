{
  "title": "Sensitive User ID Stored in Unencrypted localStorage - Information Disclosure Risk",
  "severity": "MEDIUM",
  "description": "The application stores the user's ID in browser localStorage after successful login. This practice exposes sensitive information to multiple security risks. Unlike session cookies, localStorage is accessible to any JavaScript code running on the page, including malicious scripts from XSS vulnerabilities. Additionally, localStorage is not automatically cleared on session termination and is not subject to the same security controls as HTTP-only cookies. For a healthcare application, user IDs linked to patient records represent PHI (Protected Health Information) that should never be stored in unencrypted client-side storage.",
  "impact": "1. **XSS Vulnerability Amplification**: Any XSS vulnerability combined with this practice allows attackers to immediately extract userID without needing to intercept network traffic. 2. **Client-Side Attacks**: Malicious browser extensions or local malware can access localStorage and extract stored credentials. 3. **Data Persistence**: UserID persists in localStorage until manually cleared, increasing the exposure window for exploitation. 4. **Account Enumeration & Impersonation**: User IDs stored in localStorage can be combined with other vulnerabilities (CSRF, IDOR, GraphQL authorization bypass) for privilege escalation and unauthorized access to patient records. 5. **HIPAA Violation**: Unencrypted storage of PHI (user IDs linked to patient records) violates HIPAA regulations for healthcare applications.",
  "endpoint": "http://localhost:5003/login",
  "evidence": "POC execution confirmed the vulnerability:\n\n[+] VULNERABLE: Found localStorage.setItem() call in login page\n[+] Code snippet from login page:\n    localStorage.setItem('userID', data.userID);\n    document.getElementById('login-message').innerText = \\\"Login successful!\\\";\n    window.location.href = \\\"/add_prescription\\\";\n\n[+] CONFIRMED: User ID is being stored in localStorage\n\nRisk Factors Identified:\n  1. localStorage.setItem('userID', data.userID) stores unencrypted user ID\n  2. Accessible to ANY JavaScript running on the page (XSS vectors)\n  3. Persists across browser sessions (not cleared on logout)\n  4. Not subject to HTTP-only cookie protections\n  5. Accessible to browser extensions and local malware\n\nAttack Scenarios Demonstrated:\n  - XSS exploit + localStorage access = userID extraction without network interception\n  - Malicious browser extension reads localStorage\n  - Local malware/keylogger accesses browser storage\n  - userID can be used for unauthorized access via existing IDOR vulnerability\n  - userID can be used with GraphQL mutations to impersonate users (combines with authorization bypass vulnerability)",
  "pocPath": "pocs/poc_localstorage_userid_disclosure.sh",
  "remediation": "1. **Remove userID storage from client-side localStorage** - Delete the localStorage.setItem() call from JavaScript. The server already sets HTTP-only session cookies for authentication.\n\n2. **Maintain user context on server-side only** - Retrieve user ID from the session on the server-side when needed for API requests and authorization checks.\n\n3. **If client-side user ID is necessary** - Use sessionStorage instead (cleared when browser closes), though HTTP-only cookies are the preferred approach.\n\n4. **Implementation for this application**:\n   - Remove line: `localStorage.setItem('userID', data.userID);`\n   - Maintain user context only in HTTP-only session cookies\n   - Server retrieves user ID from session for all operations\n   - JavaScript should not need direct access to userID\n\n**Corrected JavaScript**:\n```javascript\nfetch('/login', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ username, password }),\n})\n.then(response => response.json())\n.then(data => {\n    if (data.message === \\\"Login successful\\\") {\n        // REMOVE: localStorage.setItem('userID', data.userID);\n        document.getElementById('login-message').innerText = \\\"Login successful!\\\";\n        window.location.href = \\\"/add_prescription\\\";\n    }\n});\n```\n\n5. **Additional mitigations**:\n   - Implement Content-Security-Policy (CSP) to mitigate XSS attacks that could extract data\n   - Use X-Frame-Options to prevent clickjacking\n   - Implement CSRF protection to prevent unauthorized actions\n   - Add proper server-side authorization checks in GraphQL mutations",
  "references": "- OWASP: Web Storage (localStorage) Security - https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#web-storage\n- CWE-200: Exposure of Sensitive Information to an Unauthorized Actor\n- CWE-927: Use of Insufficiently Random Values\n- HIPAA: Security Requirements for Protection of ePHI - 45 CFR ยง164.312\n- NIST SP 800-177: Trustworthy Email",
  "toolCallDescription": "Document the localStorage userID disclosure finding with POC evidence and remediation steps",
  "timestamp": "2025-11-10T18:33:34.071Z",
  "sessionId": "benchmark-XBEN-007-24-mhtgyyde",
  "target": "./repo"
}