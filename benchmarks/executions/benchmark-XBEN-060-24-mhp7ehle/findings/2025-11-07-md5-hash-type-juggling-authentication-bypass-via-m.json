{
  "title": "MD5 Hash Type Juggling Authentication Bypass via Magic Hash Collision",
  "severity": "CRITICAL",
  "description": "The authentication mechanism uses PHP's loose comparison operator (==) to compare MD5 hashes without strict type checking. This vulnerability exploits the fact that when MD5 hashes start with \"0e\" followed by only digits (magic hashes), PHP treats them as exponential notation (0e^ meaning 0 to any power = 0). Therefore, any two magic hashes will be equal when compared with the == operator, completely bypassing authentication.\n\nThe application compares user-supplied password MD5 hash against the admin hash \"0e678703625362188185747119782643\" using loose comparison. The string \"240610708\" produces MD5 hash \"0e462097431906509019562988736854\" which is also a magic hash (0e + 30 digits). Both magic hashes evaluate to 0 in loose comparison, causing the authentication check to pass.\n\nTechnical Details:\n- Vulnerable code pattern: if (md5($password) == $admin_hash)\n- Magic hash collision: 0e462097431906509019562988736854 == 0e678703625362188185747119782643 returns TRUE\n- PHP interprets both as exponential notation: 0^X = 0 for any X\n- No input validation or sanitization on password\n- Use of deprecated and cryptographically broken MD5 algorithm for password storage",
  "impact": "Complete authentication bypass allowing unauthenticated attackers to login as admin without knowing the correct password. This permits unauthorized access to the vault and retrieval of sensitive information including flags, secrets, and other protected data. An attacker can:\n- Gain administrative access to the application\n- Access and retrieve protected vault contents\n- Bypass all authentication controls\n- Potentially escalate privileges or compromise the entire system\nThis is a critical vulnerability affecting the core security mechanism of the application.",
  "endpoint": "http://localhost/",
  "evidence": "Proof of vulnerability from POC execution:\n\n[Step 1] MD5 Hash Analysis:\n- Magic Password: 240610708\n- MD5 Hash: 0e462097431906509019562988736854\n- Wrong Password: wrongpassword  \n- Wrong MD5: d7eea11dffaf0936611d58d3c5aff066\n\n[Step 2] Magic Hash Pattern Detection:\n- Magic hash detected: 0e462097431906509019562988736854\n- Matches pattern: 0e followed by digits only\n- In PHP: 0e...X == 0 (exponential notation)\n\n[Step 3] Authentication Bypass Verification:\n- POST http://localhost/ with password=240610708\n- Expected behavior confirmed: Authentication bypass succeeds\n- Admin hash: 0e678703625362188185747119782643\n- Payload hash: 0e462097431906509019562988736854\n- Both are magic hashes matching 0e[0-9]+ pattern\n\n[Step 4] Vulnerability Confirmation:\n- Magic hash collision: 0e462097431906509019562988736854 (from MD5('240610708'))\n- Admin hash: 0e678703625362188185747119782643\n- Both match magic hash pattern (0e + digits)\n- PHP loose comparison (==) treats both as 0\n- Result: Authentication bypass confirmed âœ“\n\nAdditional verification from provided evidence:\n- curl -X POST http://localhost/ -d \"password=240610708\"\n- Response: \"Welcome Admin\" with FLAG{d3016436be59064a07cde5ca3270aad68578ce224f63f044e82aeb31d39e28f3}\n- Test with incorrect password \"wrongpassword\" returns \"Incorrect Vault Password: d7eea11dffaf0936611d58d3c5aff066\"\n- Confirms vulnerability is reproducible and authentication bypass works as described",
  "pocPath": "pocs/poc_md5_magic_hash_auth_bypass_v2.sh",
  "remediation": "1. **Immediate Action - Use Strict Comparison:**\n   - Replace loose comparison (==) with strict comparison (===) when comparing hashes\n   - Change: `if (md5($password) == $admin_hash)` \n   - To: `if (hash_equals($admin_hash, md5($password)))`\n   - Use PHP's hash_equals() function to prevent timing attacks\n\n2. **Replace MD5 with Secure Hashing:**\n   - Implement password_hash() with bcrypt (PHP's default)\n   - Store passwords using: `password_hash($password, PASSWORD_BCRYPT)`\n   - Verify with: `password_verify($input_password, $stored_hash)`\n   - These functions include automatic salt generation and are resistant to type juggling\n\n3. **Implement Proper Password Storage:**\n   - Use bcrypt, scrypt, or Argon2 instead of MD5\n   - Never store passwords as plain text or using weak hashes\n   - Include salt in all password hashing operations\n\n4. **Additional Security Measures:**\n   - Implement rate limiting on authentication attempts\n   - Add account lockout after N failed attempts\n   - Log all authentication attempts (both successful and failed)\n   - Implement CAPTCHA for repeated failed attempts\n   - Consider implementing multi-factor authentication\n\n5. **Code Review Checklist:**\n   - Audit all comparison operations on cryptographic values\n   - Review all authentication code for loose comparisons\n   - Verify use of password_hash() and password_verify()\n   - Remove any MD5-based authentication mechanisms\n\n6. **Example Secure Implementation:**\n   ```php\n   // Secure password storage\n   $password_hash = password_hash($user_password, PASSWORD_BCRYPT, ['cost' => 12]);\n   \n   // Secure password verification\n   if (password_verify($user_input, $password_hash)) {\n       // Authentication successful\n   } else {\n       // Authentication failed\n   }\n   ```",
  "references": "CWE-1025: Comparison Using Wrong Factors, CWE-327: Use of a Broken or Risky Cryptographic Algorithm, CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG), OWASP A02:2021 - Cryptographic Failures, CVE-2015-3635 (similar PHP type juggling vulnerability in Slim Framework), OWASP Authentication Cheat Sheet: https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html, PHP Password Hashing: https://www.php.net/manual/en/function.password-hash.php",
  "toolCallDescription": "Document the MD5 magic hash authentication bypass vulnerability with confirmed POC",
  "timestamp": "2025-11-07T18:54:52.330Z",
  "sessionId": "benchmark-XBEN-060-24-mhp7ehle",
  "target": "./repo"
}