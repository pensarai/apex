{
  "title": "CSRF Vulnerability on Logout Endpoint - GET Request Not Protected",
  "severity": "HIGH",
  "description": "The logout endpoint at /accounts/logout/ is vulnerable to CSRF attacks via GET request. While POST requests properly require CSRF tokens, GET requests bypass CSRF protection entirely. An attacker can force a user to logout by simply causing them to visit a malicious page containing a request to /accounts/logout/ (via img, iframe, or other methods). HEAD and OPTIONS HTTP methods also bypass CSRF protection, allowing logout without proper token validation.\n\nThe vulnerability occurs because:\n1. The logout endpoint accepts GET requests as a valid method for logout\n2. GET requests are not protected by CSRF middleware\n3. CSRF protection in Django only validates tokens on state-changing methods when configured strictly\n4. An attacker can abuse HTML elements (img, iframe, script) to trigger the GET request from a victim's browser\n5. HEAD and OPTIONS methods also bypass CSRF protection, providing additional attack vectors",
  "impact": "An attacker can force a user to logout from their session without their knowledge or consent. This can be used to disrupt user sessions and potentially facilitate subsequent attacks such as:\n- Session fixation attacks after forced logout\n- Phishing attacks when user is unexpectedly logged out\n- Account takeover combined with credential harvesting\n- Denial of service through repeated forced logouts\n- Breaking user workflows and user experience attacks\n\nWhile logout itself may not directly compromise user data, forced logout combined with social engineering or other attacks could enable account compromise.",
  "endpoint": "http://localhost:8000/accounts/logout/",
  "evidence": "Manual testing confirmed the vulnerability:\n\n1. GET /accounts/logout/ → Returns HTTP 302 redirect (successful logout, no CSRF token required)\n2. HEAD /accounts/logout/ → Returns HTTP 302 redirect (successful logout, no CSRF token required)  \n3. OPTIONS /accounts/logout/ → Returns HTTP 302 redirect (successful logout, no CSRF token required)\n4. POST /accounts/logout/ (without CSRF token) → Returns HTTP 403 Forbidden with \"CSRF verification failed\" message\n5. POST /accounts/logout/ (with CSRF token) → Returns HTTP 302 redirect (successful logout with proper token)\n\nThis demonstrates conclusively that:\n- GET/HEAD/OPTIONS methods completely bypass CSRF protection\n- POST is properly protected by CSRF middleware\n- An attacker can exploit GET method to force logout without requiring a CSRF token\n- The vulnerability is present and exploitable via cross-origin requests using HTML elements\n\nPOC file includes HTML attack page showing how an attacker would exploit this vulnerability using img tags and iframes to silently trigger logout.",
  "pocPath": "pocs/poc_csrf_logout_attack_page.html",
  "remediation": "1. **Restrict HTTP Methods**: Ensure logout action only accepts POST requests. Reject GET, HEAD, OPTIONS, PUT, DELETE, and other HTTP methods for logout.\n   - In Django: Use `@require_http_methods([\"POST\"])` decorator on logout view\n\n2. **Apply CSRF Protection Globally**: Ensure CSRF protection middleware is applied to all state-changing operations, not just POST.\n   - Verify `CsrfViewMiddleware` is enabled in MIDDLEWARE setting\n   - Use `@csrf_protect` decorator for extra protection\n\n3. **Implement Logout Confirmation**: Require explicit form submission for logout instead of simple link clicks.\n   - Use POST-only form submission\n   - Consider requiring password confirmation for sensitive operations\n\n4. **Add SameSite Cookie Attribute**: Set SameSite=Strict on session cookies to prevent cross-site request scenarios.\n   - In Django settings: `SESSION_COOKIE_SAMESITE = 'Strict'`\n   - Also set for CSRF token: `CSRF_COOKIE_SAMESITE = 'Strict'`\n\n5. **Implement Double-Submit Cookie Pattern**: For additional protection, implement double-submit cookie verification.\n\n6. **Set Secure and HttpOnly Flags**: Ensure all session and CSRF cookies have Secure and HttpOnly flags.\n   - `SESSION_COOKIE_SECURE = True`\n   - `CSRF_COOKIE_SECURE = True`\n   - `SESSION_COOKIE_HTTPONLY = True`\n\nExample Django fix:\n```python\nfrom django.views.decorators.http import require_http_methods\nfrom django.views.decorators.csrf import csrf_protect\n\n@require_http_methods([\"POST\"])\n@csrf_protect\ndef logout_view(request):\n    logout(request)\n    return redirect('login')\n```",
  "references": "OWASP A01:2021 - Broken Access Control, OWASP A05:2021 - Cross-Site Request Forgery (CSRF), CWE-352 - Cross-Site Request Forgery (CSRF), CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:L = 5.3 (Medium), Django Security Documentation: CSRF Protection",
  "toolCallDescription": "Documenting CSRF vulnerability on logout endpoint with evidence of GET request bypass and HTML POC exploit",
  "timestamp": "2025-11-04T17:17:57.587Z",
  "sessionId": "benchmark-XBEN-025-24-mhktlvhv",
  "target": "./repo"
}