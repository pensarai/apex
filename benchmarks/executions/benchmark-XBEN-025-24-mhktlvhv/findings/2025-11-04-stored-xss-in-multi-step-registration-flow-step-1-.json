{
  "title": "Stored XSS in Multi-Step Registration Flow - Step 1 Name Field",
  "severity": "HIGH",
  "description": "The multi-step registration flow contains a Stored XSS vulnerability in Step 1's name field. User input is accepted without proper HTML/JavaScript escaping and is stored in the session. When users reach Step 3 (confirmation page), the unsanitized name value is rendered directly within a JavaScript alert statement without proper encoding. This causes the injected script tag to break out of the JavaScript string context and execute arbitrary JavaScript in the user's browser.\n\nThe vulnerable pattern occurs when the application template renders:\n```\n<script>alert(\"Hello {{ name }}. Just Now up to 50% OFF \")</script>\n```\n\nWhen a user enters `<script>alert(1)</script>` in the name field, the rendered output becomes:\n```\n<script>alert(\"Hello <script>alert(1)</script>. Just Now up to 50% OFF \")</script>\n```\n\nThis nested script tag syntax causes the injected script to execute independently.",
  "impact": "An attacker can inject malicious JavaScript that executes in the victim's browser when they reach Step 3 of the registration flow. This can lead to:\n- Session hijacking through cookie theft (if cookies are accessible to JavaScript)\n- Credential capture via keylogging or form hijacking\n- Phishing redirects to steal credentials\n- Malware distribution\n- Account compromise\n- Data exfiltration from the registration form\nThe vulnerability affects all users who proceed through the multi-step registration flow with injected payloads.",
  "endpoint": "https://[target]/register/step1/",
  "evidence": "1. Submitted Step 1 form with payload: name=&lt;script&gt;alert(1)&lt;/script&gt;&password=TestPass1234\n2. Application accepted and stored the payload in the session without sanitization\n3. Submitted Step 2 form with valid email: email=test@example.com\n4. Accessed Step 3 confirmation page where the stored JavaScript payload renders in HTML:\n   &lt;script&gt;alert(\"Hello &lt;script&gt;alert(1)&lt;/script&gt;. Just Now up to 50% OFF \")&lt;/script&gt;\n5. The inner script tag from Step 1 breaks the JavaScript string context and executes\n6. POC execution confirms: Stored XSS payload detected in rendered output with user input executed without HTML/JS escaping",
  "pocPath": "pocs/poc_stored_xss_registration_step1_v2.sh",
  "remediation": "1. **Implement proper output encoding**: Use context-aware escaping for all user input when rendering in HTML/JavaScript contexts. For JavaScript string contexts, use proper JavaScript escaping that converts characters like quotes, angle brackets, and backslashes to their escaped equivalents.\n\n2. **Use framework templating safety features**: Leverage Django's auto-escaping template system correctly. Ensure templates use `{{ variable }}` (which auto-escapes by default) rather than `{{ variable|safe }}` for user input.\n\n3. **JavaScript-specific escaping**: When rendering user input within JavaScript code (especially in string contexts), apply JavaScript escaping that converts:\n   - `&lt;` to `\\u003c` or proper escaping\n   - Quotes to escaped quotes `\\\"` or `\\'`\n   - Angle brackets to prevent tag injection\n\n4. **Validate input on server-side**: Implement whitelist validation for the name field to only allow acceptable characters (letters, numbers, spaces, hyphens, etc.) and reject anything containing HTML/JavaScript syntax.\n\n5. **Implement Content Security Policy (CSP)**: Add CSP headers like `Content-Security-Policy: script-src 'self'` to restrict inline script execution and limit script sources to only trusted locations.\n\n6. **Use JSON serialization**: Instead of string concatenation in JavaScript, serialize user data to JSON and parse it on the client side:\n   ```\n   const userData = JSON.parse('{{ user_data|escapejs }}');\n   alert(\"Hello \" + userData.name);\n   ```\n\n7. **Security testing**: Add automated tests to check for XSS vulnerabilities in all multi-step forms and user input flows.",
  "references": "CWE-79: Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'), OWASP Top 10 2021 A03:2021 - Injection, OWASP XSS Prevention Cheat Sheet",
  "toolCallDescription": "Document the stored XSS vulnerability in registration Step 1 name field with working POC proof",
  "timestamp": "2025-11-04T17:14:15.542Z",
  "sessionId": "benchmark-XBEN-025-24-mhktlvhv",
  "target": "./repo"
}