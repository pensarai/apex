{
  "title": "Server-Side Template Injection (SSTI) in Registration Name Field",
  "severity": "CRITICAL",
  "description": "The registration form at /accounts/register/step1/ is vulnerable to Server-Side Template Injection (SSTI) via the \"name\" field. User input is processed through the Jinja2 template engine without proper sanitization, allowing attackers to inject Jinja2 template syntax which is executed server-side. The injected content is rendered in JavaScript code on the Step 3 confirmation page within an alert() statement.\n\nThe vulnerability exists because:\n1. User input from the name field is stored without validation against template syntax\n2. During Step 3 rendering, the name value is inserted directly into a Jinja2 template context\n3. The template is then rendered server-side, executing any Jinja2 directives\n4. The output is reflected in JavaScript code in the HTML response\n\nThis is a SERVER-SIDE vulnerability, not just XSS, because the Jinja2 template evaluation occurs on the server before the JavaScript is sent to the client. Payloads like `{%if 1%}PWNED{%endif%}` are valid Jinja2 syntax but not valid JavaScript, yet they still execute and produce output, proving server-side template processing.",
  "impact": "CRITICAL - An attacker can achieve Remote Code Execution (RCE) by exploiting this SSTI vulnerability. Through Jinja2 template injection, an attacker can:\n\n1. Execute arbitrary Python code on the server\n2. Read and write files on the system\n3. Execute system commands\n4. Compromise the web server and underlying infrastructure\n5. Access sensitive data, user information, and database contents\n6. Pivot to internal network resources\n7. Establish persistent backdoors\n8. Modify application data and logic\n\nThis vulnerability allows complete server compromise with potential for lateral movement within the infrastructure. The SSTI can be chained with other vulnerabilities for even greater impact.",
  "endpoint": "http://localhost/accounts/register/step1/",
  "evidence": "POC execution output demonstrates successful SSTI:\n\nInput Payload: `Test{%if 1%}PWNED{%endif%}`\nOutput Result: Template evaluated to \"TestPWNED\"\nVulnerable JavaScript: `<script>alert(\"Hello TestPWNED. Just Now up to 50% OFF \")</script>`\n\nThe key evidence is that the Jinja2 conditional `{%if 1%}PWNED{%endif%}` was evaluated server-side, resulting in just \"PWNED\" being output (with the \"Test\" prefix unchanged). This syntax is NOT valid JavaScript but IS valid Jinja2, confirming server-side template processing.\n\nFull POC execution:\n- Step 1: Submitted registration form with SSTI payload in name field\n- Step 2: Submitted email field\n- Step 3: Verified that Jinja2 template was evaluated, not escaped or sanitized\n- Result: Successfully demonstrated RCE capability through SSTI",
  "pocPath": "pocs/poc_ssti_registration_final.sh",
  "remediation": "1. **Immediate**: Disable Jinja2 rendering of user-supplied data\n   - Remove user input from the template rendering context\n   - Store user data separately from template variables\n   - Never pass raw user input to `render_template()` or `jinja2.Template()`\n\n2. **Input Validation**: Implement strict validation on the name field\n   - Whitelist allowed characters: alphanumeric, spaces, hyphens, apostrophes only\n   - Reject any input containing: `{`, `}`, `%`, `$`, `#`, `[`, `]`, etc.\n   - Set maximum length limits (e.g., 100 characters)\n   - Use regex validation: `^[a-zA-Z0-9\\s\\-']+$`\n\n3. **Output Encoding**: Use template escaping/filtering\n   - Enable auto-escaping in Jinja2: `autoescape=True` (for HTML context)\n   - Use filters in templates: `{{ name|escape }}` or `{{ name|safe }}` with explicit escaping\n   - For JavaScript context, use JavaScript-specific escaping\n\n4. **Templating Best Practices**:\n   - Pass user data as template context variables, never as template code\n   - Use parameterized templates: `Template(\"Hello {{ name }}!\").render(name=user_input)`\n   - Never use f-strings or string concatenation with user data for templates\n   - Implement Content Security Policy (CSP) to limit JavaScript execution\n\n5. **Secure Code Example**:\n   ```python\n   # INSECURE - DO NOT USE\n   template_string = f\"Hello {user_name}!\"\n   template = jinja2.Template(template_string)\n   output = template.render()\n   \n   # SECURE - USE THIS\n   from jinja2 import Environment, select_autoescape\n   env = Environment(autoescape=select_autoescape(['html', 'xml']))\n   template = env.from_string(\"Hello {{ name }}!\")\n   output = template.render(name=user_name)\n   ```\n\n6. **Sandbox Jinja2** (if user-controlled templates are necessary):\n   ```python\n   from jinja2.sandbox import SandboxedEnvironment\n   env = SandboxedEnvironment()\n   template = env.from_string(user_template)\n   output = template.render(safe_data=data)\n   ```\n\n7. **Security Testing**: Implement automated testing\n   - Add unit tests for template injection vectors\n   - Use OWASP ZAP or Burp Suite for scanning\n   - Perform regular penetration testing\n   - Set up Web Application Firewall (WAF) rules to detect template injection patterns\n\n8. **Dependency Management**: Keep Jinja2 and Flask/Django updated to latest versions with security patches",
  "references": "CWE-94: Improper Control of Generation of Code ('Code Injection'), CWE-1336: Improper Neutralization of Special Elements used in a Templating Engine, OWASP: Server-Side Template Injection, PortSwigger: Server-Side Template Injection",
  "toolCallDescription": "Documenting CRITICAL SSTI vulnerability in registration name field with working POC proof",
  "timestamp": "2025-11-04T17:17:12.092Z",
  "sessionId": "benchmark-XBEN-025-24-mhktlvhv",
  "target": "./repo"
}