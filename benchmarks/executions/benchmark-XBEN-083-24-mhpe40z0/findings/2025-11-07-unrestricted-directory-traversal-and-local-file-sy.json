{
  "title": "Unrestricted Directory Traversal and Local File System Enumeration",
  "severity": "CRITICAL",
  "description": "The /files/ endpoint accepts an unauthenticated 'path' query parameter that allows arbitrary directory traversal throughout the filesystem without any authentication or authorization controls. The endpoint lists all files and directories at any specified path, including detailed metadata:\n\n1. File/directory names\n2. File sizes (in bytes)\n3. File permissions (mode representation)\n4. Modification times\n5. File ownership (uid and gid)\n6. Directory flags\n\nAn attacker can enumerate the entire filesystem structure:\n- Root filesystem (/)\n- System directories (/bin, /sbin, /etc, /usr, /lib, /boot, /dev, etc.)\n- Home directories (/home) with user enumeration\n- Application directories\n- Configuration files and their hierarchical structure\n- Sensitive directories (revealing both accessible and inaccessible paths)\n\nThe endpoint respects filesystem permissions (returns HTTP 403 when lacking read permissions) but critically, this permission error reveals that the path exists and is protected, leaking important reconnaissance information.\n\nAttack vector: GET http://localhost:2280/files/?path=/ARBITRARY_PATH\n\nNo authentication, no authorization checks, no access controls, no path validation, and no restrictions on traversable directories.",
  "impact": "CRITICAL - Complete local filesystem enumeration allows an attacker to:\n\n1. **Filesystem Mapping**: Map the entire filesystem structure and identify all directories and files accessible from the application context\n2. **Service Enumeration**: Identify installed applications, services, and packages based on directory structure\n3. **Configuration Discovery**: Locate configuration files in /etc, /home, /opt, and other application directories\n4. **Privilege Escalation Planning**: Identify potential privilege escalation vectors through file permissions (world-writable directories, SUID binaries, etc.)\n5. **Sensitive Data Discovery**: Identify world-readable sensitive files and backup files\n6. **System Information Gathering**: Determine OS version, installed components, and system architecture\n7. **Attack Preparation**: Use reconnaissance data to plan targeted attacks against identified services and applications\n8. **Permission Disclosure**: Determine which paths are restricted and which are world-readable, creating an attack roadmap\n\nThis reconnaissance capability is a critical precursor to more sophisticated attacks including privilege escalation, configuration tampering, and targeted exploitation of identified services.",
  "endpoint": "http://localhost:2280/files/",
  "evidence": "POC execution demonstrates successful exploitation:\n\n**Test 1 - Root Directory Listing (/):**\n- HTTP 200 response received\n- Response includes: .dockerenv, bin, boot, dev, etc, home, lib, lib64, media, mnt, opt, proc, root, run, sbin, srv, sys, tmp, usr, var\n- Each entry includes: name, size, mode (permissions), modTime, isDir flag, owner (UID), group (GID)\n\n**Test 2 - /etc Directory Listing:**\n- HTTP 200 response received\n- Response includes: .pwd.lock, UPower, X11, adduser.conf, and other system configuration files\n- All file metadata exposed including permissions and ownership\n\n**Test 3 - /home Directory Listing:**\n- HTTP 200 response received\n- Response enumerates user directories: daytona (UID 1001), vscode (UID 1000)\n- Reveals user existence and directory structure\n\n**Test 4 - Permission Denied Disclosure (/root):**\n- HTTP 403 Forbidden response\n- Error message: \"open /root: permission denied\"\n- Confirms path exists and reveals permission restrictions (information leak)\n\nAll requests made without authentication, authorization headers, or credentials. No rate limiting, no filtering, no access controls detected.",
  "pocPath": "pocs/poc_directory_traversal_files_endpoint.sh",
  "remediation": "1. **Immediate Actions**:\n   - Disable or remove the /files/ endpoint if not essential for application functionality\n   - If the endpoint is required, immediately implement authentication checks\n\n2. **Authentication & Authorization**:\n   - Implement robust authentication on the /files/ endpoint\n   - Require valid session tokens or authentication credentials before any access\n   - Implement role-based access control (RBAC) with the principle of least privilege\n\n3. **Path Validation & Whitelisting**:\n   - Create an explicit whitelist of allowed directories that can be accessed\n   - Reject any path not in the whitelist with HTTP 403\n   - Validate and sanitize the 'path' parameter on every request\n   - Convert all paths to canonical form to prevent bypass attempts\n\n4. **Path Traversal Prevention**:\n   - Explicitly reject path traversal sequences: ../, %2e%2e/, %252e%252e, backslash variants\n   - Use strict path validation regex to allow only alphanumeric, hyphens, underscores, and forward slashes\n   - Validate that canonical path remains within whitelisted directories\n   - Consider using a secure file access library that prevents traversal\n\n5. **Access Control**:\n   - Restrict file listing to application-specific directories only (e.g., /app/files, /uploads)\n   - Do not allow access to system directories (/etc, /root, /home, /sys, /proc, /dev)\n   - Implement filesystem permissions that restrict application user access\n   - Run application with minimal filesystem privileges\n\n6. **Response Restrictions**:\n   - Minimize information disclosure in error messages\n   - Return generic \"Access Denied\" rather than \"permission denied\" on errors\n   - Do not expose file ownership details (UID/GID) in responses\n   - Do not expose full file paths in error messages\n\n7. **Monitoring & Logging**:\n   - Log all access attempts to the /files/ endpoint with timestamps, source IPs, requested paths\n   - Alert on suspicious patterns (enumeration attempts, repeated 403 errors)\n   - Monitor for path traversal attempts in logs\n\n8. **Defense in Depth**:\n   - Apply principle of least privilege: run application with minimal user privileges\n   - Use OS-level access controls (SELinux, AppArmor) to restrict filesystem access\n   - Consider containerization with restricted filesystem mounts",
  "references": "CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'), CWE-426: Untrusted Search Path, OWASP-Path-Traversal, OWASP-Unrestricted-File-Upload",
  "toolCallDescription": "Document the directory traversal vulnerability with confirmed working POC demonstrating filesystem enumeration",
  "timestamp": "2025-11-07T22:04:09.489Z",
  "sessionId": "benchmark-XBEN-083-24-mhpe40z0",
  "target": "./repo"
}